  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "user_profiles" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170317141651)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-17 14:18:03 UTC], ["updated_at", 2017-03-17 14:18:03 UTC]]
  [1m[35m (1.4ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "user_profiles" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170317141651)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-17 14:27:44 UTC], ["updated_at", 2017-03-17 14:27:44 UTC]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "user_profiles" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170317141651)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-17 14:28:56 UTC], ["updated_at", 2017-03-17 14:28:56 UTC]]
  [1m[35m (1.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "user_profiles" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer)[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170317141651)[0m
  [1m[35m (10.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-17 14:29:11 UTC], ["updated_at", 2017-03-17 14:29:11 UTC]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "user_profiles" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer)[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170317141651)[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-17 14:29:23 UTC], ["updated_at", 2017-03-17 14:29:23 UTC]]
  [1m[35m (47.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (1.4ms)[0m  [1m[31mDELETE FROM "user_profiles";[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';[0m
  [1m[35m (0.2ms)[0m  [1m[31mDELETE FROM sqlite_sequence where name = 'user_profiles';[0m
  [1m[35m (1.6ms)[0m  [1m[31mDELETE FROM "users";[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';[0m
  [1m[35m (0.1ms)[0m  [1m[31mDELETE FROM sqlite_sequence where name = 'users';[0m
  [1m[35m (1.6ms)[0m  [1m[31mDELETE FROM "ar_internal_metadata";[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';[0m
  [1m[35m (0.1ms)[0m  [1m[31mDELETE FROM sqlite_sequence where name = 'ar_internal_metadata';[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_2[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[36mUserProfile Load (0.1ms)[0m  [1m[34mSELECT  "user_profiles".* FROM "user_profiles" WHERE "user_profiles"."user_id" = ? LIMIT ?[0m  [["user_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_2[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (2.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-17 16:11:38 UTC], ["updated_at", 2017-03-17 16:11:38 UTC]]
  [1m[35m (31.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "user_profiles" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170317141651)[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-17 16:11:47 UTC], ["updated_at", 2017-03-17 16:11:47 UTC]]
  [1m[35m (1.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.6ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[36mUserProfile Load (0.2ms)[0m  [1m[34mSELECT  "user_profiles".* FROM "user_profiles" WHERE "user_profiles"."user_id" = ? LIMIT ?[0m  [["user_id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "user_profiles" ("user_id") VALUES (?)[0m  [["user_id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (55.4ms)[0m  [1m[35mCREATE TABLE "user_profiles" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170317141651)[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-17 16:12:02 UTC], ["updated_at", 2017-03-17 16:12:02 UTC]]
  [1m[35m (3.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.7ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (131.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[36mUserProfile Load (0.1ms)[0m  [1m[34mSELECT  "user_profiles".* FROM "user_profiles" WHERE "user_profiles"."user_id" = ? LIMIT ?[0m  [["user_id", 1], ["LIMIT", 1]]
  [1m[35mSQL (61.5ms)[0m  [1m[32mINSERT INTO "user_profiles" ("user_id") VALUES (?)[0m  [["user_id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (390.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (7.0ms)[0m  [1m[35mCREATE TABLE "user_profiles" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer)[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170317141651)[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-17 16:12:21 UTC], ["updated_at", 2017-03-17 16:12:21 UTC]]
  [1m[35m (1.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.6ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (8.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[36mUserProfile Load (0.2ms)[0m  [1m[34mSELECT  "user_profiles".* FROM "user_profiles" WHERE "user_profiles"."user_id" = ? LIMIT ?[0m  [["user_id", 1], ["LIMIT", 1]]
  [1m[35mSQL (5.8ms)[0m  [1m[32mINSERT INTO "user_profiles" ("user_id") VALUES (?)[0m  [["user_id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (33.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "user_profiles" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170317141651)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-17 19:35:05 UTC], ["updated_at", 2017-03-17 19:35:05 UTC]]
  [1m[35m (5.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[36mUserProfile Load (0.1ms)[0m  [1m[34mSELECT  "user_profiles".* FROM "user_profiles" WHERE "user_profiles"."user_id" = ? LIMIT ?[0m  [["user_id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "user_profiles" ("user_id") VALUES (?)[0m  [["user_id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "user_profiles" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer)[0m
  [1m[35m (21.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170317141651)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-20 09:23:19 UTC], ["updated_at", 2017-03-20 09:23:19 UTC]]
  [1m[35m (11.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.6ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[36mUserProfile Load (0.1ms)[0m  [1m[34mSELECT  "user_profiles".* FROM "user_profiles" WHERE "user_profiles"."user_id" = ? LIMIT ?[0m  [["user_id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "user_profiles" ("user_id") VALUES (?)[0m  [["user_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (14.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to User (20170317141651)
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.4ms)[0m  [1m[35mDROP TABLE "user_profiles"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE "users"[0m
  [1m[35mSQL (0.1ms)[0m  [1m[31mDELETE FROM "schema_migrations" WHERE "schema_migrations"."version" = ?[0m  [["version", "20170317141651"]]
  [1m[35m (1.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to User (20170317141651)
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES (?)[0m  [["version", "20170317141651"]]
  [1m[35m (1.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (8.5ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170317141651)[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-20 09:51:19 UTC], ["updated_at", 2017-03-20 09:51:19 UTC]]
  [1m[35m (5.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.6ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170317141651)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-20 09:51:35 UTC], ["updated_at", 2017-03-20 09:51:35 UTC]]
  [1m[35m (1.4ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e546234c-e851-46da-815f-378ec89d2f26) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe175827270 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (8.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170317141651)[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-20 09:52:05 UTC], ["updated_at", 2017-03-20 09:52:05 UTC]]
  [1m[35m (46.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: bdef9568-3837-4a04-8fb5-ee10c20bd8d7) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe5e1fa9690 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170317141651)[0m
  [1m[35m (25.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-20 09:53:00 UTC], ["updated_at", 2017-03-20 09:53:00 UTC]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 31128e6a-d84e-4fde-bec5-16244320412d) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f86d5484050 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (6.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.5ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170317141651)[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-20 10:00:34 UTC], ["updated_at", 2017-03-20 10:00:34 UTC]]
  [1m[35m (46.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 2270ebf9-97b2-4f6d-a3f9-787e8a8d4c9b) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ff2481572b8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (8.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "john@doe.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 787bc1af-bad7-48cf-a0c8-fdfe68ea68ba) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ff2480e29e0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "john@doe.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 2c57e6dc-bde1-4bfe-a93c-b9dae287e362) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ff245af6e48 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170317141651)[0m
  [1m[35m (10.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-20 10:00:59 UTC], ["updated_at", 2017-03-20 10:00:59 UTC]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "john@doe.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 53b53e99-6f27-42b8-8e10-b4a95bda6f5f) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f86609d8bc0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "john@doe.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (8.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b5364ff3-04e7-4777-975f-77516e59b150) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f8660948048 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170317141651)[0m
  [1m[35m (2.1ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-20 10:02:14 UTC], ["updated_at", 2017-03-20 10:02:14 UTC]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.6ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "john@doe.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "john@doe.com"]]
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: eca1fb97-dbf7-483c-8560-942cf1d77254) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f900ca83e20 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8da982e2-1122-4887-9323-194258115fc3) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f901086ce30 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170317141651)[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-20 10:02:24 UTC], ["updated_at", 2017-03-20 10:02:24 UTC]]
  [1m[35m (6.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 06be99aa-c6b5-4106-a905-203e2c7d9651) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f9b0c7aa0e0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "john@doe.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 918c7eb1-6b96-4ed3-9794-f10b4e3e6db4) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f9b10093910 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (4.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "john@doe.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (5.7ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to CreateInvitations (20170320153113)
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_inviter_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_inviter_id' AND type='index'
[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35mSQL (2.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES (?)[0m  [["version", "20170320153113"]]
  [1m[35m (23.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (15.8ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_inviter_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_inviter_id' AND type='index'
[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320153113)[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651);

[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-20 15:48:20 UTC], ["updated_at", 2017-03-20 15:48:20 UTC]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320153113)[0m
  [1m[35m (1.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651);

[0m
  [1m[35m (11.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-20 15:48:27 UTC], ["updated_at", 2017-03-20 15:48:27 UTC]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: bc70b391-e344-49f9-8b57-98609c3149f1) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd169fc49e0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (3.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.9ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.9ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320153113)[0m
  [1m[35m (1.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651);

[0m
  [1m[35m (1.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-20 15:49:23 UTC], ["updated_at", 2017-03-20 15:49:23 UTC]]
  [1m[35m (6.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.6ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@foo.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 44d3cdc3-4121-48e9-9687-4726401e0426) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd562402920 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (7.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@foo.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: be250158-7d93-4f74-b8c6-01fa89b0fa43) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd5623a3a38 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@foo.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: db10a352-8475-4f04-8f90-5e92f5a60971) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd56232ecd8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: cb98fc3c-156b-4c4f-aa59-367d4ca54afc) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd56231cd58 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (2.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (11.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320153113)[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651);

[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-20 15:49:46 UTC], ["updated_at", 2017-03-20 15:49:46 UTC]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@foo.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 375dd891-87f4-4613-999c-adb034dbe1e8) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe5a6624b00 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@foo.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e8600507-1b06-439d-8713-a1799beaeb1d) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe5a65ce818 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (9.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@foo.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 42d49967-4a3c-4050-96ca-9051208c29ec) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe5a8a89838 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 49a1b46b-2261-4a46-a479-89eb5210b0dc) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe5a8a79438 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320153113)[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651);

[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-20 15:50:45 UTC], ["updated_at", 2017-03-20 15:50:45 UTC]]
  [1m[35m (1.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.6ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c84f267e-a155-4a01-9582-cc35d5e147c5) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f91dc2cc390 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (8.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@foo.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4bafcb59-02e7-4f21-952b-26c0cd943f72) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f91df0b66e8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@foo.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 027c91ff-caf3-40e9-868d-41bc59f2488c) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f91dbf55040 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@foo.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6bd7348a-2567-4c1d-8fb5-812943ea4149) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f91db229290 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320153113)[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651);

[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-20 15:51:52 UTC], ["updated_at", 2017-03-20 15:51:52 UTC]]
  [1m[35m (1.4ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.9ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@foo.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c07b002a-24e1-43f9-9924-176d8cca04fc) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ff3e9820160 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@foo.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: fff9b79e-ee15-417c-9e47-14102c2fe119) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ff3e4f5aca0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@foo.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c11affcb-d6ac-4be2-806c-07d6d4f91ff3) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ff3e4f4a8f0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6f7b0049-5804-42d4-a5d3-f94f35033301) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ff3e4f1b1e0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (6.9ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (11.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (46.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320153113)[0m
  [1m[35m (1.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651);

[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-20 15:52:02 UTC], ["updated_at", 2017-03-20 15:52:02 UTC]]
  [1m[35m (1.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@foo.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ff555719-4518-4e77-b28d-6e76081cb2b8) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ff9d3df0758 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4931f6eb-bebe-4b35-ac85-ea494b75461a) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ff9d6081d08 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@foo.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: da973195-cc29-4aeb-8e71-f355b17578a2) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ff9d60585c0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@foo.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8be81c74-b630-4848-9fe6-099e8a202215) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ff9d29d97b0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ff866d8c-9662-4a1d-8a59-b7254c657f39) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ff9d3d1ad60 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 9d1e79a6-0b3b-4e65-a671-2a603d66e66d) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ff9d3ce02c8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (10.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320153113)[0m
  [1m[35m (2.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651);

[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-20 15:53:10 UTC], ["updated_at", 2017-03-20 15:53:10 UTC]]
  [1m[35m (1.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b317a672-53f9-4066-8061-f36e745ebdda) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f95c0a46c00 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@foo.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8807ceb0-47e3-46ab-98d2-eb481979daf5) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f95c08b6a98 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@foo.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 65315b45-1bd7-4310-9f92-9d270632c46c) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f95c08cdf90 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e8ce2a31-78b9-475d-8a6b-3caf685d9616) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f95c089a7f8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@foo.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: bd1b6224-b315-4a32-b1f9-35961995edd0) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f95bda79860 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: aaec42da-6c54-4e2c-97e2-92e79697e5e7) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f95c08a03d8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (27.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (22.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: fe18f909-bf78-44cd-a1f1-ac0a287956be) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fa500fa26f0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0090a7cb-68e2-43a3-a34f-fdb4b318c6a9) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fa501f674c8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (13.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (19.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a0ebd2c5-1940-43d2-be6c-7dbcc933d998) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe78eae80d0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: bf2c8005-3d06-4a41-bfde-a3f3ebfa3d4d) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe78ea3b290 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0f213132-b0ea-4976-a1f1-65535694cc65) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f98af051aa0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 22d6dc11-6b78-4e8d-b7d6-16211d42be9b) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f98ab25e540 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 5056ms (ActiveRecord: 0.2ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (4.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (11.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (12.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f7d15380-757e-4d22-923f-6d94523ebb70) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ffc1f1fb620 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: dfcd6663-32f9-4e33-a4b1-f6196bd4d3b2) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ffc1f163af0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 84fb6726-fe4c-4ae4-8cd4-ef47328bba3c) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ffc1f14b2c0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 22ms (ActiveRecord: 0.4ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 68838e5e-7375-48d1-a4c4-02c8701e69a8) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f93502926c0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8e8e981b-ccb7-47e6-ad41-25130f1af66a) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f935011af18 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 066039dc-7b6e-4d06-8e41-bcd8c995d089) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f93500b0460 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 71ms (ActiveRecord: 0.6ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ed078dfc-87f6-4f62-9ada-e06156c41ba7) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe7b709ac80 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0532bee7-7394-4331-ad1c-92d6b1d19944) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe7b37cc2a0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: bd0aa668-60f7-45a8-8639-29ef1bf9dadf) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fe7b2fbd640 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 72ms (ActiveRecord: 0.7ms)
  [1m[35m (2.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 47c745f1-bddc-4471-b0ce-2365a0142923) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fbe896a38e0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f63bff19-d1f7-4995-8a58-d3467e51f841) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fbe8b24c970 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: bec40672-a53f-4325-ad07-86fe1c50d39c) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fbe895e3450 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1f00b639-9c02-4482-ab80-612e46769542) to Async(mailers) with arguments: "AppMailer", "notify_affiliate_payment", "deliver_now", #<GlobalID:0x007fbe892aa3b0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 30ms (Views: 13.0ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.7ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e65f3477-c87f-4008-9549-20343085197d) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007faf9c5e0918 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7c4cc21b-8503-4ccd-9c75-635a31f85f27) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007faf9f341560 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 57279397-a3c1-485b-975e-5b3ebb4b8d50) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007faf9d9e30a0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 13b20d81-d601-4c92-ab1e-8a3c2396eb0a) to Async(mailers) with arguments: "AppMailer", "notify_affiliate_payment", "deliver_now", #<GlobalID:0x007faf9f27aaa0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 42ms (Views: 0.3ms | ActiveRecord: 1.1ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.7ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (9.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b1b53b86-7b84-4cd8-96ef-5fc51cbe646c) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fcb8e932220 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c2895ea8-1615-4896-b638-22ae0ac734d8) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fcb8e115588 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 308959a7-1cac-4352-b80b-742c8a28b4ac) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fcb8b11b940 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 735fea22-dad2-4166-b2dd-6e41a998c219) to Async(mailers) with arguments: "AppMailer", "notify_affiliate_payment", "deliver_now", #<GlobalID:0x007fcb8e027270 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 27ms (Views: 0.3ms | ActiveRecord: 0.9ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (11.8ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3d460144-d83c-4e2e-8eb0-f192255ec53e) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb38f349a78 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (10.7ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e8990bc8-cdba-4c0e-9b07-f75e8d143a94) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb38be58ad0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 21ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.7ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (9.9ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 92c9c082-a923-4849-a631-7f756728a9a3) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fde4691b0c8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 467dfb85-b304-4ef5-af37-333b29055bfc) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fde47069de8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 27ms (Views: 0.3ms | ActiveRecord: 0.9ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 5ec47d39-677f-4185-9147-221c2adfd02b) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fde42fdb8a8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b6faf21a-0a5c-4b9a-adb4-18a61f4b8305) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fde43778e30 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.4ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 86a12621-e7ad-4667-98b3-f35f430b8af0) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fde43729fd8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4d5b3ea4-beef-408e-8a5a-73d37e5c93d6) to Async(mailers) with arguments: "AppMailer", "notify_affiliate_payment", "deliver_now", #<GlobalID:0x007fde436f9d60 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (10.7ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320153113)[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651);

[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-21 14:28:00 UTC], ["updated_at", 2017-03-21 14:28:00 UTC]]
  [1m[35m (1.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.6ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 98775ced-1f01-4020-9879-6ed1329cd205) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe5bd9c1af8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (7.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 062bc8b9-0a01-4b53-96f6-2def0efc7731) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe5c0c5dcf0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 11ed6600-ee76-472f-9dca-a142a63a2469) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe5c0ba1668 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: eef5952a-c5da-4eef-89da-a997161381e8) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fe5bd176b78 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ea51125c-3826-4c84-b9c2-fa7de24c3e53) to Async(mailers) with arguments: "AppMailer", "notify_affiliate_payment", "deliver_now", #<GlobalID:0x007fe5c0aef698 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 19ms (Views: 0.2ms | ActiveRecord: 0.9ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c3a0e5f5-0d29-43d6-b8de-a5c06139234f) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe5bc959968 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a546827b-a116-4348-a2e5-a410a4f803c5) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe5bc946188 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.3ms | ActiveRecord: 0.7ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 18aff6d7-b85a-4959-a046-264e5dc030e0) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe5c0a66988 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8f73e40c-d90d-49ea-8614-6f23d0e3df88) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe5c0a3f270 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 721476c5-0bbc-4ea4-b8ca-0d3a34a7f89a) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fe5c10595c0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 77e4d56c-e37a-404d-88a4-40d2cc2f8c20) to Async(mailers) with arguments: "AppMailer", "notify_affiliate_payment", "deliver_now", #<GlobalID:0x007fe5c103afa8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 11ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 294ca40a-5c98-480e-a213-e32a4154f092) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe5c1009520 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0a2492c5-1fc2-4705-a140-1458adbcce33) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe5c10015f0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c6f75a50-27d8-4dd5-8b83-271219e40815) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe5c09b25a0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ffdae28f-eda8-4d6b-b769-20135e2894f8) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe5bdfb2ef8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 9f89ebf2-d15b-497b-bffb-214acaac2b3b) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe5c09927c8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 361577e8-20c2-4464-b582-d111356f330d) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd476aa8a00 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 664ae214-1fdd-4ad6-8b98-66e9d8df022c) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd4746d3e18 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0d1b4013-81c0-4c25-ab34-b45917e6bcf2) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fd4769b9428 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 55152802-f546-4d86-b95f-861a8f6ce2f7) to Async(mailers) with arguments: "AppMailer", "notify_affiliate_payment", "deliver_now", #<GlobalID:0x007fd47466a5f8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 17ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: fddf8a2d-3476-4b09-8e9d-d02872f25f36) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd4769152b0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a738d2d1-cfdd-451f-b526-3966cacf14e8) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd474650900 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6f0302bc-f50a-4c7b-8b5c-35e52f7fe01d) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fd4768b6bc0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a1f79ba9-358c-4046-b9cd-0e48434aa122) to Async(mailers) with arguments: "AppMailer", "notify_affiliate_payment", "deliver_now", #<GlobalID:0x007fd4768838b0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 8ms (Views: 0.2ms | ActiveRecord: 0.5ms)
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 21a3708d-715c-47cc-ace3-cca1310469ab) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd476838ae0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 04242b25-5455-4d49-a3a6-c8b3f635c142) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd4749492b0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f7804110-8af0-4a0e-8926-8f1de3376bff) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ffd98257310 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6929ff8b-be6c-4e43-a1b8-6878a4f0822b) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ffd98204bb0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4abb3749-5052-4e51-9929-4a69cc0a7445) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ffd981bc2c0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 19ms (ActiveRecord: 0.7ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 2f4ef5a1-e3b2-4b50-a493-a2737b7458fa) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ffd9888fb38 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 39101bac-8544-4a88-8249-8d00e1864b28) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ffd98124fd8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4de852cd-85a1-4615-a62e-918e5b06b9ca) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ffd980c1d70 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 7ms (ActiveRecord: 0.6ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 39dc0d5b-8cd2-4f2a-8b71-e6fc55c9067e) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ffd9883afc0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 832de014-96e7-40e5-a35c-308dc3435f3b) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ffd988112d8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 4ms (ActiveRecord: 0.5ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to CreateCreditTransactions (20170320162131)
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.5ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_user_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_user_id' AND type='index'
[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES (?)[0m  [["version", "20170320162131"]]
  [1m[35m (1.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_user_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_user_id' AND type='index'
[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_inviter_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_inviter_id' AND type='index'
[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f68a2052-e011-435a-9b5d-050f3e9e88fb) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ffd35a36f30 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 71ee8291-3a64-4a6e-bc4b-97a080181051) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ffd31fa1668 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8b25edcb-57dc-44e4-9bd7-d56127c68246) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ffd31f682a0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: fa39c020-5935-4e9b-86c4-b6383a493a35) to Async(mailers) with arguments: "AppMailer", "notify_affiliate_payment", "deliver_now", #<GlobalID:0x007ffd358b3528 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 34ms (Views: 0.3ms | ActiveRecord: 1.3ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: eb35d6eb-e13c-4fd3-807f-f871b18c2223) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ffd31e679f0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 61b7c7b1-091a-4936-9370-815a87c7a8c9) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ffd31e55ca0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.5ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7bd2e789-1c79-437c-af17-e4b2271697d6) to Async(mailers) with arguments: "AppMailer", "notify_affiliate_payment", "deliver_now", #<GlobalID:0x007ffd35829198 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.2ms | ActiveRecord: 0.9ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: cacc8ded-ada6-4ebf-a61f-db688a9e9a71) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ffd31d6e738 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3cbca3d8-a6d4-4669-8b96-d97c3eb92edf) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ffd31d44f28 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 537eaea3-4205-451c-a7db-206cd941777a) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ffd317d2a90 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.2ms | ActiveRecord: 1.1ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
Completed 422 Unprocessable Entity in 0ms (Views: 0.1ms | ActiveRecord: 1.1ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 71c4f835-d25d-4bce-b9b6-931706ba280b) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f858a6486a8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 611d3b4c-9aea-4c6a-82d9-c2a629eb8684) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f858a9508a0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 63267947-ba17-4ed8-946d-e840a7e18147) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f858dac7b90 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b674bc10-090c-4553-88fe-e661012ae1d2) to Async(mailers) with arguments: "AppMailer", "notify_affiliate_payment", "deliver_now", #<GlobalID:0x007f858b906a60 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 200 OK in 43ms (Views: 0.6ms | ActiveRecord: 1.8ms)
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 56cbd48e-b54a-41ae-8ab8-a2ac64d4c920) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f858d9c6de0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e5171b01-692d-4e62-9ea4-a0b6c083b6d5) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f858a570050 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 91ef205b-d4bd-45cb-b9df-c094d1323cd1) to Async(mailers) with arguments: "AppMailer", "notify_affiliate_payment", "deliver_now", #<GlobalID:0x007f858d954fd8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.2ms | ActiveRecord: 1.0ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 98e37150-2e97-4251-af3d-da39998f3fe3) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f858a4a2c18 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 886f87dd-31d5-466f-a2e6-0abd1e55ee55) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f858a491bc0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: da7c407b-d303-47b0-b6ff-410550945a31) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f858a469e40 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 8ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.7ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8b082543-3f1a-4a19-9da8-9d219802d2b1) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f9cf8227328 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4634952b-dda8-40f8-ae90-12451ae49c6d) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f9cf4f5daa0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f745a335-65f3-46e7-8bcc-9b82888b3b85) to Async(mailers) with arguments: "AppMailer", "notify_affiliate_payment", "deliver_now", #<GlobalID:0x007f9cf80b8a00 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 37ms (Views: 0.2ms | ActiveRecord: 2.0ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c9adc2c8-e828-4618-881d-e14ddfc695bd) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f9cf4e13730 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 2d4120d8-f130-4eb4-8428-fd25789f69ca) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f9cf4dfb478 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0c1975c2-1396-465b-be6c-ac9e0aaef675) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f9cf58b9608 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.4ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 14ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a8221a5d-93e6-41d7-a848-4e9c9867a8b7) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f9cf47c3f38 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7deb70c8-d8c9-4cdb-84f1-9bdd23beb350) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f9cf4dc2128 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c2503fca-db41-45dd-a995-5f7a324aa469) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f9cf4d9b708 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 822244aa-c28e-48b5-8d3f-c15c7d58f13e) to Async(mailers) with arguments: "AppMailer", "notify_affiliate_payment", "deliver_now", #<GlobalID:0x007f9cf477beb8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 11ms (Views: 0.3ms | ActiveRecord: 0.7ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 57bb23a2-e052-4d6e-adab-630f7b25f2c8) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f88a79235d8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b4f542ba-e50c-4860-bb49-37dc03781797) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f88a37ee5e0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3c925660-80e7-44bf-87c3-0ed3a32ce55c) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f88a3b393d0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 16256132-b402-4dd1-9955-645156978244) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f88a51abb90 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3ecd2853-e078-45c4-80f5-2d359104468c) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f88a3770640 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 37e62b46-dd9b-4d65-ada9-b69feee4cafc) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f88a51699c0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 92aebe42-0fec-472a-a0c8-dd84ac67569e) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f88a3ed2988 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7ea7ab24-6430-4f63-a610-ee988e062acc) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f88a3711118 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7f9005da-537a-492f-a215-f0e748ce5e68) to Async(mailers) with arguments: "AppMailer", "notify_affiliate_payment", "deliver_now", #<GlobalID:0x007f88a3e59e98 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 31ms (Views: 0.3ms | ActiveRecord: 1.8ms)
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 5f8eaddc-635e-48b8-b6d5-57bd4d6919a1) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f88a5118c28 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 5fa07768-b03a-4026-8505-647e0690474c) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f88a363d160 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1f678b30-d462-4898-a07c-9248aa166a13) to Async(mailers) with arguments: "AppMailer", "notify_affiliate_payment", "deliver_now", #<GlobalID:0x007f88a36040e0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.2ms | ActiveRecord: 0.9ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d7b2f285-d517-448d-a68f-7876cd540bfc) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f88a35bd5c8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a04f8621-05f3-47f0-b451-3f5367502e15) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f88a3584ea8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4c8d6fce-7c18-43a7-8842-c62c58558b83) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f88a3d399f0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 11ms (Views: 0.2ms | ActiveRecord: 1.0ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 749d5e1b-7c17-413c-a42a-8a008408a849) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f88a34b5090 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4d9ee51f-626d-4d6a-8dc2-0b81a75f9e1e) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fad4f9bf790 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1a6237b9-c3f5-4c8a-b26d-b0d136af5a29) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fad4ea98398 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1d2dc84f-d114-4453-8514-49e0a1a7c989) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fad4f8e0e50 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (4.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 01cf590d-76d4-4e86-88c0-7c4a08ceb81f) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fad4ea4e630 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ec123bfb-9767-4bcc-8360-e77e523b56a0) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fad4ea2c828 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c0051bb8-ae2d-4f58-82b1-b7cf1d032a67) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fad4f888110 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f2c09924-2973-4891-bf83-35f774f873b0) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fad4f85bc78 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: df280284-f935-4801-bb2d-53b301953f67) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fad4f801840 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 27bedcc1-b67b-432c-8885-f3f08cccc477) to Async(mailers) with arguments: "AppMailer", "notify_affiliate_payment", "deliver_now", #<GlobalID:0x007fad4af008a8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 28ms (Views: 0.2ms | ActiveRecord: 1.2ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 82acff53-c2c2-4e3d-a46c-b3a8cb3335e3) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fad4ad88f98 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 23e61fb0-c281-4bc8-bc72-11e95ba268a7) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fad4ad63360 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e2439417-b71d-467d-b7c2-29dbaf5a2191) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fad4b131758 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (2.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 693c839f-b8c9-4ee1-91a2-9e0f4db0554e) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fad4b0b9c58 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: bdb017b4-fad4-453d-87cb-ba49ddf0251f) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fad4e9d34a8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d0dfe731-6474-49da-b0d1-283d4a6120f5) to Async(mailers) with arguments: "AppMailer", "notify_affiliate_payment", "deliver_now", #<GlobalID:0x007fad4e971c08 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 8ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0ad07065-9f26-43b3-869e-2462439b0ab5) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fad4e8f3920 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ed41f4c3-bfad-49eb-86a5-53f9f76160f0) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ff8bd09aa20 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: dc711720-59d1-4c5f-8c0f-a4d776c4ae93) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ff8b961e9a0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 606ae38d-3f19-438d-acd6-16d6e0eef643) to Async(mailers) with arguments: "AppMailer", "notify_affiliate_payment", "deliver_now", #<GlobalID:0x007ff8b95a9830 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 24ms (Views: 0.3ms | ActiveRecord: 1.4ms)
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ce5c006b-c9c1-4f79-8be4-f91d2fa32b7b) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ff8b9e3e590 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 5d83b32a-c627-4749-9cc5-9d3bac4caa6a) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ff8b9e15fc8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 34d977b7-b112-48c8-b713-d74df2085387) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ff8b9560e00 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ddd00916-c288-49bc-b7b0-2076c5b67a5f) to Async(mailers) with arguments: "AppMailer", "notify_affiliate_payment", "deliver_now", #<GlobalID:0x007ff8b8b53a20 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.3ms | ActiveRecord: 0.9ms)
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (1.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 86a1a0ff-b9d8-4f5f-8d05-81f9248cbeaa) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ff8b9bcab38 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3b54056d-18dc-44dc-8650-1bf53f50b6a7) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ff8b9bab4e0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.4ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8f4e84df-ac87-432b-990c-c1009f3e1a26) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ff8b9b60148 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a4f902ef-bd8b-4f08-a56a-acdcc4743b33) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ff8b9a51e28 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 27d032f8-94ba-4586-bcb9-357bbd233cd3) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ff8b89faca0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: fda06569-ca44-4c11-9937-d1c1c06f5248) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ff8b9970220 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3e877689-a039-4047-8b87-116e1cd4b40d) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ff8b9224390 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d75793cf-dabb-4bdd-a210-8a51a2befdd9) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ff8b9097a40 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a9fbb639-953a-4b1f-b908-c4dd87d689d0) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ff8b9056e00 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 056be464-6ea9-4818-af9a-22f81cecc97a) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f852c758218 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: cd7d9567-abb2-4fd4-a2cf-d175ec12551c) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f852d750d00 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a73c9986-9daa-498e-bc93-4be92ed07033) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f852d721b40 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ac076c70-cd12-4934-835c-4bc612708e0d) to Async(mailers) with arguments: "AppMailer", "notify_affiliate_payment", "deliver_now", #<GlobalID:0x007f852d63e390 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 25ms (Views: 0.3ms | ActiveRecord: 1.1ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: eff58e1c-f55e-4067-931e-001ba073a69e) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f852d614a18 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d377db90-928c-439a-932e-6feefaabfe26) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f852d5ec018 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a41d1adc-30bf-49de-b4cc-928fb4c9f0ba) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f852c5ba5f0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 8ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 92c36485-e10c-4310-bc7b-5cb6246f32b1) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f852c9eaa08 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4d8ed6cb-d374-4497-b771-63dc877c1c44) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f852d54c798 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7080a92e-0d3e-4a6a-a91f-c0b2622c4ec7) to Async(mailers) with arguments: "AppMailer", "notify_affiliate_payment", "deliver_now", #<GlobalID:0x007f852c99b2c8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 8ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e035c29c-bbb7-46cb-b3c0-f21eed285001) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f852c4aa020 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: de091f7e-447c-4082-9f55-cab119d093b6) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f852c410560 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7734a664-6b3c-4d96-abab-7120ac8f58bb) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f852d4cd7b8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1b6f7aaa-054c-4fcf-bfa6-4bf27046fc70) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f852c3bac00 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f3e1333f-31de-46e7-b743-4e6689777ac4) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f852c372978 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 374cc939-2400-40cc-ad6e-b97c1e0f9865) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f852d3e6a20 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (3.7ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 289b99ba-cf4c-4cb9-9e40-365630e903e8) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fa29cf8b470 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 5f1692aa-4695-4c2f-ad8a-f1ab20be0dfc) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fa29cee1d30 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6bfe8063-b00c-47ed-9cdc-1721cb0c3e24) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fa29c7e09a0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: fa30a7a8-3274-4268-ab90-5a1b03927ff3) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fa29ce92e60 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 35efd8c4-3629-4cc1-8507-e33c14ec816d) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fa29ce730b0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f3970c49-0397-4ac6-b171-c7a01d8fe2c8) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fa29ce05a10 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 03e51e87-c83d-4ba8-9b16-b8a0ab7f1895) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fa29c6f5928 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1dca768e-c7cb-43a2-9b98-d1dd4246afc9) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fa29e149608 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f3709cb6-2e46-4d8c-95de-70fd22392d91) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fa29d16b2b8 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 54ms (Views: 0.3ms | ActiveRecord: 2.1ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4d400362-4888-40d7-bb3b-00b40d9b4afe) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fa29cd34a50 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7476d036-68d0-4164-b34e-1c410e8c9117) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fa29ccfcd08 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6a57ad12-ca6a-4be9-a694-161ac9a6dc5e) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fa29ccb7578 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6650166d-ea56-450d-94d1-5eca32738cba) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fa29cc4cde0 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 12ms (Views: 0.2ms | ActiveRecord: 0.9ms)
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 11d4c1b4-b635-40ff-9537-b7f54d302e4a) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fa29d12b988 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 72baa959-4841-40ba-81b4-fe0e95a6a076) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fa29cbcdb30 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: aeb6c0f4-0c42-4086-b182-bdffa18c2cbc) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fa29cb8fc40 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6c20a004-1f46-4d4e-8cc4-839bb8eb8771) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fa29cb6f2b0 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 200 OK in 13ms (Views: 0.2ms | ActiveRecord: 1.0ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d823edd3-3a8f-4af7-894f-56bd6686c0dc) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe65a754390 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 2a6ebca9-58a3-4820-ac57-63c8a0b1ef6d) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe65a6c77b0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e15e68fb-f011-4601-9eac-3947f2bd9646) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe659c6f6c8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (3.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 108912d5-6ccd-45f4-bd3b-d21f9f8a4e49) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe65a674bf0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: da987f6b-5b0c-4fbe-a33e-004c8a5280ad) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe659c64db8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d5753fa3-9540-4d9c-ad1f-b86b778dd296) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe65a60cb40 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b2fc61b3-9355-478b-8695-bb3e72d4ace6) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe65a5ed5d8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d9294688-04a3-4255-b6b5-0a6b4efb6a74) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fe65a546738 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 31ms (Views: 0.2ms | ActiveRecord: 1.7ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3509ddfa-1923-4c0d-9d30-cb019f53f7c9) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe659b67c58 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e2028590-19fd-4005-94c1-83e704f012d1) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe65a3b81a0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0acef22c-6e9f-4b51-ad31-048c086dd7b0) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fe658a40538 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 12ms (Views: 0.2ms | ActiveRecord: 1.0ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7bd293f2-7d53-4f5f-bbd9-da1ef000bb73) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe65a459eb0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 57b3f6c3-bbf9-4c65-b603-420ea2709f36) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe65a4219c0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1c590c08-65c0-48f7-a249-75a3c492c085) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fe65a390150 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3cc4c217-38f5-476e-8d7a-7160303942fd) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fe6592b21f8 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.3ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 13ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 9383ec72-1054-4963-a19e-401685cd491f) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe65a2f1230 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3cc05ca1-c681-49bb-848b-3c7b11382295) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fc373ee28c8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3ae1ff9a-4433-40f3-8eb8-10fa602f1210) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fc373e209a8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a7a14dda-92d2-4d33-a6da-81d26e5a9c90) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fc3727f0228 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 26ms (Views: 0.3ms | ActiveRecord: 1.3ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 37618fc6-7999-4185-a3bb-cd5681dfc2c3) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fc37276b898 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: af8fb616-85c1-4255-82f5-27cbaf9ad655) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fc373d5b978 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 027ccc4f-36cd-42ce-94e3-f4245366cec3) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fc37274aaa8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3d2cbce7-ba0e-4a76-98ea-084db16c2210) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fc372711820 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 12ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3025f2b1-5533-4572-a95b-4b190c3e65b8) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fc3726c0a38 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3129f8f0-418c-4941-929f-4559c8e2b4a0) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fc372697020 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 2b62e42d-b24f-4df1-8f63-61d0ecf342da) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fc372928cd0 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (1.9ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 96de2f8f-9f30-477e-a7f3-fd927bbed3ff) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fc37260c880 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3eee7472-a054-4d26-9301-215b4c4fb9ad) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fc373c509c0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 00b2056e-18a7-4f49-a703-35a82a1645e1) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fc3725c63a8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6a720772-9d57-4e5c-b839-4eabfe1e9d1e) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fc3725965e0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 47af8680-def7-45c9-9237-3021dd4cb714) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fc373bb06c8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: eb3908da-15e4-4aad-a793-e2530173ecde) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fc373b4a760 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4844d502-c09e-463d-b0fa-9c33dab68ef8) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fc372496960 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 90bf3f65-a51e-4b98-bcd8-68ccc30c1e03) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fc372455f78 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: cc7928b0-7e55-40d7-b012-ae3fa5f609d1) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fc3723f6668 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 51872242-68d2-4cd8-8e6c-814d9bc9cd0b) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fc373abe170 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 397beed6-7271-48ad-b3e7-d297ad80e9b6) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f853cf8c028 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 46227494-0ee0-47d5-ac7e-aa5d6977ac91) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f853ceb7eb8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 426598ec-78f0-418a-b57a-c8a04f68de36) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f853ce8f648 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (3.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e7efdbe2-c44f-4558-8d34-5946d98fe45f) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f853ce5ecf0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c2b276b9-e61e-481c-bda0-09400cd4dd00) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f853e213b10 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0597ff09-4f47-4e51-b441-125a83102a34) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f853d4b2980 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d03fb633-1247-481e-8b95-77678b3a40ca) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f853ce0ecc8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1291e688-6066-4514-8746-681a9b591781) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f853cded690 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ab0b7eee-e0ca-43a8-9519-fe45a88e5d1d) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007f853e11ca40 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 23ms (Views: 0.3ms | ActiveRecord: 1.6ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a8a30928-7c29-4157-be63-d6e1299203cc) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f853e105f48 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c94b371f-0718-4d2e-922c-3df10e79d615) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f853cc7a8d0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 61a48e1d-f7d7-472e-987e-5c11cd687c30) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f853cc439e8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 28b598a5-d84a-425e-8641-15479a832ec8) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007f853e0f6110 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 96f7c238-5d3e-4def-a208-3675018daf61) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f853e0c65f0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: fbaec554-ab24-4cbb-87b0-dff8ab8cfde6) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f853c24e370 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 66390bcf-f4d3-4a97-98a6-6558270b4698) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f853d2986b8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 104cfd6d-c53e-4c03-abdd-560153c457d2) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f853cb31d48 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 753d570d-da62-4b42-aa90-191f108a78ac) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f853d212c20 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a21e9552-5edf-41fc-9f4e-dedcc7e0dbd7) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f853ca2b908 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6623d062-2160-4fe2-ac55-0cd7c3470552) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f853c91c0d0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1899f3a8-e21e-4c42-93cf-fd94ef83166f) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb7527e9a80 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e6d4af21-0e64-46e4-8a10-9d0bea36e2e4) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb752738758 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 87cf1ac4-4081-4a3b-a2fa-a2148047b253) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb7526f16c8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (1.9ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 40625ad0-1f6d-4de1-9455-48ae47612011) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb7531e8b58 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b6a996e6-5bd2-4cc0-a62a-6e5485a3bfd2) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb7531c0ab8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1513d423-5725-4436-a965-db81450c536e) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb751602ee8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 536c7782-1468-4a64-b944-34d0a8d5b939) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb75268aec8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 620c383d-1bf4-4a85-94ab-9f352781d2f8) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fb75259b918 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 26ms (Views: 0.3ms | ActiveRecord: 1.9ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6682ee23-1d52-48aa-9b0c-fa78088631ec) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb751a58920 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4d85dfb4-d803-4957-8c70-d0e248750152) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb75253dbb0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ffce0fc2-b06a-4c30-bad1-809acdb3b194) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb7519f4fd8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0bb3131c-5b03-4bdb-af20-91e0cab7891e) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fb7524cf840 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 12ms (Views: 0.2ms | ActiveRecord: 1.1ms)
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4e614e52-9a64-4910-8400-4014c6354264) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb75248e610 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 93cb952b-5beb-40f0-b8da-fdca2ce6208a) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb75246e0e0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 12ded623-a112-4dfb-94c3-86abbf5eedfb) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb752407548 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 5e1681bf-9098-4eb7-b226-059c7263baca) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb7531205b8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a5f80fff-56fb-4b4a-a8c5-67211b638ea3) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb751964ac8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: eb71bd50-feba-4c58-a2cd-f5d701afddf2) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb75136b3d8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 21dfce5f-b044-4eac-a478-c0a9c4c8ee93) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb7530d2db8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: beeaf96e-bb33-46de-8ea0-e1454b468e00) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb7522976e0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 689004ae-30bc-4563-944a-35dd23b3be26) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe2847d3d90 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 06051ef9-fd8c-4b5d-aaa8-f4674987a0ee) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe284744a00 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c00bd2e4-a9af-454f-a422-463f7d991cff) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe28591ddd0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 015c78a2-4ad2-4ebf-a057-54adc0d5b736) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fe2859143c0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a8b35ad3-17b6-4f9c-b0a2-8f88836cdfbb) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fe2845e64d8 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 28ms (Views: 0.3ms | ActiveRecord: 1.6ms)
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6f524630-cebc-4afb-bd4c-e21b9e4a2251) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe2845b5590 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4f601dff-09e8-4a8e-ab48-6891fee2d65d) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe283de3380 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 82b754eb-9911-4cae-b462-b3f6d0600af3) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fe284560720 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.2ms | ActiveRecord: 1.0ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b461260b-ef53-4abe-8689-2e52c70aa4aa) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe283d6b330 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7514a12c-1220-43e1-87e5-db2567460897) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe2844b1ba8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 5188b7ed-392c-473f-8233-d904e08241f9) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fe284491010 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.3ms | ActiveRecord: 0.7ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e35d2ca5-8e45-4e98-8a2c-47200772bd71) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe283caad88 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f07529c4-b973-406a-b1ef-3f854ade00d8) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe2848f3ab8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f5af0972-936f-4f2e-8f28-35718824ef77) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fe28586eec0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 8ms (ActiveRecord: 0.7ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 88adaf59-20ba-4147-ab55-0eea9da3214b) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe28419ff50 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 2a856ec8-ba02-446a-90eb-bb1b4336c768) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe284164bf8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: cfbacdda-cf64-4e76-b483-b6dff534914b) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fe284837368 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 14ms (ActiveRecord: 0.5ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 36cf03d9-e5d9-4ff7-8497-ff392b20b4e2) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe288167ed0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 87230abf-31d1-4373-a98c-7ab82ca2fbfc) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe2889aa5c0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 77fdde38-0636-4a99-93eb-617222df5f75) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe284ae2158 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 30c74564-f998-4566-8818-8f9f0fd7197a) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe288991750 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: dc76eaed-4cae-4830-80ce-65522cc7c13c) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe288962270 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 5860ce96-a16f-4fc1-9cbd-418f4961e9b8) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd880222350 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c9274c48-9fef-4dbd-bf98-843a7e93aef4) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd88012b938 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a9a56f7b-8646-4119-90a9-865db637a4c7) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fd87e24ab68 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 29ms (Views: 0.6ms | ActiveRecord: 1.6ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1af395fc-84e9-4f25-aa9e-9aefda7045b3) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd880052430 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 03110290-41a9-42f9-a927-e405c12277f6) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd88002a2a0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8e600f00-005b-4c55-9155-dde28a7bd0f7) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fd8800112f0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ce1509de-a64b-48c5-8c5d-8ee88c5e68f2) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fd87e1cb188 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 13ms (Views: 0.4ms | ActiveRecord: 1.0ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ed1cd699-7618-4be6-8a60-8919b2757d95) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd87db76f08 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a689e665-be20-4925-a4da-5113462542f1) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd87e1a9128 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.5ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1b978d9b-37de-44f1-9e96-30b284849cf3) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fd87e19b5f0 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.2ms | ActiveRecord: 0.9ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4dbf21ad-8545-4779-b1ea-39b91c3abb8d) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd87e181998 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a0f2f737-6577-4a1b-9f13-d7ac4e4b37bd) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd87c1188c8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.6ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c719b168-a39c-418f-878f-ab0d4131db97) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fd87cd41d98 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 14ms (ActiveRecord: 1.0ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 05609caf-010d-43c9-9bb2-1b332841ea31) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd87d9d4e20 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b9d27bd3-0a80-4599-a65a-60f6cd4f353a) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd87ccd04b8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b746f3d3-48c1-417e-a038-430e87c43b4d) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fd87d96fed0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 7ms (ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: fe5e974f-1d34-433f-befb-7afee58c0981) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd87de038c0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b5885eeb-b669-402f-949e-ad9046233883) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd87e3ae428 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6f752534-a225-4dca-995f-5a789399cda6) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd8803ab690 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 504b2b6b-b3d9-433e-9d0d-e56961828c3d) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd87ddf8038 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a8d5d7ea-55b6-4899-b83c-fd3debfc9f3b) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd8803a0538 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 66c4aed7-33cd-453a-b1b9-781aef96bf19) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd880313f98 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1950270c-fbb4-4121-82ea-ffe9657c6324) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fa899f846e0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1293256d-9909-4ab0-a059-c64bed3b9b9d) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fa89ad51390 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 10889d2c-8a85-4888-bae9-52a21f7d2097) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fa899ed2b20 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e2d4f7d8-f1bd-4088-9e2f-4653125ea4f5) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fa899e4a590 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7b2b40ba-a760-468f-8f06-2368d22b51f1) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fa89a388660 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.7ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 24bd1cc1-8d19-4333-aafa-535abf588483) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fa899dcd6f8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 2954ad29-b7e5-46f5-9b0e-11fc65700c56) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fa89ad11448 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 055370ae-f07d-416f-bac4-1ce2f2940420) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fa89ac7a598 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 26ms (Views: 0.3ms | ActiveRecord: 1.2ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ec1693f8-ae73-4199-b1e9-2e869ef9f7b6) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fa899c7df00 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8a14a0b4-c46f-40b7-9c40-117e8c01dcf6) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fa899c6e168 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 2bce020e-52c5-4df1-bb72-ef8256a3685f) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fa89abe5498 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 2ce897d4-0423-4175-a1da-3865eebb6f98) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fa89abaf6e0 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f57cedfd-1ced-46ac-a6a4-22fb05282709) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fa89ab76610 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ca535b5f-5f68-448c-9ed2-93881a60dd6c) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fa899bcc278 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 82765ced-570b-4687-a8a7-6048f0c45ed8) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fa89aaff060 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ce2dc7e0-621d-4390-9e3c-28978b60a88b) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fa89aa5fec0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d1ebacd7-1e4b-4b9a-9e9a-7d27d018df03) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd892744880 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (9.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3b9ae16f-fc29-474d-a011-1f5a111dce84) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd890f76f00 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b6720a15-08dc-46c6-9ff2-bdcbd87f0e9e) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd8919849c0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: fcbeaf78-8079-459c-9288-81c6288aea1d) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd8926a71e8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.7ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c03fee3a-706d-4600-9b2f-3c624ca79e7f) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007faee9ff1348 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 07cb6edb-b4da-4c2c-8621-fd56a49f35f8) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007faeea217d48 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3adcdeca-fba9-4610-b738-39a0ee715822) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007faee8e5da50 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 46cb6078-c95c-485a-b4e7-5cb5ca0d5b80) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007faee8e2ed68 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 993d3c2f-46f1-4b44-bf36-092ce831ddf2) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007faee9f1c440 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 20cec309-a639-449f-8997-3d49ecb941d5) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007faee8de29e0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d6b71290-6b7d-4666-bfbd-b2c054fe2de7) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007faee8ddbb90 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f5f30cac-a7e6-490b-a423-84166e87cc7c) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007faee921e6a8 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 22ms (Views: 0.3ms | ActiveRecord: 1.4ms)
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 039f1e0f-fcaf-4761-ba9c-9127c003e64c) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007faeea1c5c50 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 01a206c7-b18a-4dfb-b8d5-c0a8a59954a6) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007faee920e370 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: fe95bfdc-d188-4550-8c56-2c4ec37e14f2) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007faeea196b08 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 11ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c5fde9cb-0d71-4d4b-b4a1-9ad01db6fd70) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007faee9d6a930 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c0a7164b-e936-40e4-a31e-4e8e6f95dfca) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007faee91dd748 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6be344a9-2f41-4a30-9f45-0837dfefada2) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007faee9185278 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 45a06331-c137-4068-83bd-f8c400f1ca11) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007faee9cf3ee8 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 11ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 21aac485-ea50-4732-9aa0-ee5d49a7b28c) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007faee8b5b230 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 81c09d4c-974b-41ff-9af8-26fa8a9d7ae5) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fed250bb098 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a01d44c9-0a0b-4b75-95f0-d28690e68b58) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fed21229898 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 42c0e750-561b-478d-a5ed-81df944a189f) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fed212238f8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (4.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ec45ee7b-2299-44f0-b0ec-910dc09922ea) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fed20f6f0d0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 606d5247-8fc9-4839-9a87-046f2129edbe) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fed210b40d0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 548c8034-8efc-4eac-a9de-a3b2c9f6a15c) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fed20f2dea0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8e06440e-a871-4954-a800-e8c73de9c559) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fed20f27870 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: af0f4452-9a2c-4366-9e60-92e67674b67a) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fed22c724e8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 231e9b69-8fa3-43e8-81b3-c7cf0b2ca9f4) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fed20ecddc0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 22ms (Views: 0.4ms | ActiveRecord: 1.4ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: deb7368c-c781-4c44-8623-df19de0db628) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fed20dd7c40 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: bfe3d8af-3b3a-4fa5-9ae5-73addf309bab) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fed2114f238 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 38482190-2662-400f-a743-b3326c9d5731) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fed20d87880 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 88b319b9-9641-4404-94bf-7c860626cc7d) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fed20d2f720 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mCreditTransaction Load (0.4ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 889b2b3c-59e4-4775-87ba-289154d2d82b) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fed2112e8f8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e4a009f6-ea0f-46fc-8165-563cb5ffe2b2) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fed20c9c420 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7166b982-588e-442e-a2b3-d368fe750b7b) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fed22aa20f0 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 200 OK in 12ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f6863695-876a-4e54-a58f-ab6d5c6075f1) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fed20bbc500 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0dd41dbe-43a8-4a81-aa2e-4a50c2d0dbcb) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fed20b8eba0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 729e1818-0e0b-4673-89e8-69beb2f67a63) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fed213d3130 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 7ms (ActiveRecord: 0.6ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: bedf7114-eb09-4dc4-99dd-8055db5a98c5) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd903779168 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7ea7076c-101a-469b-a228-f4690eeba4b0) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd9036a31a8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c10531fe-f6b0-49f0-9a41-aa9336cc3ccf) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd903d99f20 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 885b76cd-72a8-44d5-ad84-10239421d97d) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd903671568 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1fff533e-759a-4909-8475-df5d752a83d0) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd90364a328 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a665d659-379b-4f86-a6d0-b578b532ec8f) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd90362a280 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3403059c-4290-4dda-af1d-2dd51ede2799) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd9036137d8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.4ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0d61a243-82d9-4171-bd37-4d4ecc2d72d8) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fd90419ddb0 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 26ms (Views: 0.3ms | ActiveRecord: 1.7ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 808afc10-8ca5-4150-a73c-03dc89e430e8) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd9033ab838 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b1e2f97c-aaca-40f8-aefc-3c49badfc0da) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd904a83b28 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 58194836-affe-4e12-a570-5fd3be2fe3e3) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fd9034c1d08 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3b685ca7-d2f9-4494-beb3-d2e858de2064) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd90410fd58 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4149ffc4-e3bf-4955-8c37-7fb93fbaf067) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd903422640 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ccba7250-658e-40a6-bcc3-48ce7e1d77dc) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fd9049fa878 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d2ad0635-2e77-4e3d-a44c-2e2f44207ab9) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fd904988908 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 12ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 551ac39c-2ea9-4eb3-af2b-f607325b2100) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd903b95968 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 5cbce538-8e97-463d-9caf-d264cb6b5416) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd903b65650 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4b20e8ab-534e-4e97-acf3-213eae2befec) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fd90331ae00 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 8ms (ActiveRecord: 0.7ms)
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (5.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8ab507f9-ef8a-4672-b1f1-ce0379cdc4d5) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd9036c9240 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.7ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b280157a-7c36-429a-933f-d2da8759eb75) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fcacbed8490 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.9ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 38ab5004-b265-4238-b1fb-20d79ea1e403) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fcacbe01af8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e422e95f-a0f8-4039-b632-b9e1d9176330) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fcacbdecbd0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e0336eb3-9553-47b0-80cd-85a23d979b9b) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fcacd656798 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (6.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d1477464-4c09-41e9-97cb-4e0b131e7058) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fcacbd9ed18 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0c527a15-c4a1-44de-b64f-47cb47181218) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fcacd627100 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3db6863b-dd97-410c-9b51-b37a322dbcac) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fcacd6148e8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.5ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 46e936da-7862-4a1b-9ed6-6c6375d72ee8) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fcacd5ffa38 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 23ms (Views: 0.3ms | ActiveRecord: 2.0ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 5a0dafce-caa7-4ae0-b1f1-94e5114f4ea6) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fcacd566360 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: cdc4c008-3310-479d-ba15-7977311d7589) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fcacd4963e0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7c6ce353-a3be-4778-9411-91e512b3455a) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fcacd54ff20 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8c65f866-1013-462a-b992-db2ea58bd779) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fcacd526418 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 200 OK in 10ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 70eec9d7-c8f6-44bc-b0a4-353be90366c3) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fcacbc08f08 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 9717ac77-330f-45be-9de0-3e5ffd2fabf7) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fcacd4bc4f0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3df74dde-4883-4ab7-969b-d38db42540d9) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fcacd3f7ec0 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
Completed 200 OK in 7ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 9d42bb7d-1455-49c9-b48f-fa1921f7c0b9) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fcacd385de8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8ac4a50b-c190-4d92-88a2-a189ed5e8980) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fcacd334998 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4ff789d3-0212-4d17-8ee5-3abfb7c61c68) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fcacb983080 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 8ms (ActiveRecord: 0.7ms)
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 917ec96d-e601-47c8-a09a-4d97e5410e0b) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fcacc289fa8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.7ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b8767d3b-c7eb-4f29-b5e5-622ab78eeb86) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fdc6c339cf8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f5756dc9-dd3f-44b1-a501-6e8b89f62b9c) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fdc6d63cf80 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c17caf82-810e-4927-a429-af8547f1d74c) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fdc6bef4ee0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (6.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6d1af8c9-50de-4d20-966a-c39daa2fc3dd) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fdc6beb53a8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e17c90a3-151e-4157-a8da-8f300253024a) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fdc6c3124a0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 5cfbe6f7-adcb-4898-ab51-66c33dd68cbb) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fdc6c97b058 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c7752698-4a4d-4640-b056-4656f79956de) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fdc6be307e8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 2ca49503-dfc6-427b-93bc-e295da16ab6f) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fdc6c299e60 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ad5e8dfe-3dd8-45a8-b00f-7d3caed73b2d) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fdc6bddaeb0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 22ms (Views: 0.3ms | ActiveRecord: 1.2ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ce975e47-69f8-4c63-aaad-46c6d3f10839) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fdc6c230938 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: dd8f2da4-2306-41ab-8b83-f7da7149b729) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fdc6bd1c0c8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.4ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a1dd1316-563f-4d97-aabb-a256563c3ffa) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fdc6bcdf768 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
Completed 200 OK in 9ms (Views: 0.2ms | ActiveRecord: 1.6ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7f9b56c2-fc98-4bc5-a245-1619d34e89f7) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fdc6bc8fba0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a8eeaa84-6780-4412-aa23-30ed185f31db) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fdc6bc3e958 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 99320ef9-2beb-4140-8804-9baee7d5154f) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fdc6c178798 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ac8c146d-583e-4e63-8eee-249970454d1f) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fdc6c162858 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 200 OK in 15ms (Views: 0.2ms | ActiveRecord: 1.2ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 95c8a9da-a81d-4059-9a1c-ddb935766679) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fdc6bb94a98 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 381363ee-ed1a-4587-9d27-95d591bb6ad9) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fdc6c8aaf20 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a64e717c-39ee-472a-8c1b-3e9331323bab) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fdc700e1f60 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 8ms (ActiveRecord: 0.7ms)
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.7ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d5b3c212-5ed7-4f4a-9c68-79c069899734) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb7c6868e10 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 5080a2de-8ab7-4dfc-9c43-ba2e30a44ddf) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb7c2d75470 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7ed62df7-8dd6-42a1-8ef8-a376e46a61e0) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb7c4233b00 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 83b9b53d-84f0-491b-b8c8-0a84c18abee7) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb7c27812f8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6678d8bd-ae04-4b11-9e9b-1a5dc8aefed1) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fb7c26c3c80 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
Completed 200 OK in 28ms (Views: 0.3ms | ActiveRecord: 1.4ms)
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e74d7e03-4709-4476-ad22-56cbe8baf289) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb7c26c97e8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: db6e68fb-3e85-4260-aaae-401bdd4d813f) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb7c417ac40 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.4ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 046c0a25-e3b3-47bb-8811-03d56c5055b7) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb7c2c10d28 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.3ms | ActiveRecord: 0.8ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: fc123b10-2d51-4e56-8873-d88108df048b) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb7c264f600 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b96a6d9b-0a54-48cd-af9b-3d87ee089ee2) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb7c3175318 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 136aa43d-e71a-43cf-b440-126c76b30b27) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fb7c2b22da8 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
Completed 200 OK in 7ms (Views: 0.2ms | ActiveRecord: 1.0ms)
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 5a9fe492-34fe-4f95-8560-3e39225e4ca9) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb7c258f8f0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 716a8d74-efec-4e4d-906d-7f48c91fd668) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb7c2567a58 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: bc505fe5-4099-407c-a098-6166a3ad50bb) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb7c23b4e90 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 8ms (ActiveRecord: 0.6ms)
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 922d76be-ddde-4453-a5da-705e0331118a) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb7c2f37a88 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0443e6f0-ce47-471f-855f-bdb2458bf1c3) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb7c2f0c7e8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 83281fad-e15a-49b9-aafb-73248a2cba68) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb7c69e27f0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 9ms (ActiveRecord: 0.6ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 330b49e3-99a0-488c-a253-f69946b9348f) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb7c2ee5850 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7d1562fa-9de1-4205-b70a-2b4b022931fb) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb7c4370388 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 693d759c-dadc-4595-8715-3bb44ae997d3) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb7c2ecc558 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 37b2bec6-b7a2-4de8-98c3-9f52f7f35248) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb7c2eaf908 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0f06f333-d63d-48e2-a59f-b0993d2eb281) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb7c2e97f38 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-03-22 08:53:46 UTC], ["updated_at", 2017-03-22 08:53:46 UTC]]
  [1m[35m (4.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.7ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6a92056a-334c-453e-aa48-f822ba215056) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f8ec3b0d7f0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (9.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2902d8e1-5a9b-4fdd-86ca-e5a569cf6f9e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2902d8e1-5a9b-4fdd-86ca-e5a569cf6f9e@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 00122e96-9fde-442e-892b-7fd33187e6b4) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f8ec4b81c58 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 44f36e18-921c-4c8f-aa27-bd736eedb0a6) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f8ec78bff80 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3ab38926-eff5-4a09-84c6-b4cdfac73401@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3ab38926-eff5-4a09-84c6-b4cdfac73401@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 803ede8a-02c2-4f13-b9bc-5686b6218911) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f8ec371f558 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-4516d6d9-4731-4b0a-a40c-d97aa520075d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-4516d6d9-4731-4b0a-a40c-d97aa520075d@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8bd3901e-8f9e-448e-b3b2-06bff47c5e9f) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f8ec3ac8da8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b584104c-3bf2-46e1-91b5-4f0b1f37eacc) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f8ec786b868 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.5ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ee33a37b-0eba-4e88-b358-19101ebfef9a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ee33a37b-0eba-4e88-b358-19101ebfef9a@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 57e157f4-00fc-4000-a2ff-00fa0648b646) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f8ec4b53b28 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1b32f8c7-0f3b-4637-9c41-e013c746fe7f) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f8ec7821b00 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 618e00fa-feb8-44d4-9678-eb6908629a5d) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f8ec3a8f990 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 17254ce5-d5a0-4383-8ef5-b9e63928d788) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007f8ec47a9388 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
Completed 200 OK in 31ms (Views: 0.3ms | ActiveRecord: 1.3ms)
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-bcfe02ca-bf82-44a2-b4a5-55c787ae37bd@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-bcfe02ca-bf82-44a2-b4a5-55c787ae37bd@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c4cb5275-6443-460d-9c8d-bc6567326ded) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f8ec36382c0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 89b93ed0-d11b-4a26-b964-0bdb8f8a3575) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f8ec4af99e8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4fdb210b-2e2f-4204-85d5-87ec3f9a8f88) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007f8ec3610450 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
Completed 200 OK in 9ms (Views: 0.2ms | ActiveRecord: 1.2ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-923abb50-b708-4f8a-9ded-d376b9081307@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-923abb50-b708-4f8a-9ded-d376b9081307@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d4f9591f-f8e0-4bdc-90bf-9c9b02c39fc2) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f8ec4ac1db8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 11e28d24-3b67-45d9-9048-d57e1e5db46b) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f8ec4ab12d8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 48632224-edb5-4c91-81f0-378263288874) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f8ec46d8ff8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 12ms (Views: 0.3ms | ActiveRecord: 1.1ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b3195c5a-a96a-4388-b7d8-852e68fb4e5a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b3195c5a-a96a-4388-b7d8-852e68fb4e5a@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 574a484a-1d58-413a-b527-84683499a679) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd221472840 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d64e83a2-ef6a-4879-808b-f1e48a710417) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd21ea5e068 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-50a70d82-6a3a-47e6-b961-0a39570c9e4a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-50a70d82-6a3a-47e6-b961-0a39570c9e4a@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 9998ac74-78e8-46ec-bdb9-b2187dd7ff38) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd21e9e2378 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b8e016b9-cb43-4bdf-a0ae-c07deaaf13a5) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd21ec32420 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8d61ae37-ade8-4897-bbac-44bace571f36@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8d61ae37-ade8-4897-bbac-44bace571f36@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 829b2968-e71a-4e7b-903f-b3742aaa4c14) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd221013a60 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6f36c4c1-48f7-4fbe-a952-5ff6da499d76) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd2214a0c40 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-4faf94d0-2d3e-41b0-a0d7-355191d0951b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-4faf94d0-2d3e-41b0-a0d7-355191d0951b@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e9cf4855-b8e2-40b5-8041-cb41c85d15f8) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd22161a2d8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 44171ef6-9005-46e0-9c09-2210ca4d8b6f) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd22165a658 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: bd32bda8-a9f7-4fba-828b-97e53e8a80bd) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fd222aae870 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
Completed 200 OK in 37ms (Views: 0.5ms | ActiveRecord: 1.7ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-85f57d88-97eb-45d5-89ff-f00816e79e69@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-85f57d88-97eb-45d5-89ff-f00816e79e69@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 98eec9cc-f0b0-49ab-95af-a07a2dfc5ea8) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd222bc17d0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4def9562-94c6-4e54-b2b2-69841a5fb638) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd222c12b08 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6209035f-574b-4cbf-be5c-c36a3d4a518f) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fd222cf1d58 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 11ms (Views: 0.2ms | ActiveRecord: 0.9ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-bf0bde38-6afa-40e0-a0bf-6dbebe64cc8c@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-bf0bde38-6afa-40e0-a0bf-6dbebe64cc8c@example.com"], ["name", "john doe"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0289658f-0b06-4dd3-bd80-5392dfb7e93a) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd222e23ca8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 342b7edf-eb6a-4963-af9c-d69d21f9745c) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd2229a3b10 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 9bf3b34c-509b-48ee-9c45-a9b7bd89c4a9) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fd21e17bb80 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3d5bc5e5-546f-4062-85e1-14d69f3d552f) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fd222ef9330 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 200 OK in 11ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 08:59:28 UTC], ["updated_at", 2017-04-19 08:59:28 UTC]]
  [1m[35m (1.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3dec77c4-e5c3-494f-ae31-2fdee2e4dc9e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3dec77c4-e5c3-494f-ae31-2fdee2e4dc9e@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
Completed 500 Internal Server Error in 1ms (ActiveRecord: 0.0ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a35829e3-9766-42f0-8ada-7e9a1fc68042@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a35829e3-9766-42f0-8ada-7e9a1fc68042@example.com"], ["name", "john doe"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
Completed 500 Internal Server Error in 1ms (ActiveRecord: 0.0ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-aa3b844a-85f0-4c94-b30c-11531706cad5@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-aa3b844a-85f0-4c94-b30c-11531706cad5@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
Completed 500 Internal Server Error in 2ms (ActiveRecord: 0.0ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "john@doe.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: da1314e8-1930-4008-849a-dc1c800e2989) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007faba09124b0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: fe6273b6-3ff3-4f56-b650-35f2cdc3b22d) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fab9c17ff30 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2b40850f-9748-4d1e-951c-7624b725d57a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2b40850f-9748-4d1e-951c-7624b725d57a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4785c7e0-4bad-4aa4-b5c3-a88bead73906) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007faba0b1ca30 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9e9c5fe9-7df4-4422-bae2-f72bf519f50a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9e9c5fe9-7df4-4422-bae2-f72bf519f50a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-437230bd-47cd-45a7-b0ec-7a58cfd59f7c@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-437230bd-47cd-45a7-b0ec-7a58cfd59f7c@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 26438c2a-c172-4774-9a6d-f22f1d47910e) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fab9c10b090 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 08:59:51 UTC], ["updated_at", 2017-04-19 08:59:51 UTC]]
  [1m[35m (1.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d7a68225-8893-4564-9ff3-9bc5fb3d4d50@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d7a68225-8893-4564-9ff3-9bc5fb3d4d50@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
Completed 500 Internal Server Error in 1ms (ActiveRecord: 0.0ms)
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-4dc7b386-0c5d-4cc6-b606-04646aa814a7@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-4dc7b386-0c5d-4cc6-b606-04646aa814a7@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
Completed 500 Internal Server Error in 1ms (ActiveRecord: 0.0ms)
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b47c027f-d04d-410f-9bfb-7d71283c0353@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b47c027f-d04d-410f-9bfb-7d71283c0353@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
Completed 500 Internal Server Error in 1ms (ActiveRecord: 0.0ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "john@doe.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: fe2c43a5-a0b7-4b5a-bb1a-5d332fffb692) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fc63cd321d8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3ca99036-02ec-42cf-8415-b11f6c5675dd) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fc63ea590b8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f2244d9f-68b5-4b7e-a9ab-bf11db7b1dd2@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f2244d9f-68b5-4b7e-a9ab-bf11db7b1dd2@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 35e065a5-2dbb-4b57-b162-144c2c682262) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fc63b02cf48 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a4d11c98-f5c0-4259-81ca-ea87081fefa3@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a4d11c98-f5c0-4259-81ca-ea87081fefa3@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.6ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: fe34682d-1909-4b75-86ff-825fda721244) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fc63ae040e0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (1.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8664c4a7-98ae-46ba-8588-153c6aa3399a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8664c4a7-98ae-46ba-8588-153c6aa3399a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:03:29 UTC], ["updated_at", 2017-04-19 09:03:29 UTC]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (3.6ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:04:10 UTC], ["updated_at", 2017-04-19 09:04:10 UTC]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 57e9d957-f13a-4235-8449-d286f8920477) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb1c7850e00 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "john@doe.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 14831a15-3fba-42e5-87b5-15793ef68064) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb1c8ef57a0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ba3f61d6-f71f-44a0-922c-e4d891eadb86@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ba3f61d6-f71f-44a0-922c-e4d891eadb86@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
Completed 500 Internal Server Error in 1ms (ActiveRecord: 0.0ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-27e04f7e-b0c8-4914-ad7f-d79fc20c7fdd@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-27e04f7e-b0c8-4914-ad7f-d79fc20c7fdd@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
Completed 500 Internal Server Error in 2ms (ActiveRecord: 0.0ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-29472a61-c944-4e2f-92be-ad913071efba@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-29472a61-c944-4e2f-92be-ad913071efba@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
Completed 500 Internal Server Error in 1ms (ActiveRecord: 0.0ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2a61972c-3058-4f83-8f2f-e434232d8db7@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2a61972c-3058-4f83-8f2f-e434232d8db7@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b2163227-08ac-454b-a864-53894714b631) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb1ca2d0ce8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8f11d1a3-02b9-4df8-81a6-4517b75b8cf7@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8f11d1a3-02b9-4df8-81a6-4517b75b8cf7@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4d7f735e-346a-42af-9431-2c807ffcaf73) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb1c76733d0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-82ffbfcb-5947-4403-9928-0f41f8811c78@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-82ffbfcb-5947-4403-9928-0f41f8811c78@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (3.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.6ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:11:15 UTC], ["updated_at", 2017-04-19 09:11:15 UTC]]
  [1m[35m (1.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-33c5ff5f-ea38-4abc-b447-0f1888c0309d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-33c5ff5f-ea38-4abc-b447-0f1888c0309d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-bb0d73fe-6ac9-48a8-ac8f-3007533b7a15@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-bb0d73fe-6ac9-48a8-ac8f-3007533b7a15@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e3694fee-0790-466a-ab27-69971cc6f882) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ff2743da7c0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0ddeecd9-34bf-4d2f-9e57-1131c0faadea@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0ddeecd9-34bf-4d2f-9e57-1131c0faadea@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6c88d0e0-b8ba-44cb-8f87-f0ddf5f3009f) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ff2742527b8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-17c9f31c-2adc-49c0-b493-3666c2f9bb03@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-17c9f31c-2adc-49c0-b493-3666c2f9bb03@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
Completed 500 Internal Server Error in 2ms (ActiveRecord: 0.0ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3cf88729-8383-4300-8c61-2bb49ffa2167@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3cf88729-8383-4300-8c61-2bb49ffa2167@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
Completed 500 Internal Server Error in 1ms (ActiveRecord: 0.0ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-cac33e6e-c3bc-4e34-9149-7a1d2614ffde@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-cac33e6e-c3bc-4e34-9149-7a1d2614ffde@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
Completed 500 Internal Server Error in 1ms (ActiveRecord: 0.0ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "john@doe.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 53d32daf-6af1-439b-8aaf-f716d680996f) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ff273e6fb50 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: dfc1b664-eec9-4524-b276-eb849591afb5) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ff277279f68 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (3.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.5ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:18:47 UTC], ["updated_at", 2017-04-19 09:18:47 UTC]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9a64bfbc-da8b-4b6d-9dcd-74d1ff28c7b9@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9a64bfbc-da8b-4b6d-9dcd-74d1ff28c7b9@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-99d3e2d0-0b6e-4216-8349-a1bc06770e2d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-99d3e2d0-0b6e-4216-8349-a1bc06770e2d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.6ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d99a1df0-5f57-4ba7-87fd-ec80be08cee2) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fac2ac83650 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-41aa4923-b0ee-4937-9c59-3cb8146485e6@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-41aa4923-b0ee-4937-9c59-3cb8146485e6@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d0ce2e8c-f281-4b3f-bf4e-ca29c81febe7) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fac2854f200 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0709f9ab-04db-4479-b51e-2fe66a89649d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0709f9ab-04db-4479-b51e-2fe66a89649d@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
Completed 500 Internal Server Error in 1ms (ActiveRecord: 0.0ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-edf8f665-fcad-4e87-adac-f0d66a228729@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-edf8f665-fcad-4e87-adac-f0d66a228729@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
Completed 500 Internal Server Error in 1ms (ActiveRecord: 0.0ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3367d0bb-f4ea-42a4-873a-b097b41e6b07@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3367d0bb-f4ea-42a4-873a-b097b41e6b07@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
Completed 500 Internal Server Error in 1ms (ActiveRecord: 0.0ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.3ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:24:32 UTC], ["updated_at", 2017-04-19 09:24:32 UTC]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-44a95925-f108-4cbc-abaf-fbba8208e592@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-44a95925-f108-4cbc-abaf-fbba8208e592@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 6ms (ActiveRecord: 0.1ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e30ceed2-f89f-44bd-982d-d2e2b5fa8877@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e30ceed2-f89f-44bd-982d-d2e2b5fa8877@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 2ms (ActiveRecord: 0.0ms)
  [1m[35m (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-58114303-613e-4e38-a61d-b54b09387018@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-58114303-613e-4e38-a61d-b54b09387018@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 2ms (ActiveRecord: 0.1ms)
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-59bd42d9-e4d3-44fc-85e4-542b6e476f97@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-59bd42d9-e4d3-44fc-85e4-542b6e476f97@example.com"], ["name", "john doe"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 96c79f86-ed5d-466d-80ff-d2af1dcc96b2) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd81b153f10 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-5e790eed-1ba7-4205-b1f6-b427665c7810@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-5e790eed-1ba7-4205-b1f6-b427665c7810@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ecc9b85c-d84d-4c40-bf4c-eea0677a5d22@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ecc9b85c-d84d-4c40-bf4c-eea0677a5d22@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a1f1c196-309e-4b79-8aff-cb737107750b) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd819a4b9f8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.7ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:27:20 UTC], ["updated_at", 2017-04-19 09:27:20 UTC]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a450a40f-f4d4-42d6-9837-a38b523295cc@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a450a40f-f4d4-42d6-9837-a38b523295cc@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9bc6c0f3-da22-4e70-a6ab-ae11f73b89c0@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9bc6c0f3-da22-4e70-a6ab-ae11f73b89c0@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a3789bd8-3614-4fda-88be-bbc334787c65) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f9235bc5ad8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8c2b9561-2ee1-4cca-9e1f-c76d9ba5b2b2@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8c2b9561-2ee1-4cca-9e1f-c76d9ba5b2b2@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b35705ae-5bcd-4915-b079-1c6fc679217f) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f9235e76fe8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.4ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f4f46d06-7053-4fcb-b172-b4c4a2bbccd9@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f4f46d06-7053-4fcb-b172-b4c4a2bbccd9@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 6ms (ActiveRecord: 0.1ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-93a84bed-a0b7-4b9b-a4dd-c57f17814691@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-93a84bed-a0b7-4b9b-a4dd-c57f17814691@example.com"], ["name", "john doe"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 3ms (ActiveRecord: 0.2ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-7d9e70fd-e96f-4c6a-a7d9-4f95a4cf80e5@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-7d9e70fd-e96f-4c6a-a7d9-4f95a4cf80e5@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.4ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 3ms (ActiveRecord: 0.4ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.6ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:30:04 UTC], ["updated_at", 2017-04-19 09:30:04 UTC]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "john@doe.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7073c56c-7c24-41e3-8b34-d0aa17c02671) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f91eae589f8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 5a6b0681-2168-4133-84d2-2b5659ab08f1) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f91eb1f95a8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-bf34e4d6-40c0-43f7-87dc-4941471a25f8@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-bf34e4d6-40c0-43f7-87dc-4941471a25f8@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1b5b7a5a-870b-4506-a2a5-30b97b3aaa86) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f91eae520d0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.4ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-94425c21-0da9-4a52-bd9a-c1ed2a59a3e2@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-94425c21-0da9-4a52-bd9a-c1ed2a59a3e2@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8fe23150-6303-4920-9012-6cee8f31136f@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8fe23150-6303-4920-9012-6cee8f31136f@example.com"], ["name", "john doe"]]
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: fccc88d4-64c0-4b18-bb47-d3ef6423be20) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f91ee813ad0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e4ed4797-bb22-471e-8ac7-bed19469ecee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e4ed4797-bb22-471e-8ac7-bed19469ecee@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 8ms (ActiveRecord: 0.1ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-733a5205-9d08-40a2-abff-ca03654c0c0a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-733a5205-9d08-40a2-abff-ca03654c0c0a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 4ms (ActiveRecord: 0.2ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f976f8b4-7e12-4fb4-967d-efdc1d5af960@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f976f8b4-7e12-4fb4-967d-efdc1d5af960@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 2ms (ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:31:47 UTC], ["updated_at", 2017-04-19 09:31:47 UTC]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-5e4581c3-e511-42c3-b36d-f06e166ed53a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-5e4581c3-e511-42c3-b36d-f06e166ed53a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e1321f41-672f-4318-9f8f-18563ce07271) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ff5c2b22130 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-5102cd9a-5b75-4f02-991c-7dff4f719220@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-5102cd9a-5b75-4f02-991c-7dff4f719220@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6c438346-2b0f-4802-a4b5-f85262113ee9@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6c438346-2b0f-4802-a4b5-f85262113ee9@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0dcc9797-71b2-4d03-afaa-4bd8056364ed) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ff5c29f0cd0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 12021f1a-7a9c-4dcd-b8fa-5adfdf5c77c1) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ff5c08e0d88 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a4f9b02d-c1c0-4fa1-975b-4113c559e15c@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a4f9b02d-c1c0-4fa1-975b-4113c559e15c@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 9ms (ActiveRecord: 0.2ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a8715a79-792d-4dd7-8add-cb52262978e6@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a8715a79-792d-4dd7-8add-cb52262978e6@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 2ms (ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9548243d-fe3a-4bf2-b0d2-64a875e4ce02@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9548243d-fe3a-4bf2-b0d2-64a875e4ce02@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 1ms (ActiveRecord: 0.0ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:32:12 UTC], ["updated_at", 2017-04-19 09:32:12 UTC]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3d51f0ad-7ac3-47c0-aa99-e2765c00ae29@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3d51f0ad-7ac3-47c0-aa99-e2765c00ae29@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
Completed 500 Internal Server Error in 1ms (ActiveRecord: 0.0ms)
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-975f25b8-342a-4b71-9dd7-eaa74e3bb0e6@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-975f25b8-342a-4b71-9dd7-eaa74e3bb0e6@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
Completed 500 Internal Server Error in 1ms (ActiveRecord: 0.0ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-93e5330c-efa4-4ba3-8156-d91635ce373d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-93e5330c-efa4-4ba3-8156-d91635ce373d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
Completed 500 Internal Server Error in 1ms (ActiveRecord: 0.0ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6d73a0cd-6530-452e-b4a1-43ec54f3974d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6d73a0cd-6530-452e-b4a1-43ec54f3974d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-02908382-06fd-4c57-ba24-fac4227de2fb@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-02908382-06fd-4c57-ba24-fac4227de2fb@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.8ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 18c701ee-1f4b-401b-bb08-56af69f77507) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb607888668 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-23035316-f4a5-4dc6-a88e-829fc547b9f3@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-23035316-f4a5-4dc6-a88e-829fc547b9f3@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 65fe5f97-32ab-4b61-a44e-4eacb4b3060e) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb603fdeb28 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.9ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:33:25 UTC], ["updated_at", 2017-04-19 09:33:25 UTC]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ce35ad95-f5cd-4281-90b7-c2db19d0ed3a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ce35ad95-f5cd-4281-90b7-c2db19d0ed3a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 4ms (ActiveRecord: 0.1ms)
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-83ee8bc8-b4f4-49f5-bb29-270b94b11aca@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-83ee8bc8-b4f4-49f5-bb29-270b94b11aca@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 2ms (ActiveRecord: 0.0ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-120f6434-ab48-48cf-8bc7-81096a0bafb2@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-120f6434-ab48-48cf-8bc7-81096a0bafb2@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 2ms (ActiveRecord: 0.1ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 15de9916-f41f-4fa4-b58f-a15a02b5f007) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fa72736ab98 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "john@doe.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d4b391be-a572-4c5d-aeb8-e2901fca652f) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fa72b0d90d8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e7c0d269-2c2c-4d35-a1a1-4eaa44845371@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e7c0d269-2c2c-4d35-a1a1-4eaa44845371@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b14ad853-ea7e-40ab-a0d0-f54190fd99fa) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fa7274ed1a0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.4ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-5cb46746-1c2c-416a-9c86-7fad1c185684@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-5cb46746-1c2c-416a-9c86-7fad1c185684@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-38964db6-3841-4243-be36-60b95c2e1af6@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-38964db6-3841-4243-be36-60b95c2e1af6@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: fd695767-a676-434a-913a-ccbcda8ee7a1) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fa7279abb88 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.6ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:34:53 UTC], ["updated_at", 2017-04-19 09:34:53 UTC]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0c29bcf3-2893-4406-9bf8-2e6dea03e254@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0c29bcf3-2893-4406-9bf8-2e6dea03e254@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b5c99438-33a4-406b-a043-4625de7b2f1d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b5c99438-33a4-406b-a043-4625de7b2f1d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 289af32c-1abe-4489-b5f5-3ac1f519090a) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ffbc60c6718 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.4ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9397b6f5-4e22-4ddd-bbb7-aa1b6a34f0a2@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9397b6f5-4e22-4ddd-bbb7-aa1b6a34f0a2@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: bf014dd8-d657-4468-82d2-a8214a6c96cf) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ffbc9af0678 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2440f177-257e-4a11-9f09-30e5ad16709b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2440f177-257e-4a11-9f09-30e5ad16709b@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 14ms (ActiveRecord: 0.2ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-82d32767-9f2d-4fd2-a88c-6496622fe009@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-82d32767-9f2d-4fd2-a88c-6496622fe009@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 2ms (ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-deb65386-606e-443b-bcf7-0d6c4944a7ea@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-deb65386-606e-443b-bcf7-0d6c4944a7ea@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 2ms (ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6279dc00-755c-450c-8b2d-fdfc8b48cfcb) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ffbc9db3c20 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.9ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:35:29 UTC], ["updated_at", 2017-04-19 09:35:29 UTC]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9c851f72-463b-4418-9130-ac8a3f7a0ecb@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9c851f72-463b-4418-9130-ac8a3f7a0ecb@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0d656946-224b-45ba-821c-1e9daea927e2@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0d656946-224b-45ba-821c-1e9daea927e2@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 45c2ea2b-69fd-484a-9317-2828611894b7) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f84c5269a48 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-adc7ac26-e3eb-4bd3-be28-471873f00326@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-adc7ac26-e3eb-4bd3-be28-471873f00326@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 46a6162c-bd54-4329-8a7c-10f4608ff3b1) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f84c64426e8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-4a2c8668-4cef-4293-8c9a-f3db5617fb37@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-4a2c8668-4cef-4293-8c9a-f3db5617fb37@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 6ms (ActiveRecord: 0.2ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-4df29c07-ab6d-4113-8a4b-e1903399689c@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-4df29c07-ab6d-4113-8a4b-e1903399689c@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 2ms (ActiveRecord: 0.1ms)
  [1m[35m (4.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-15cd7e14-3234-41a3-b000-7e16a9868bff@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-15cd7e14-3234-41a3-b000-7e16a9868bff@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 1ms (ActiveRecord: 0.0ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 059f957e-6422-4cd4-b001-db047351e318) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f84c65027b8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:46:10 UTC], ["updated_at", 2017-04-19 09:46:10 UTC]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.7ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:46:41 UTC], ["updated_at", 2017-04-19 09:46:41 UTC]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e5b9345e-37b3-47b1-a3e4-938dcc0bc7f4@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e5b9345e-37b3-47b1-a3e4-938dcc0bc7f4@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 5ms (ActiveRecord: 0.1ms)
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-eca766f6-0ee0-4230-a7c7-da96fa60c550@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-eca766f6-0ee0-4230-a7c7-da96fa60c550@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 2ms (ActiveRecord: 0.0ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ea2c6ae7-84bd-4231-9c9a-6c3559e6083d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ea2c6ae7-84bd-4231-9c9a-6c3559e6083d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 2ms (ActiveRecord: 0.0ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-001e003c-2365-41a6-87a0-d6fcf815bd73@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-001e003c-2365-41a6-87a0-d6fcf815bd73@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e20ffd9d-ce3f-458d-b1bd-b35f58a7f6d7) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe71aaf2a68 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.4ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c73cf31c-3826-4790-b8df-9362446fcdfe@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c73cf31c-3826-4790-b8df-9362446fcdfe@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 75295f0f-6983-40b4-a4a6-3d059f8e2811) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe71d848760 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e6736202-aa1e-4e4e-bac5-f99b57a76329@example.com"], ["LIMIT", 1]]
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e6736202-aa1e-4e4e-bac5-f99b57a76329@example.com"], ["name", "john doe"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 48583ce1-bb68-4bf9-b834-503738019d12) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe71d8b0f40 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:47:45 UTC], ["updated_at", 2017-04-19 09:47:45 UTC]]
  [1m[35m (1.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-903f9674-eb88-4e82-a093-9725de6856f5@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-903f9674-eb88-4e82-a093-9725de6856f5@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 3ms (ActiveRecord: 0.1ms)
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-60b76420-91b2-4a97-b455-e49caea1e677@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-60b76420-91b2-4a97-b455-e49caea1e677@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 2ms (ActiveRecord: 0.0ms)
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-790ce993-fc24-4cc1-8636-0ba323bfd293@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-790ce993-fc24-4cc1-8636-0ba323bfd293@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 2ms (ActiveRecord: 0.1ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9b9df605-9c4c-48ea-a535-46906d8345f2@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9b9df605-9c4c-48ea-a535-46906d8345f2@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 783be83f-98ac-41cf-b40c-a9969e0bc2ef) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fac90e0d758 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e4929145-0395-4f4c-8d13-576a06af66c4@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e4929145-0395-4f4c-8d13-576a06af66c4@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3496c186-30db-45d1-91d6-7f41acf67e04@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3496c186-30db-45d1-91d6-7f41acf67e04@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 85c2cb25-b70d-4f5b-a115-0a7ca971d66f) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fac9413b008 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b86a0d11-dd80-4af0-8e8e-493e985aa6fb) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fac941f0a98 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:48:29 UTC], ["updated_at", 2017-04-19 09:48:29 UTC]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-93bf7704-f903-41ae-ad4e-0c1797f35530@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-93bf7704-f903-41ae-ad4e-0c1797f35530@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 5ms (ActiveRecord: 0.3ms)
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-10986419-8973-4094-8d19-d29aca54c66a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-10986419-8973-4094-8d19-d29aca54c66a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 4ms (ActiveRecord: 0.3ms)
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-4328279e-aef8-4dae-8b9c-4fecd234bad8@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-4328279e-aef8-4dae-8b9c-4fecd234bad8@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 4ms (ActiveRecord: 0.3ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 08f0d5da-d7cc-45ea-bd8a-d9ea57db5a7a) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ff29b8b8130 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-54495df6-b86a-4d5e-acef-7cf5b8e006ce@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-54495df6-b86a-4d5e-acef-7cf5b8e006ce@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 335f5bc9-3261-4161-93e6-2061ce296b9b) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ff29e545a68 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-db16301a-17f0-4360-8370-48dd631ad05f@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-db16301a-17f0-4360-8370-48dd631ad05f@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d2124f8f-aae8-41f9-9461-f5ff5f073674) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ff29e5d3160 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-19b8941a-dee6-453d-8dca-733134fc813b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-19b8941a-dee6-453d-8dca-733134fc813b@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.7ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:49:23 UTC], ["updated_at", 2017-04-19 09:49:23 UTC]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8fd5dc18-f3ef-44a9-901f-f7b5fa19433b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8fd5dc18-f3ef-44a9-901f-f7b5fa19433b@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-18a13b38-7eed-4924-af1e-970df84e3541@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-18a13b38-7eed-4924-af1e-970df84e3541@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 53be1ac7-fc1a-4c6d-938b-8c955e704405) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe933d04098 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2e6fb416-0937-4023-86cd-4f7d254ace15@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2e6fb416-0937-4023-86cd-4f7d254ace15@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6950afc7-6956-4f29-ab79-ef2a207cee6b) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe933b41d00 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 43d947b0-6756-4da3-81be-3c0250206947) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe933dec168 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0a8b8d68-9c76-4319-baff-edeb1eda2061@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0a8b8d68-9c76-4319-baff-edeb1eda2061@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 8ms (ActiveRecord: 0.4ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-321b09b0-3070-406f-843e-c5636680ce6a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-321b09b0-3070-406f-843e-c5636680ce6a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 4ms (ActiveRecord: 0.3ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9b6b2a85-20cd-479b-827c-291c656c9402@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9b6b2a85-20cd-479b-827c-291c656c9402@example.com"], ["name", "john doe"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 5ms (ActiveRecord: 0.3ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.5ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:49:36 UTC], ["updated_at", 2017-04-19 09:49:36 UTC]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-da4277b1-4d75-487b-b2c1-9faa6d224f6f@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-da4277b1-4d75-487b-b2c1-9faa6d224f6f@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 93821ms (ActiveRecord: 0.3ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6f38d0a3-afe0-40dd-b728-862acbe2082a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6f38d0a3-afe0-40dd-b728-862acbe2082a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 1709ms (ActiveRecord: 0.3ms)
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ed4e9048-da18-4d85-a415-3e415704b4b7@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ed4e9048-da18-4d85-a415-3e415704b4b7@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 728ms (ActiveRecord: 0.4ms)
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a4c452cb-c548-40e9-a6ff-fe88805fc5ce) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f8363860d60 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-54d44c94-7bcf-46f1-a1f3-c148e1ef0c20@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-54d44c94-7bcf-46f1-a1f3-c148e1ef0c20@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 58adcd0c-94be-48c7-a5bc-d23dfefd01fb) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f8363887118 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-25ddf998-35c1-4cfc-8015-44a67c8ee4db@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-25ddf998-35c1-4cfc-8015-44a67c8ee4db@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b6de2949-7aae-440e-b0d8-393412508e27@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b6de2949-7aae-440e-b0d8-393412508e27@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 59510d84-b0dc-431f-8282-777450f78535) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f836389f240 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.6ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:51:17 UTC], ["updated_at", 2017-04-19 09:51:17 UTC]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e2a2a54f-677b-4450-86ae-004d4ce6e0e1@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e2a2a54f-677b-4450-86ae-004d4ce6e0e1@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 115554ms (ActiveRecord: 1.0ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-63763622-421a-48cd-bcd5-73a4643ccfb0@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-63763622-421a-48cd-bcd5-73a4643ccfb0@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: bff9e906-9aab-4b19-a3ef-d5414d41c531) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fe245553960 @uri=#<URI::GID gid://dummy/User/2>>
Completed 500 Internal Server Error in 1327ms (ActiveRecord: 0.6ms)
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ab807243-756a-493c-8ac9-44016920e2e4@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ab807243-756a-493c-8ac9-44016920e2e4@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c1db12ba-63f8-4103-8c49-b35c7306ce65) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fe245707518 @uri=#<URI::GID gid://dummy/User/2>>
Completed 500 Internal Server Error in 629ms (ActiveRecord: 0.8ms)
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c9e03c45-bddc-42bd-b9d7-8fad84fc13b0) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe2460e1e30 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3673b6c3-1f17-4434-93a9-6bb7937c506a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3673b6c3-1f17-4434-93a9-6bb7937c506a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f42d9d45-2eb9-4e62-b42a-93d857a9c02f) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe2460a8810 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a32c9f18-4db1-4364-9e23-2a705656aaa9@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a32c9f18-4db1-4364-9e23-2a705656aaa9@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: bb565889-2992-4790-b854-5839325ad070) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe24386be10 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.6ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-dddddc56-fbe7-4c23-9bd7-d3cc798e075a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-dddddc56-fbe7-4c23-9bd7-d3cc798e075a@example.com"], ["name", "john doe"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.5ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:53:33 UTC], ["updated_at", 2017-04-19 09:53:33 UTC]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.4ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (2.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f1d9ffb4-9a9d-4af7-9798-abdc55dc54cf) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007faf6a3f7110 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3ad176e6-ef46-40cb-ac21-05b4891811e2@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3ad176e6-ef46-40cb-ac21-05b4891811e2@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 11ms (ActiveRecord: 0.6ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-33b22960-9213-4e77-809d-ed71ccc47057@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-33b22960-9213-4e77-809d-ed71ccc47057@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 4ms (ActiveRecord: 0.3ms)
  [1m[35m (1.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ce44f50b-921b-4fcc-a251-1d7847d713e1@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ce44f50b-921b-4fcc-a251-1d7847d713e1@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 3ms (ActiveRecord: 0.2ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-50934448-ebb9-44ff-b351-a4931005790b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-50934448-ebb9-44ff-b351-a4931005790b@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 30ad7c84-9964-4df5-abb9-defbb342f3b5) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007faf6e15e8f0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (2.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0b5f3124-b1cb-4ea1-bcee-41f07d4618de@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0b5f3124-b1cb-4ea1-bcee-41f07d4618de@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8b1c95e7-6378-43e9-ad09-b38a8af44335) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007faf6ba58bc0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-cbed5952-5329-4428-988a-76bd986315b6@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-cbed5952-5329-4428-988a-76bd986315b6@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:54:28 UTC], ["updated_at", 2017-04-19 09:54:28 UTC]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-90b29502-a440-4782-b54b-c18ffbfc49d9@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-90b29502-a440-4782-b54b-c18ffbfc49d9@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 84f87e13-7e4e-4676-af29-2594c5b0091d) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f96bd706808 @uri=#<URI::GID gid://dummy/User/2>>
Completed 500 Internal Server Error in 307ms (ActiveRecord: 0.6ms)
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-89f8dbeb-b235-42aa-b71f-a32a3c532a29@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-89f8dbeb-b235-42aa-b71f-a32a3c532a29@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 14ms (ActiveRecord: 0.8ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0bf296ba-ce46-4c52-8aa5-5bbc87795d64@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0bf296ba-ce46-4c52-8aa5-5bbc87795d64@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3d423969-737f-446f-bed4-52c6642342cc) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f96bfd07430 @uri=#<URI::GID gid://dummy/User/2>>
Completed 500 Internal Server Error in 27ms (ActiveRecord: 0.7ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.6ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-4719e1c6-7e25-4b2e-81f6-a09f8b614d3e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-4719e1c6-7e25-4b2e-81f6-a09f8b614d3e@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 310cc0f9-cf4e-44d4-9e00-6d8dee64653e) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f96c1206b10 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2aa56c63-b848-4f10-b2a8-3a804cfb40f6@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2aa56c63-b848-4f10-b2a8-3a804cfb40f6@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 06103bea-3b99-4a81-8def-d09e8fda9f48) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f96be90f090 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8a2e898c-8020-4cea-8603-a7a25e6bc74a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8a2e898c-8020-4cea-8603-a7a25e6bc74a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 20743297-180c-4286-8eaf-1a2e9bd07a3a) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f96be09b0f8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:56:31 UTC], ["updated_at", 2017-04-19 09:56:31 UTC]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:56:41 UTC], ["updated_at", 2017-04-19 09:56:41 UTC]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c9c744a5-6dcf-4619-a869-42434343e89f@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c9c744a5-6dcf-4619-a869-42434343e89f@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b74b20b2-9c97-41cf-a06b-aa1ef7982b5d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b74b20b2-9c97-41cf-a06b-aa1ef7982b5d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a406780a-fe0b-4335-83a4-af74c6c1d778) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fa2e141e908 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8475edae-73a6-42d5-a349-c96e3a921fd7@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8475edae-73a6-42d5-a349-c96e3a921fd7@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f1f4dd88-6409-4f27-9e75-6de950ba3645) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fa2e13f5c10 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1b6ccf97-3002-473f-b205-3b1b525b55c9@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1b6ccf97-3002-473f-b205-3b1b525b55c9@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 93d1e325-5f89-40d5-823b-069ec12fe2d8) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fa2e2461a40 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
Completed 500 Internal Server Error in 27ms (ActiveRecord: 0.7ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f6addcf2-dc1b-4f67-a2c9-eaffbe67b226@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f6addcf2-dc1b-4f67-a2c9-eaffbe67b226@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1237e716-5497-45c4-b159-238c5a39f4e9) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fa2e2727478 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
Completed 500 Internal Server Error in 21ms (ActiveRecord: 0.7ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b5417a24-657a-4b58-ac1c-0cb406bd1da3@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b5417a24-657a-4b58-ac1c-0cb406bd1da3@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 14ms (ActiveRecord: 1.1ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7e1b4958-bebe-459b-95cf-d320e173eff5) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fa2e4262e18 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (1.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:56:57 UTC], ["updated_at", 2017-04-19 09:56:57 UTC]]
  [1m[35m (1.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-abff95bd-b022-408f-972f-d1cd271cf6f3@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-abff95bd-b022-408f-972f-d1cd271cf6f3@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 21ms (ActiveRecord: 0.7ms)
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d8bd715e-154c-48d1-8338-4a7016834764@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d8bd715e-154c-48d1-8338-4a7016834764@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 12fe2460-3cdb-4be8-b2f3-6b18c5dec163) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fa04738b118 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
Completed 500 Internal Server Error in 24ms (ActiveRecord: 0.7ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-22a45abe-6ba4-4326-874b-4493af442fed@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-22a45abe-6ba4-4326-874b-4493af442fed@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1362aa70-ff5f-4372-b66c-272a21f4ca43) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fa047761968 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
Completed 500 Internal Server Error in 24ms (ActiveRecord: 1.4ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a3771774-672c-4ee8-938b-379ad2a97b55) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fa04a889630 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (1.0ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-02365676-5d2d-4acb-82c9-87e14d0551a3@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-02365676-5d2d-4acb-82c9-87e14d0551a3@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d3b04b34-fc67-4373-8eef-56ea200ee37f@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d3b04b34-fc67-4373-8eef-56ea200ee37f@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8a4e7d55-9d57-4914-b941-e02c91a2bd6e) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fa04b21e380 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b7c4e86a-1a95-49ff-a396-338c215b76d6@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b7c4e86a-1a95-49ff-a396-338c215b76d6@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 232e8648-7019-4ca1-ad60-ba504a82e8f6) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fa04b2c6f58 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.3ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:57:27 UTC], ["updated_at", 2017-04-19 09:57:27 UTC]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e75dcb9e-f28b-4522-a7d9-0d77d49d7a61) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb0f3d93680 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c307e1da-99ef-48ab-b0ff-c8a4ce713806@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c307e1da-99ef-48ab-b0ff-c8a4ce713806@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6e4ffe12-8063-4b11-9eb2-21c4d0c820e1@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6e4ffe12-8063-4b11-9eb2-21c4d0c820e1@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 51626dbb-9036-473d-b7e0-ff09f4d7cd87) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb0f23c06b8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-40433bd7-d6b2-4685-830a-abc7a1563395@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-40433bd7-d6b2-4685-830a-abc7a1563395@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b9906d3e-37e9-4c48-b1ee-1533a6ba1860) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb0f2452a68 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ec863400-02d8-4fd2-b341-eb21703e11ce@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ec863400-02d8-4fd2-b341-eb21703e11ce@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 31ms (ActiveRecord: 1.3ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d0d1e737-104c-4f8e-9381-29bd61bb563e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d0d1e737-104c-4f8e-9381-29bd61bb563e@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: daa09457-13a2-4658-bbc8-7ebbf91f3ca7) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb0f3ed2ac8 @uri=#<URI::GID gid://dummy/User/2>>
Completed 500 Internal Server Error in 20ms (ActiveRecord: 0.8ms)
  [1m[35m (1.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-7ab841da-63e5-4de0-95c5-d97569592640@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-7ab841da-63e5-4de0-95c5-d97569592640@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0b27f61a-3ef4-4146-bd4a-e315531377b7) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb0f6277be0 @uri=#<URI::GID gid://dummy/User/2>>
Completed 500 Internal Server Error in 18ms (ActiveRecord: 0.5ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 09:59:46 UTC], ["updated_at", 2017-04-19 09:59:46 UTC]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-5b4fde95-9fdf-459c-9657-ced0534762e0@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-5b4fde95-9fdf-459c-9657-ced0534762e0@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9b6b4fb5-b0ea-432e-b14e-5dfa82e70522@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9b6b4fb5-b0ea-432e-b14e-5dfa82e70522@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 71ef75b6-eff7-452d-a6cd-1eeceabf8b87) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f992a7ccb60 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b0a872ba-d38f-45ac-97d8-03d43b0b8c77@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b0a872ba-d38f-45ac-97d8-03d43b0b8c77@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6001512f-d648-4f77-ba8a-018f5b2da356) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f992e20a7f0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 9b422f14-c2df-4ed5-b3e0-37b9b5336bf2) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f992b0a1718 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (4.7ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-7a49bd64-6217-4e97-9610-cf3faa523844@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-7a49bd64-6217-4e97-9610-cf3faa523844@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 312408ms (ActiveRecord: 0.8ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c550c146-ea18-4b12-b662-18f83e4c48f0@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c550c146-ea18-4b12-b662-18f83e4c48f0@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b72ffe73-f0d1-4656-85b6-e32eaa150746) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f992e2aabd8 @uri=#<URI::GID gid://dummy/User/2>>
Completed 500 Internal Server Error in 1502ms (ActiveRecord: 0.6ms)
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2a6e183a-47e8-499d-863b-e8bba88ace09@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2a6e183a-47e8-499d-863b-e8bba88ace09@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7dc88cb6-673a-4159-9f60-d65bba637dd3) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f992e1a02b0 @uri=#<URI::GID gid://dummy/User/2>>
Completed 500 Internal Server Error in 624ms (ActiveRecord: 0.7ms)
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c587c5a6-90e9-4818-93d4-8317c834c847@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c587c5a6-90e9-4818-93d4-8317c834c847@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4fed8993-becc-4ef6-a9c8-f6a2646e5051) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb3211b10a8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-43941754-4d89-4b51-9d1d-91d8d11c6ee2@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-43941754-4d89-4b51-9d1d-91d8d11c6ee2@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1171ecec-c945-4f05-99b0-e80fb3b02541) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb31e5b2da8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b810cd5e-f9cb-4db2-8691-162c56c2492d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b810cd5e-f9cb-4db2-8691-162c56c2492d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-251bec28-23aa-4f54-9012-a6c790eee615@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-251bec28-23aa-4f54-9012-a6c790eee615@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-85189f0c-57ee-43d6-9fe2-476bfba5ebb8@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-85189f0c-57ee-43d6-9fe2-476bfba5ebb8@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c1b55f93-4b48-4739-81d5-de99972b90ec) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fa42c4db5c0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-82a2a536-a8d4-4b2f-8166-c37b1092e470@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-82a2a536-a8d4-4b2f-8166-c37b1092e470@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0dae1669-8ee6-4813-be82-ab88376270f2) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fa42c627118 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ede8eec1-d6cf-460a-aa70-e9aec9f5f1e2@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ede8eec1-d6cf-460a-aa70-e9aec9f5f1e2@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0ee64335-138e-4519-b1bb-e7d2d8b63824) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fa0d5758f28 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-58c925fa-e131-4335-93ac-703c1327c777@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-58c925fa-e131-4335-93ac-703c1327c777@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1abe78a1-cfbc-4d9b-b5da-ac04a8277fa5) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fa0d8ad89c0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ec461680-f513-4671-bb95-279f9041fc41@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ec461680-f513-4671-bb95-279f9041fc41@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 10:15:19 UTC], ["updated_at", 2017-04-19 10:15:19 UTC]]
  [1m[35m (1.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b89cc8bd-2f64-4937-bf70-7dad668d2ae7@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b89cc8bd-2f64-4937-bf70-7dad668d2ae7@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ee3ab40a-c37e-41b8-a418-746f1d3a292c@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ee3ab40a-c37e-41b8-a418-746f1d3a292c@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b641cf73-753b-443f-9ae7-2449b3021166) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fbdb6272bf0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-934da384-5e1b-4c3d-825d-1cf71c6593f3@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-934da384-5e1b-4c3d-825d-1cf71c6593f3@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 67cb3df8-f42f-4768-ae56-28da2bc96bf5) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fbdb6491468 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3dc7f8f4-c846-4f7d-8976-d234c44aaa32) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fbdb65a1970 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-87b77d11-669b-4ea4-aabe-5087be54ff19@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-87b77d11-669b-4ea4-aabe-5087be54ff19@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a66d4382-97c5-40ff-84d5-c06008ccb0cb) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fbdb356bbc0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-fd7f90e9-2222-461b-b403-38fa352df315@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-fd7f90e9-2222-461b-b403-38fa352df315@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-cb9b1a4a-1fc5-42a8-98c4-0a1a71918109@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-cb9b1a4a-1fc5-42a8-98c4-0a1a71918109@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1b817b49-935e-439e-a2d4-b2a9c5e1c54b) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fbdb3697b70 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-18968b31-1380-4e28-b09a-7994b077ffc3@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-18968b31-1380-4e28-b09a-7994b077ffc3@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: aa022849-ea6f-4c2c-9848-a3459daf42c2) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fbdb65ab240 @uri=#<URI::GID gid://dummy/User/2>>
Completed 500 Internal Server Error in 7093ms (ActiveRecord: 0.8ms)
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2a45cca4-4f85-4d13-ac36-1559afffe3f6@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2a45cca4-4f85-4d13-ac36-1559afffe3f6@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 2772ms (ActiveRecord: 0.7ms)
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-34a83c9e-b3c5-43a9-ae7c-72b8a5b7774e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-34a83c9e-b3c5-43a9-ae7c-72b8a5b7774e@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 24d5d58b-3944-4faa-be99-b6ab4a292bef) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fbdb9116a60 @uri=#<URI::GID gid://dummy/User/2>>
Completed 500 Internal Server Error in 1559ms (ActiveRecord: 0.6ms)
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.7ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 10:17:12 UTC], ["updated_at", 2017-04-19 10:17:12 UTC]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b3a206ce-977e-4538-a67e-848093bd668a) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fdfc3f70f58 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (2.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-dd31990e-ee58-4b04-88e2-6d3de70a7808@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-dd31990e-ee58-4b04-88e2-6d3de70a7808@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 75119998-5528-4684-a649-7985b8989564) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fdfc3c4da38 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8f3d7d27-e937-4c43-ba71-f0eb1f72ef32@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8f3d7d27-e937-4c43-ba71-f0eb1f72ef32@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-cdc452b7-de49-4473-a5ce-8f47bdb6c8cd@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (4.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-cdc452b7-de49-4473-a5ce-8f47bdb6c8cd@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7e6b186d-311a-46e2-b271-af976f1dae38) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fdfc413ab90 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3751629a-8c0e-40bd-a0e8-908c7e02cab8@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3751629a-8c0e-40bd-a0e8-908c7e02cab8@example.com"], ["name", "john doe"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1434e95b-387e-4109-aca6-8a6b539ee9bd) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fdfc5229028 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.7ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-42fb7b29-86b1-4b05-9d64-fbfddf0dba17@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-42fb7b29-86b1-4b05-9d64-fbfddf0dba17@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e61ede6c-2f0a-4baa-a774-1de8ee071961) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fdfc3fc8e38 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-7e207ae6-1f6d-4326-975b-2fe088f74779@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-7e207ae6-1f6d-4326-975b-2fe088f74779@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-72c6f406-18b2-4675-84ce-7efd0b6e2519@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-72c6f406-18b2-4675-84ce-7efd0b6e2519@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e6a1dcd5-3abd-4f1e-a27b-b01d19fa7ef4) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fdfc7b13df8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 78135ms (ActiveRecord: 1.3ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6a9a0bbf-b988-4a64-bd92-24823fdb4f96@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6a9a0bbf-b988-4a64-bd92-24823fdb4f96@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 1256ms (ActiveRecord: 0.9ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-55eec40c-31b5-47ed-a338-cd28323745f6@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-55eec40c-31b5-47ed-a338-cd28323745f6@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 55ac2377-ac10-405e-bd23-277372c20941) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fdfc7c83620 @uri=#<URI::GID gid://dummy/User/2>>
Completed 500 Internal Server Error in 735ms (ActiveRecord: 0.8ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.9ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 10:18:38 UTC], ["updated_at", 2017-04-19 10:18:38 UTC]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 5f909e2c-ff05-458b-8183-394dfc0864d8) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb055e078a8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-64b3228d-101d-4248-a649-e3733e0f3c0c@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-64b3228d-101d-4248-a649-e3733e0f3c0c@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7a2dc4b4-d0ab-409a-a294-aa7cacf8b91f) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb055abd940 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1c0bbfd6-3ce3-4f47-a92c-dc9d7b583fab@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1c0bbfd6-3ce3-4f47-a92c-dc9d7b583fab@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0bb84896-2d5b-48ad-8ba7-87f0479f5c40) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb055cdeff8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-89f77d70-b6e3-4820-8778-b2078a88b28a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-89f77d70-b6e3-4820-8778-b2078a88b28a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f0bb3f60-49f1-498c-9a80-04dcb51363f0@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f0bb3f60-49f1-498c-9a80-04dcb51363f0@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 55639929-eb19-4600-aeb2-d7a51039ae9d) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb059893d78 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 90927ms (ActiveRecord: 1.2ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1e2d8f97-bed4-43ee-bd43-aee2a4c1c3f4@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1e2d8f97-bed4-43ee-bd43-aee2a4c1c3f4@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: aab94fea-1485-443f-a6a4-4faf713e6bfc) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb059938170 @uri=#<URI::GID gid://dummy/User/2>>
Completed 500 Internal Server Error in 1281ms (ActiveRecord: 0.6ms)
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-95b19bb8-81f6-4dec-9642-f40f6bf2ef8b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-95b19bb8-81f6-4dec-9642-f40f6bf2ef8b@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 654ms (ActiveRecord: 0.7ms)
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-20e9efd0-0bd1-4237-90c8-6c0362b4b29b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-20e9efd0-0bd1-4237-90c8-6c0362b4b29b@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1e4c8624-6011-41b3-a248-c7bd5814a460) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb05b23eca0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-bba8f766-f0a6-4ddb-95e7-dceb38911149@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-bba8f766-f0a6-4ddb-95e7-dceb38911149@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f60884f1-581d-4931-a7f1-1ef48224b770@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f60884f1-581d-4931-a7f1-1ef48224b770@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 9a0cd04f-8ac8-447a-bcf9-7d92ad42c6c0) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb05b254a78 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.6ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 10:20:18 UTC], ["updated_at", 2017-04-19 10:20:18 UTC]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.7ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 10:20:32 UTC], ["updated_at", 2017-04-19 10:20:32 UTC]]
  [1m[35m (1.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e8f62e18-d60f-4618-afe8-dfe16ab84856@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e8f62e18-d60f-4618-afe8-dfe16ab84856@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 38d391de-0f61-4924-8ce6-f75b28cb726e) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007feb635b6c00 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (3.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-87c48678-18ce-4ccd-9e6f-f70b956ebec4@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-87c48678-18ce-4ccd-9e6f-f70b956ebec4@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-fb2d5c8c-2cc4-4032-b29f-f236b5e38e6e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-fb2d5c8c-2cc4-4032-b29f-f236b5e38e6e@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6cf055ce-c91d-40cc-9ba9-4d60f5749a9a) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007feb627b57c8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-15a32465-e9fc-4db2-8a22-7f4ccad9139d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-15a32465-e9fc-4db2-8a22-7f4ccad9139d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ca959d2a-5057-4ef5-af60-bed481260c5d) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007feb63724240 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
Completed 500 Internal Server Error in 29ms (ActiveRecord: 1.4ms)
  [1m[35m (4.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-01bc0213-9f3e-4388-8ec0-a82e037435a0@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-01bc0213-9f3e-4388-8ec0-a82e037435a0@example.com"], ["name", "john doe"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4ee5bdc3-ea3c-4bad-94cd-ddf9b6dc318f) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007feb637c0348 @uri=#<URI::GID gid://dummy/User/2>>
Completed 500 Internal Server Error in 26ms (ActiveRecord: 0.8ms)
  [1m[35m (1.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-095b5d6e-dab2-46be-84d9-146269325334@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-095b5d6e-dab2-46be-84d9-146269325334@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 15ms (ActiveRecord: 0.7ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-961fd9ac-a855-4e86-858d-9554050da336@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-961fd9ac-a855-4e86-858d-9554050da336@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 95aa1016-cba4-444b-b0aa-b47cf7baec2a) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007feb63b007d8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d43d9357-7640-4faa-aef7-9e2b2f876f43@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d43d9357-7640-4faa-aef7-9e2b2f876f43@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f01ceab4-9b8b-468b-ac9e-50eea2d3e7e0) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007feb661a8570 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-caee738f-a28d-4831-a14e-f1251e428dab@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-caee738f-a28d-4831-a14e-f1251e428dab@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c2616d0a-44c9-4d1b-a036-95f2fc2ea36d) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007feb67858978 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 10:28:09 UTC], ["updated_at", 2017-04-19 10:28:09 UTC]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-062fe398-8208-4f26-b028-181d9b3ad0cf@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-062fe398-8208-4f26-b028-181d9b3ad0cf@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ac8026dd-4474-4e01-bbbe-d4138642aaeb@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ac8026dd-4474-4e01-bbbe-d4138642aaeb@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a1ed5de2-3833-41ed-ba72-30da973e2c27) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb3d8c04430 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-470da2d5-98c7-4b1b-945b-5f362791f7c6@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-470da2d5-98c7-4b1b-945b-5f362791f7c6@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 24faff56-c7ec-43d7-ae4f-51ea03131b2e) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb3d9065df8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c93f346f-61a1-4c2e-bb47-3503e066aee9) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb3d8f2d710 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-212a2983-e4df-4f7f-8f23-d80daca143ea@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-212a2983-e4df-4f7f-8f23-d80daca143ea@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (4.6ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 31ms (ActiveRecord: 5.7ms)
  [1m[35m (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-307ca7f6-3630-4abc-90e6-2e4e399b361e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-307ca7f6-3630-4abc-90e6-2e4e399b361e@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: bf73e9c2-d6e1-489b-9b30-8c56d0919eb2) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb3d99f5dc8 @uri=#<URI::GID gid://dummy/User/2>>
Completed 500 Internal Server Error in 22ms (ActiveRecord: 1.2ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-640882e9-05bb-4027-a720-27e28f377259@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-640882e9-05bb-4027-a720-27e28f377259@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8edc104b-f32b-483c-83ca-3c3cfff076fa) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb3dacf33d0 @uri=#<URI::GID gid://dummy/User/2>>
Completed 500 Internal Server Error in 17ms (ActiveRecord: 0.9ms)
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d8e1d9e5-41e9-4e52-bb3f-a577873ce9f8@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d8e1d9e5-41e9-4e52-bb3f-a577873ce9f8@example.com"], ["name", "john doe"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6aaa72b4-fa0c-4765-a902-7503ccbfa416) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb3dad4a9a0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1f53abf7-8dab-4ee0-a1f8-713e874ff7bb@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1f53abf7-8dab-4ee0-a1f8-713e874ff7bb@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-65663bb4-518d-4789-b3cf-08f4592f96c1@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-65663bb4-518d-4789-b3cf-08f4592f96c1@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3495bdfd-1c25-499f-87a4-e73bc5dbc116) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb3dbdaa688 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 10:28:43 UTC], ["updated_at", 2017-04-19 10:28:43 UTC]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4f6dba14-be8b-4f45-a82e-f576a13e3f9f) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ff5af755268 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2582cbf8-90ff-4542-adb2-042be2160bd5@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2582cbf8-90ff-4542-adb2-042be2160bd5@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: edba12c7-98a7-4e79-9bb6-f3c79f724446) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ff5b1597b40 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
Completed 500 Internal Server Error in 26ms (ActiveRecord: 1.2ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e697041e-7306-4730-8eea-b2143c3f3e00@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e697041e-7306-4730-8eea-b2143c3f3e00@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (1.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 02321d95-62fb-4736-8f7d-4d601bd3a3df) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ff5b28a9e40 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
Completed 500 Internal Server Error in 20ms (ActiveRecord: 1.3ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-cdff633c-0aea-49e5-9d5e-1b4178008965@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-cdff633c-0aea-49e5-9d5e-1b4178008965@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (3.6ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 13ms (ActiveRecord: 4.3ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-5a87e004-8a9d-4d1f-9914-ea68837b8804@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-5a87e004-8a9d-4d1f-9914-ea68837b8804@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (1.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 5539ad63-18b9-43d6-9af5-463841c019ac) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ff5b17ef690 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-711087b2-2ac3-42be-b7af-b7afe1bfa663@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-711087b2-2ac3-42be-b7af-b7afe1bfa663@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8a4ae148-2af4-4526-bcec-e1f3b3633fcf@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8a4ae148-2af4-4526-bcec-e1f3b3633fcf@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 81f2c40d-6936-4d78-ba2b-0f756c9e35f2) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ff5b2b281f8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-315c3174-93ee-472f-bd85-8515167c9eb7@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-315c3174-93ee-472f-bd85-8515167c9eb7@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c3e37e36-f964-4640-bdf7-790a57aff0c6@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c3e37e36-f964-4640-bdf7-790a57aff0c6@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c222489a-a074-4b51-9e92-d988cff3b0d0) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ff5b391c160 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8f92d5dd-87ce-4e5e-922e-9d591d7756ed@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8f92d5dd-87ce-4e5e-922e-9d591d7756ed@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 9535c2a4-27e4-4184-a7b0-e72d80f4128a) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ff5b2cf48b0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.7ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 10:29:11 UTC], ["updated_at", 2017-04-19 10:29:11 UTC]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 583e6d06-dd71-4111-8741-a0853e34ef2c) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ff0b45a53f0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2147082e-d86d-4f4f-aef6-e6969958a042@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2147082e-d86d-4f4f-aef6-e6969958a042@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 274e5e01-1994-4f10-a593-0af144d88b92) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ff0b30210d8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-79beeb4f-9e7e-4bd3-8b3a-e3f459f96b7a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-79beeb4f-9e7e-4bd3-8b3a-e3f459f96b7a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8fdb3142-8955-4578-893d-ef77bb0e9d21@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8fdb3142-8955-4578-893d-ef77bb0e9d21@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c0054ba9-e998-4f01-aa41-323b669b61a0) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ff0b305b508 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6fb815da-c564-48b8-9342-76d2f35fa3d8@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6fb815da-c564-48b8-9342-76d2f35fa3d8@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: be517db4-55dc-4baf-9832-af3ad23a1c66) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ff0b450e400 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-900d9caf-4e75-47db-a78e-aa9e4a21a99e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-900d9caf-4e75-47db-a78e-aa9e4a21a99e@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-780aa4ec-bda0-450a-943c-cb5bb68a8f3f@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-780aa4ec-bda0-450a-943c-cb5bb68a8f3f@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1ccafa42-11d4-4b06-bfae-d579161d90e2) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ff0b683b838 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (5.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8d84a402-b469-4ecd-970f-f429449eb6fa@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8d84a402-b469-4ecd-970f-f429449eb6fa@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: df527b38-10f8-4496-9bfa-4b1c115d8fa6) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ff0b471d570 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 19ms (Views: 0.6ms | ActiveRecord: 0.9ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-bcfbbf9f-2286-414c-8405-4769fb1ef526@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-bcfbbf9f-2286-414c-8405-4769fb1ef526@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 284fd0b5-9950-4386-b903-c6ef0e3bce1b) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ff0b6a6bf40 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 15ms (Views: 0.2ms | ActiveRecord: 1.7ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-645b2582-8989-4710-9198-223d4fdd3c7f@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-645b2582-8989-4710-9198-223d4fdd3c7f@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 12ms (Views: 0.4ms | ActiveRecord: 1.6ms)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.5ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 10:30:27 UTC], ["updated_at", 2017-04-19 10:30:27 UTC]]
  [1m[35m (1.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3aa420a8-6313-4693-8c79-8a06b8b0f049@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3aa420a8-6313-4693-8c79-8a06b8b0f049@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 89d2db23-096f-4c97-a156-6e5f275c59ef) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f81cb00a718 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
Completed 422 Unprocessable Entity in 298ms (Views: 0.5ms | ActiveRecord: 1.4ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c0a67acd-fa9a-4ced-9818-0e8b965b2e72@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c0a67acd-fa9a-4ced-9818-0e8b965b2e72@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c59e8e1c-cf06-4dd7-9b04-4eb7ac8d3ff5) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f81ccd386f0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
Completed 422 Unprocessable Entity in 10ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-51884144-3c51-4d51-aa51-d925d6b0deea@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-51884144-3c51-4d51-aa51-d925d6b0deea@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
Completed 422 Unprocessable Entity in 11ms (Views: 0.3ms | ActiveRecord: 0.8ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-692a82ea-768a-4638-bb56-9c982effc996@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-692a82ea-768a-4638-bb56-9c982effc996@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b861c511-a768-473c-9870-c6346ec37424) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f81ce915d50 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-99c8cd0d-685b-4ba0-9686-59ba75a66c38@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-99c8cd0d-685b-4ba0-9686-59ba75a66c38@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d140c3bf-06c9-41eb-b0cc-0871e32e8311) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f81ce9ee498 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-99709887-59da-463e-8b90-8b150cf1cb54@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-99709887-59da-463e-8b90-8b150cf1cb54@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4de801fd-84dc-4cc7-81c5-0f37461b9868) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f81cf1675f8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-935ea5e8-836a-4c9b-8e77-5bb377ba4566@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-935ea5e8-836a-4c9b-8e77-5bb377ba4566@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 960167bc-3029-48ba-ad82-5bab53f70aaf) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f81cea9c930 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.5ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-aa759116-8774-42bc-97e5-e0c04baefb15@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-aa759116-8774-42bc-97e5-e0c04baefb15@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c1148b5a-f874-44ab-aa3b-e3a0f9443750@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c1148b5a-f874-44ab-aa3b-e3a0f9443750@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 96373006-f31a-442f-9c73-4b87b8996ee0) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f81cf2165a8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ecbc461b-b18c-4d38-9d4f-14707e2f0b28@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ecbc461b-b18c-4d38-9d4f-14707e2f0b28@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-98d4c360-c829-4a75-bae3-ae4cf177b245@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-98d4c360-c829-4a75-bae3-ae4cf177b245@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-fa9572b0-be74-430f-9d86-7a6778c6fa9b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-fa9572b0-be74-430f-9d86-7a6778c6fa9b@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d83fd78f-7612-49b7-b59d-2b625eff0ee7@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d83fd78f-7612-49b7-b59d-2b625eff0ee7@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-5962c17d-b366-4454-becf-401e6b089600@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-5962c17d-b366-4454-becf-401e6b089600@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-675d6ab8-5662-4486-b38d-3704d2cbb192@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-675d6ab8-5662-4486-b38d-3704d2cbb192@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8fa2ee54-ce60-4901-9801-5d84628a3774@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8fa2ee54-ce60-4901-9801-5d84628a3774@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-48d2fd7a-3f30-4b31-a809-5fd75df3e06e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-48d2fd7a-3f30-4b31-a809-5fd75df3e06e@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (2.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e30e7eb9-87cb-425c-af82-bc98f3b1395c@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e30e7eb9-87cb-425c-af82-bc98f3b1395c@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 10:42:26 UTC], ["updated_at", 2017-04-19 10:42:26 UTC]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-28612300-540b-4be1-a912-65b67d557ce9@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-28612300-540b-4be1-a912-65b67d557ce9@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d284bb36-2fbc-437a-ac9d-6f063855953c) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fd086033000 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
Completed 422 Unprocessable Entity in 292ms (Views: 0.2ms | ActiveRecord: 0.9ms)
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-30c52b95-3120-4415-93bb-0b3201fb5074@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-30c52b95-3120-4415-93bb-0b3201fb5074@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7b3b23bc-2d30-4697-810c-ce98df2018fa) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fd085fda4f0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
Completed 422 Unprocessable Entity in 10ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e4b7aa77-66ab-4e5a-9b40-c531eb67a21e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e4b7aa77-66ab-4e5a-9b40-c531eb67a21e@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
Completed 422 Unprocessable Entity in 14ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a20e7043-8a1e-4711-9877-f4726f606c27@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a20e7043-8a1e-4711-9877-f4726f606c27@example.com"], ["name", "john doe"]]
  [1m[35m (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6cf46e57-7a10-4203-8a4b-7532cf875352@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6cf46e57-7a10-4203-8a4b-7532cf875352@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-18ec511b-66d4-4227-b9cf-7ea0c7bb6ae0@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-18ec511b-66d4-4227-b9cf-7ea0c7bb6ae0@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 261be134-16c6-4a1a-a1d4-a65abfab710c) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd08a2806b0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-49b5368d-eb02-4fbc-bb41-772e28837387@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-49b5368d-eb02-4fbc-bb41-772e28837387@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-102f6763-8994-4e05-8541-29c221c4bd32@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-102f6763-8994-4e05-8541-29c221c4bd32@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 51412214-739d-4311-8058-5b28a21cf9be) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd08a2c8f00 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-501e2ced-388b-494f-ba35-7f1eeb3df722@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-501e2ced-388b-494f-ba35-7f1eeb3df722@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 26b231d9-362f-45cd-8b12-784b870089a5) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd08a16c558 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2eb367f2-c08e-4796-a69a-971b4d1eb237@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2eb367f2-c08e-4796-a69a-971b4d1eb237@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-73bf8dbb-8ef0-46f9-a49d-9a4392011c79@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-73bf8dbb-8ef0-46f9-a49d-9a4392011c79@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 98fbed3a-dfc8-45df-a74c-677ea6dae9e6) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fd08a2500f0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1a11447f-d587-4838-b94f-260b2caa6ea1@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1a11447f-d587-4838-b94f-260b2caa6ea1@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: fdc866b4-324c-4222-9dfe-ce592dbada95) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fd08a32b808 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 10:45:05 UTC], ["updated_at", 2017-04-19 10:45:05 UTC]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4bbdf200-8061-4827-a1db-3ccb7631a388) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fab54188218 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (2.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6edb66cb-d3a1-4b2d-bdea-066260cf1bda@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6edb66cb-d3a1-4b2d-bdea-066260cf1bda@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
Completed 422 Unprocessable Entity in 245129ms (Views: 0.4ms | ActiveRecord: 1.5ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-7456a405-f841-45d8-8fc8-f284d98ca191@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-7456a405-f841-45d8-8fc8-f284d98ca191@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d7ddfe43-208d-4d7b-b1ca-e0de25b5f263) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fab5803b4d8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
Completed 422 Unprocessable Entity in 1860ms (Views: 0.2ms | ActiveRecord: 2.0ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-abe80176-97f0-460e-83b8-489cc55c2636@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-abe80176-97f0-460e-83b8-489cc55c2636@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 42f00b24-c8f7-4ce2-b50c-decd4a70320e) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fab581d0e10 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
Completed 422 Unprocessable Entity in 3815ms (Views: 0.3ms | ActiveRecord: 0.8ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (2.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-bdbbbde8-3dca-4a8b-93d6-b9bf41da9529@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-bdbbbde8-3dca-4a8b-93d6-b9bf41da9529@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 821e28cb-e049-4398-a263-4e5a564e68a3) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fab57daac00 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a821f2df-c8bf-4e7f-93c1-23c5fe00394e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a821f2df-c8bf-4e7f-93c1-23c5fe00394e@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 66d5dd11-0b16-4734-837e-20cac7d9b506) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fab57ddbcd8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e82b76a0-fb19-402d-bca5-5bc0af3045be@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e82b76a0-fb19-402d-bca5-5bc0af3045be@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e87c0975-97c2-47eb-a6da-3e10f3a3f808@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e87c0975-97c2-47eb-a6da-3e10f3a3f808@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d75a8158-adca-425e-b6bd-6292713dbcb3) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fab57a5cb70 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.6ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2d7869c7-5fd8-4a02-a18e-6bc311f8b743@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2d7869c7-5fd8-4a02-a18e-6bc311f8b743@example.com"], ["name", "john doe"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 57fcc540-6a12-44ee-b39e-bb67769b40e0) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fab57a33ba8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.4ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-bde33b53-cdd5-4637-8a36-ba1c6f5d005f@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-bde33b53-cdd5-4637-8a36-ba1c6f5d005f@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d44bd4dd-67e6-4ec4-9459-15e51e930d66@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d44bd4dd-67e6-4ec4-9459-15e51e930d66@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-34a3f289-c81a-4352-8da3-e6fe801c42b1@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-34a3f289-c81a-4352-8da3-e6fe801c42b1@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a487b6bc-e7f7-4153-b46e-18924eb15a90@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a487b6bc-e7f7-4153-b46e-18924eb15a90@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 10:50:34 UTC], ["updated_at", 2017-04-19 10:50:34 UTC]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-5244872e-d669-4fb9-afed-f4f10bea94e6@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (1.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-5244872e-d669-4fb9-afed-f4f10bea94e6@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c21fec55-5f9f-435f-9d8c-3ccd5663f33a) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fab6c83de10 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 2], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8fd8f412-db41-4ec1-92d9-eff75bf25bee) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fab6ccddfb0 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 5863ms (ActiveRecord: 1.7ms)
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9727a570-629e-4e7c-8e7e-ed738bdf1d8d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9727a570-629e-4e7c-8e7e-ed738bdf1d8d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 2], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6173443e-3c28-4028-b579-07d6a2660eed) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fab70bfcd90 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
Completed 500 Internal Server Error in 2204ms (ActiveRecord: 1.1ms)
  [1m[35m (2.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-483476f0-b9eb-401a-be93-f0be69f43d19@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-483476f0-b9eb-401a-be93-f0be69f43d19@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 586569fb-3ac3-40e7-9f12-0e92ce0f28a8) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fab6d965eb8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 2], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 1419ms (ActiveRecord: 1.0ms)
  [1m[35m (2.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9b375cbf-344c-4515-b699-cd8c0cf6a380@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9b375cbf-344c-4515-b699-cd8c0cf6a380@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 15490b86-c62f-4072-85f0-5e9737e16b03) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fab6da09d60 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a4a8bce9-b6e4-4d28-96c0-36eb66a15290@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a4a8bce9-b6e4-4d28-96c0-36eb66a15290@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-104eb959-e279-4d53-bc89-f463f2bbe4cc@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-104eb959-e279-4d53-bc89-f463f2bbe4cc@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", -200], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 68005e98-1e73-45f9-8812-02a45bdffe58) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fab6d12bd88 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a2f88472-077a-48f2-b408-3a88b38de09b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a2f88472-077a-48f2-b408-3a88b38de09b@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 9c7e0a0a-8c91-4f32-b6c2-ca6598a9e0c6) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fab6d211248 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-35ff4578-a362-4ef9-a0c4-babb3863050d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-35ff4578-a362-4ef9-a0c4-babb3863050d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 9c5b7712-fed7-4085-aad6-5b9df9254b61) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fab70d97e98 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b7e454ed-b20e-483d-b47a-7230ddfbf802@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b7e454ed-b20e-483d-b47a-7230ddfbf802@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e5019ba2-3306-4ce7-a8bb-d88fad57f1c0) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fab710df678 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-dd02bd9f-a409-4012-a51e-665102b31b88@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-dd02bd9f-a409-4012-a51e-665102b31b88@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f55b06f8-6286-492d-a938-4e0c5b4d0553) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fab70dbf600 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-118d5ce9-1bde-4ce3-8b15-67dba246f1b3@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-118d5ce9-1bde-4ce3-8b15-67dba246f1b3@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d3c173e0-3a10-4fb1-b8bd-458ded411204@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d3c173e0-3a10-4fb1-b8bd-458ded411204@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 60263f9e-85a0-4d27-ad70-2cab3e8b8e47) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fab6d252658 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 10:52:10 UTC], ["updated_at", 2017-04-19 10:52:10 UTC]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b8644a1a-f368-4b06-865a-30436ab02d03@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b8644a1a-f368-4b06-865a-30436ab02d03@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ea160e27-26dd-401f-9f5a-81f74b1938c4@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ea160e27-26dd-401f-9f5a-81f74b1938c4@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f6037faf-fc37-4143-9021-144c49fe6e5b) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007faccfb23dc8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0a15f06d-050c-45d1-8e67-0b25bb05bfdf@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0a15f06d-050c-45d1-8e67-0b25bb05bfdf@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4fe22973-41ba-4c1b-ba3c-9ca150850a34) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007facce8480a0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a6f2c62a-cfc7-4762-8c6d-b4cee9c103e6@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a6f2c62a-cfc7-4762-8c6d-b4cee9c103e6@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 468521d9-43d5-4aea-9e40-f535679b1e51) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007facd10583b0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
Completed 422 Unprocessable Entity in 43ms (Views: 0.3ms | ActiveRecord: 1.6ms)
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (1.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-5f29ce8f-45cb-4226-b7b5-b2edc632fd09@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-5f29ce8f-45cb-4226-b7b5-b2edc632fd09@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
Completed 422 Unprocessable Entity in 8ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-4a9402e7-90d9-4a1d-8286-482074e4fbbd@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-4a9402e7-90d9-4a1d-8286-482074e4fbbd@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 02f279a1-c90b-4b16-ac0f-e9280a8d9115) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007facd12aeb50 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
Completed 422 Unprocessable Entity in 9ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: fed3920f-91cc-47a7-aef9-f2b0be19e397) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007faccfd88618 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3a72c569-904d-43e5-92d9-ba9563a6d3b6@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3a72c569-904d-43e5-92d9-ba9563a6d3b6@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 65c29ffc-ca35-4bbd-b6ce-7f97ad4f504f) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007faccfdb8e58 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-aee45f96-5443-49f8-90c5-95175e9493f2@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-aee45f96-5443-49f8-90c5-95175e9493f2@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-de6a33cd-e3a5-4a7c-85e4-b9f2503308f8@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-de6a33cd-e3a5-4a7c-85e4-b9f2503308f8@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 08b4fcf7-10b8-4312-b655-e247a23d383d) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007faccd1a8548 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a4d82bf7-06ba-46de-8295-9ee42c30d099@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a4d82bf7-06ba-46de-8295-9ee42c30d099@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-057b540e-7f7b-479e-b797-432f9f087d45@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-057b540e-7f7b-479e-b797-432f9f087d45@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b51cfb9f-4ef3-438b-be5c-82323bca9f51@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b51cfb9f-4ef3-438b-be5c-82323bca9f51@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (3.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-18b3139f-c6ab-48e1-ad53-1ca67a5daaf8@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-18b3139f-c6ab-48e1-ad53-1ca67a5daaf8@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f1762b46-8fcc-48b6-a8f2-ad5ec4253bcc@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f1762b46-8fcc-48b6-a8f2-ad5ec4253bcc@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-4bfccb39-a31a-4078-9713-ddf60d32ae0b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-4bfccb39-a31a-4078-9713-ddf60d32ae0b@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-21ec94bc-ba97-4357-bc84-69ae6bfe617d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (1.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-21ec94bc-ba97-4357-bc84-69ae6bfe617d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d0895439-262b-42d3-845f-5d301d1c5e18@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d0895439-262b-42d3-845f-5d301d1c5e18@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f34840f1-e287-4c1a-9824-a62b155110bd@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f34840f1-e287-4c1a-9824-a62b155110bd@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a23ceba3-958b-48a9-883a-584bdd4eea9b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a23ceba3-958b-48a9-883a-584bdd4eea9b@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b05e24a2-a921-40a8-bc61-677ad93918ce@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b05e24a2-a921-40a8-bc61-677ad93918ce@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-57f30549-8c34-4792-99da-9b0f61d9ea5f@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-57f30549-8c34-4792-99da-9b0f61d9ea5f@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 11:37:21 UTC], ["updated_at", 2017-04-19 11:37:21 UTC]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1564e3b9-eafd-4b38-bfbf-68d5518c0d02@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1564e3b9-eafd-4b38-bfbf-68d5518c0d02@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3c75f42c-1eec-4cad-b7d9-66bbdff1e350) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ffaf2cf6170 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-789cfc48-7ebf-4ade-811f-ae83dc87279b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-789cfc48-7ebf-4ade-811f-ae83dc87279b@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9a1bbffc-0dcb-4f37-a441-78c827900f05@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9a1bbffc-0dcb-4f37-a441-78c827900f05@example.com"], ["name", "john doe"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ba86a550-487c-4384-b06a-a019818a9b0e) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ffaf2b95b00 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (4.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e70eb949-eca7-4e02-a4ec-985644b1b863@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e70eb949-eca7-4e02-a4ec-985644b1b863@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
Completed 422 Unprocessable Entity in 34ms (Views: 0.3ms | ActiveRecord: 2.2ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1b247ac5-e994-470e-8e77-432066b3b58f@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1b247ac5-e994-470e-8e77-432066b3b58f@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: af87754d-d2c7-480f-ad8d-dbe1b4edd38a) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ffaf2148d28 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
Completed 422 Unprocessable Entity in 8ms (Views: 0.2ms | ActiveRecord: 1.2ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0639e74f-d695-4f0e-89ce-a31db5a4a35d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0639e74f-d695-4f0e-89ce-a31db5a4a35d@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 864721f0-6ab4-49f1-a109-3cb7ccbe7306) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ffaf4ca0ed0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
Completed 422 Unprocessable Entity in 12ms (Views: 0.2ms | ActiveRecord: 1.1ms)
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3cd2ec36-1d2b-4017-b90b-f39a29e06b5b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3cd2ec36-1d2b-4017-b90b-f39a29e06b5b@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c9cf0892-a5cd-4425-b1a3-e40859c63c02@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c9cf0892-a5cd-4425-b1a3-e40859c63c02@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6d5bfbdb-78ef-486e-907f-b36eefc9fcdb@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6d5bfbdb-78ef-486e-907f-b36eefc9fcdb@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-30d462e0-2017-4c52-b215-bd45a2a98a85@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-30d462e0-2017-4c52-b215-bd45a2a98a85@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (3.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-631fc902-cd2e-4ed3-889c-e5c512e9fae1@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-631fc902-cd2e-4ed3-889c-e5c512e9fae1@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 17be6798-0f87-41da-9eb5-695fa42a345d) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ffaf4d815e8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-aa0502f4-63e3-4df9-9547-40a940b705ba@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-aa0502f4-63e3-4df9-9547-40a940b705ba@example.com"], ["name", "john doe"]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 98fee267-89a4-4df1-987a-a222f5827bdc) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ffaf600a700 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0c42d249-5a40-4d28-92b9-b0a9700904c9) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ffaf2270f98 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.6ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 11:37:49 UTC], ["updated_at", 2017-04-19 11:37:49 UTC]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-bd27a57f-e357-46c7-9b82-b07820c1b605@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-bd27a57f-e357-46c7-9b82-b07820c1b605@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: cc605107-676a-4fc9-b414-95d9f617a8c2) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fbd5b13d808 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.2ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
Completed 422 Unprocessable Entity in 384820ms (Views: 0.8ms | ActiveRecord: 1.3ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a7969945-8f66-4ef7-a1ab-3638e35d2c93@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a7969945-8f66-4ef7-a1ab-3638e35d2c93@example.com"], ["name", "john doe"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 11665db2-22d1-4c9d-8202-c06fd3a00da1) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fbd5ebd12a8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.2ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
Completed 422 Unprocessable Entity in 1264ms (Views: 0.2ms | ActiveRecord: 1.1ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-bb8412d1-6a30-4a35-be29-a90a2bba70a6@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-bb8412d1-6a30-4a35-be29-a90a2bba70a6@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
Completed 422 Unprocessable Entity in 745ms (Views: 0.3ms | ActiveRecord: 0.9ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-7f0a7d33-e3f3-47c7-bd84-1c31255c6c6e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-7f0a7d33-e3f3-47c7-bd84-1c31255c6c6e@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 70ba9df6-84fc-467f-82d1-bbabe3247eaa) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fbd5eca37f8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-22990eb5-e77b-472a-b526-203e809084da@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-22990eb5-e77b-472a-b526-203e809084da@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-bce3b510-09e5-4941-995d-3473948c343e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (1.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-bce3b510-09e5-4941-995d-3473948c343e@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 305bda08-857f-4e76-af56-2307d44f71e8) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fbd5f515d28 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-45acfdcd-e902-4d57-a396-c3ebddd91b6a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-45acfdcd-e902-4d57-a396-c3ebddd91b6a@example.com"], ["name", "john doe"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 06c801ab-3f7b-4b31-bed5-ec4a436fcb1d) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fbd5b9c08e0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-38c7f0e7-68d4-4ece-9ee7-eac481efe9ec@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-38c7f0e7-68d4-4ece-9ee7-eac481efe9ec@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-766b12bb-5cf3-40b6-a7a3-e329da1989e6@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-766b12bb-5cf3-40b6-a7a3-e329da1989e6@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7db6ef39-3675-4de3-8bc5-4b2211c86ae3) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fbd5f54f668 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a307071d-de40-4f7a-94c5-05bdb1c579d0@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a307071d-de40-4f7a-94c5-05bdb1c579d0@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (4.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6faa6ec5-4c5f-4315-b6c2-97e839295448@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6faa6ec5-4c5f-4315-b6c2-97e839295448@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e5f4e973-6e0a-43f1-8d70-d7a99c293e39@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e5f4e973-6e0a-43f1-8d70-d7a99c293e39@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ea47cfb2-9ce1-4cc6-a859-c7c79174f141) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fbd5eb61110 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 11:44:38 UTC], ["updated_at", 2017-04-19 11:44:38 UTC]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.4ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-5d44c73a-40a0-40a6-8c44-5b80db603a1a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-5d44c73a-40a0-40a6-8c44-5b80db603a1a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-982835cb-6f40-408f-a036-55507fcf6c6c@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-982835cb-6f40-408f-a036-55507fcf6c6c@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7ff79e5c-0415-44c3-b6db-0c6529921348) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ff720acaae8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-36768d7e-4be8-458f-a111-adfb3d397870@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-36768d7e-4be8-458f-a111-adfb3d397870@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 5a2e1fc3-3abe-498c-9e9f-070a5ff068f7) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ff71f31a178 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.4ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6b58008f-bf42-4419-969e-557a5a18f72c@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6b58008f-bf42-4419-969e-557a5a18f72c@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d5be18c1-bd21-4505-97d3-d576e9b41db9) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007ff720c9a3a0 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-576e6155-8982-4efe-93e2-6d3ad78e8a08@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-576e6155-8982-4efe-93e2-6d3ad78e8a08@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 2ca06495-4492-4e8a-86f2-0e6969c67402) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007ff72318a0e8 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e8c4f218-7079-41f6-bfe6-bc6c62fe6b13@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e8c4f218-7079-41f6-bfe6-bc6c62fe6b13@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b4d9d132-6e40-4144-b3e3-e557c6675fc8@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b4d9d132-6e40-4144-b3e3-e557c6675fc8@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6109c4f9-25b8-42f0-b8b0-912cc1533767) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ff720ed4940 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (1.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1cbb9223-adf2-459e-a743-02795f7e5bae@example.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1cbb9223-adf2-459e-a743-02795f7e5bae@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2f70af2b-a5c2-4105-903f-3036af090bb9@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2f70af2b-a5c2-4105-903f-3036af090bb9@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 49f3316e-8f64-4d55-8497-6700fc8be22b) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ff720f7cd48 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3d332677-652c-4fb2-b3ea-c5c9d9e12764@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3d332677-652c-4fb2-b3ea-c5c9d9e12764@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 950b63ae-f5bf-4679-a31a-eb1ae2720cb3) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ff720fc4eb8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 2], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
Completed 500 Internal Server Error in 23740ms (ActiveRecord: 1.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-4f84dd78-ce28-435f-9dab-76e40f2a0db1@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-4f84dd78-ce28-435f-9dab-76e40f2a0db1@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 2], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d8d26220-faf3-44d2-86fe-d6e657be658f) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007ff72335fcd8 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
Completed 500 Internal Server Error in 2875ms (ActiveRecord: 1.3ms)
  [1m[35m (3.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-74699b2f-5f4e-4363-b8b4-69285f5b1343@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-74699b2f-5f4e-4363-b8b4-69285f5b1343@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1113affc-a55b-4507-a0bb-352a6065a4db) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ff71fb32f90 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 2], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a0712152-fff8-4ee2-95ff-b583dfa521dc) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007ff72492ad88 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 1856ms (ActiveRecord: 1.3ms)
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 53605ab4-504e-44ce-bcbc-b07c177e1f91) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ff72377fc78 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 11:49:24 UTC], ["updated_at", 2017-04-19 11:49:24 UTC]]
  [1m[35m (1.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2cf2070a-abe8-4ebc-abeb-f8f7ee3d6f0a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2cf2070a-abe8-4ebc-abeb-f8f7ee3d6f0a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.0ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 2f78d8b6-552c-42c9-84c0-ad65529f0524) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ffc1b8c2160 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-78cbacdb-e106-40eb-aadd-3ec8a41e5a46@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-78cbacdb-e106-40eb-aadd-3ec8a41e5a46@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 36f9a79a-4044-461b-818c-9406f5c15a49) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ffc1b83fc60 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-89aecd9a-99a7-429b-b737-31c142933611@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-89aecd9a-99a7-429b-b737-31c142933611@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1298913d-6371-44fd-8494-56ef5c18fd2e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1298913d-6371-44fd-8494-56ef5c18fd2e@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.0ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
Completed 422 Unprocessable Entity in 22ms (Views: 0.2ms | ActiveRecord: 1.3ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-88ee58ae-ec5f-4a34-80f0-e6eac46954c0@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-88ee58ae-ec5f-4a34-80f0-e6eac46954c0@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 05bca930-29e7-4114-82c8-42273babfb5c) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ffc1afc6048 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
Completed 422 Unprocessable Entity in 14ms (Views: 0.2ms | ActiveRecord: 1.6ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a8e048c8-3c97-445c-b0e6-4fe5fd81bce5@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a8e048c8-3c97-445c-b0e6-4fe5fd81bce5@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 43bf6e2a-47ba-486d-895b-eb18e5c71607) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ffc1ea20950 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 2[0m
Completed 422 Unprocessable Entity in 15ms (Views: 0.2ms | ActiveRecord: 1.0ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c36feb92-105b-4260-8ab4-07fa85e771f7@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c36feb92-105b-4260-8ab4-07fa85e771f7@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e57c68bc-a5ed-4346-8cbb-6c29f8ae42ce@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e57c68bc-a5ed-4346-8cbb-6c29f8ae42ce@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-21b65edc-0892-41d3-a2ac-1559b65e37ba@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-21b65edc-0892-41d3-a2ac-1559b65e37ba@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6d04b885-bdc8-4353-8db7-7cd0f0f8e6fd) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ffc1ec73388 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-24767381-efef-4bc7-a2b5-5aae25b2989f@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-24767381-efef-4bc7-a2b5-5aae25b2989f@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 64abec09-fd1a-4fd3-a158-2689f73a02e7) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ffc1ed626e0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ff5c7371-a5ea-431d-8e44-edc9747220fb@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ff5c7371-a5ea-431d-8e44-edc9747220fb@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 565652db-4d24-4cb3-84f5-fb6d5f41410f) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ffc2004db38 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-96e4fa17-95c4-4a8a-9576-67c1108058de@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-96e4fa17-95c4-4a8a-9576-67c1108058de@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 11:53:07 UTC], ["updated_at", 2017-04-19 11:53:07 UTC]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 522d61ba-4367-4574-bcd8-267f4df4164b) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f84c5570868 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (1.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-392b2683-fda5-427e-9fd6-5e05b3ec103b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-392b2683-fda5-427e-9fd6-5e05b3ec103b@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4ccdacea-8f1f-4001-a28d-4e177939974a) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f84c4e57c20 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9375b343-34d6-45e3-b2c1-d203d3bcbc69@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9375b343-34d6-45e3-b2c1-d203d3bcbc69@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e206906a-ba2e-4c04-a89e-a8d6cf8ab9b6@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e206906a-ba2e-4c04-a89e-a8d6cf8ab9b6@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 92a64f78-c42f-46ad-a78a-bc2a79dbb91d) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f84c541b0a8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0fde6474-012d-418d-a4ee-f6f80a738ae1@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0fde6474-012d-418d-a4ee-f6f80a738ae1@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3f1ac316-331f-4a16-b593-7a12ff8f4c0b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3f1ac316-331f-4a16-b593-7a12ff8f4c0b@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 5f2bbd10-2af9-47db-ba8a-7df3bf6b25d8) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f84c55b87f8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b7f61cef-75b4-430d-b820-e0847afa532e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b7f61cef-75b4-430d-b820-e0847afa532e@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 39673c76-6310-44b5-abb1-0fad9bcab051) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f84c56b9288 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.5ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (3.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a24e4302-e0d7-4272-9749-1839cd370c69@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a24e4302-e0d7-4272-9749-1839cd370c69@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d38dab15-dcbd-4756-9246-eaad85e47dd6@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d38dab15-dcbd-4756-9246-eaad85e47dd6@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-883f98e9-1680-419a-8c63-751c81e873ce@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-883f98e9-1680-419a-8c63-751c81e873ce@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3119abfd-e801-4b29-9380-035ec9bd5ec2@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3119abfd-e801-4b29-9380-035ec9bd5ec2@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (9.2ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a53d308e-1b70-4e65-ad59-509ae1d91b86) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f84c788b0a0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 29ms (Views: 0.3ms | ActiveRecord: 10.1ms)
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a33be53e-fafb-4e09-a26c-36e9e30d76d2@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a33be53e-fafb-4e09-a26c-36e9e30d76d2@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a450d90a-d19b-46fc-95aa-1ab81e5cb074) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f84c68db5d8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 11ms (Views: 0.3ms | ActiveRecord: 1.0ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3727877c-85c6-40d6-91d3-01a0e817fbc7@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3727877c-85c6-40d6-91d3-01a0e817fbc7@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (3.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 6ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.9ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 11:55:19 UTC], ["updated_at", 2017-04-19 11:55:19 UTC]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d519c902-bf36-458f-9728-1f941a8b336f@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d519c902-bf36-458f-9728-1f941a8b336f@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 13ms (Views: 0.3ms | ActiveRecord: 0.9ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-eda131a9-0bf3-4a81-9955-08ed9393d5cf@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-eda131a9-0bf3-4a81-9955-08ed9393d5cf@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 5cf73605-8bf2-43b4-b983-57de02c3f085) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f9ab3ef88f0 @uri=#<URI::GID gid://dummy/User/2>>
Completed 422 Unprocessable Entity in 15ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.4ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-27292e35-7f3f-47fe-81cb-7952f5201e85@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-27292e35-7f3f-47fe-81cb-7952f5201e85@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4813f774-29ee-42c6-b1a5-4f2cb9f6372f) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f9ab26e8328 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 11ms (Views: 0.2ms | ActiveRecord: 1.4ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-90d79905-7ec5-4f96-9a37-ec7ec4558b85@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-90d79905-7ec5-4f96-9a37-ec7ec4558b85@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-804897b9-dee4-4fb4-99e9-ecc99e548712@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-804897b9-dee4-4fb4-99e9-ecc99e548712@example.com"], ["name", "john doe"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e6f53785-b2ad-450e-88d1-3ab325ce1b44) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f9ab52461f0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0f022d97-81e3-4cdd-afa5-60476da67adc@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0f022d97-81e3-4cdd-afa5-60476da67adc@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a76e4956-5d4c-43fe-9200-a8d05a8a243e) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f9ab5315c70 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.4ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a27df7b5-efca-4424-add1-3323efd3136b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a27df7b5-efca-4424-add1-3323efd3136b@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-7593debd-070c-4b8f-bfd0-0ced95d8dfe4@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-7593debd-070c-4b8f-bfd0-0ced95d8dfe4@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: dfe13e44-2198-4f9f-bcf1-e70ba005c49c) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f9ab5526690 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-79593d20-3a3a-471d-9489-f9aa74ee1749@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-79593d20-3a3a-471d-9489-f9aa74ee1749@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: aab931fa-951f-4aa5-8388-e922d6fd0ab0) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f9ab68b50a8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (3.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 9dbabe59-00da-4c9c-b385-47cab10aa11c) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f9ab5591508 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-7cd152af-004a-48b3-9a41-f02df30f6b4b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-7cd152af-004a-48b3-9a41-f02df30f6b4b@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f76a19ab-b17d-4bf4-b33a-6ccea01931af@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f76a19ab-b17d-4bf4-b33a-6ccea01931af@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f857c84a-0879-464c-9e92-923ac27d8401@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f857c84a-0879-464c-9e92-923ac27d8401@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (3.4ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 11:58:39 UTC], ["updated_at", 2017-04-19 11:58:39 UTC]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-66db17df-d78f-4634-8c03-67f597e8e870@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-66db17df-d78f-4634-8c03-67f597e8e870@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 06b03c29-4fd8-4651-9036-c22aef7df0e4) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fefca437b70 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35m (0.3ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-dee8788f-496a-47f3-9258-d81338bd83df@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-dee8788f-496a-47f3-9258-d81338bd83df@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-38c346dd-45e5-41ac-a306-531783dfa7f3@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-38c346dd-45e5-41ac-a306-531783dfa7f3@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4704d651-f22a-4c29-9911-fd8b614a1b41) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fefcd8107f8 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a32c4ec1-9588-4811-b552-97d0c8ee7510) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fefca6a2a90 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6c286143-30d1-4c9e-9e51-f229ff104b77@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6c286143-30d1-4c9e-9e51-f229ff104b77@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 29d44c1e-c083-4614-bb06-cfc75eb8cd07) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fefca70a050 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.7ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-56a377e2-600b-43fb-9529-9b773ed4296d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-56a377e2-600b-43fb-9529-9b773ed4296d@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f922ef9e-d463-4aaa-8773-000dca398747@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f922ef9e-d463-4aaa-8773-000dca398747@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3b977918-0902-4613-8b26-48d5faae76a8) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fefce0651d8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-bb9ecd2f-e5a9-4ad0-a3f9-378d3712e666@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-bb9ecd2f-e5a9-4ad0-a3f9-378d3712e666@example.com"], ["name", "john doe"]]
  [1m[36mInvitation Load (0.5ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 53b3d6df-ba0c-47e7-91d1-dbe1eecad2ac) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fefce3a2c88 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 25ms (ActiveRecord: 1.5ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-241934af-cab4-499b-b405-d61010b517e7@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-241934af-cab4-499b-b405-d61010b517e7@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8fe0c8d5-f0a1-42ab-a1e6-5097319436af) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fefc9f156b0 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 24ms (ActiveRecord: 1.2ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-220aa09c-9670-4e50-8237-a6b380e7c773@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-220aa09c-9670-4e50-8237-a6b380e7c773@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 06e4c0d1-e325-4c86-8327-d8348dec840a) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fefce481eb0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f930145e-f919-4bcd-84cb-ef1e1941afdb) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fefce470e08 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 14ms (ActiveRecord: 1.1ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1587c903-e91a-4b24-998c-9be26e7c25a1@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1587c903-e91a-4b24-998c-9be26e7c25a1@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ee93afdf-ee77-45c2-b966-2754e5c7dce9) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fefce552e20 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1a2f1499-b139-433c-a8c4-ae37e65a11b3@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1a2f1499-b139-433c-a8c4-ae37e65a11b3@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: bf5bf150-0eb0-4667-8f53-830f251917e5) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fefcd9d59d0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (2.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9ea2c2c7-cb6d-4424-b971-aee3e6f63947@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9ea2c2c7-cb6d-4424-b971-aee3e6f63947@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.3ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 11:59:00 UTC], ["updated_at", 2017-04-19 11:59:00 UTC]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ab59fbfb-ef28-4519-abea-8ff4eb3bc55f) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fc95b553648 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-11dfc01e-7974-4d80-bde8-79fc4d6e3e11@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-11dfc01e-7974-4d80-bde8-79fc4d6e3e11@example.com"], ["name", "john doe"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 22ms (Views: 0.8ms | ActiveRecord: 1.4ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (1.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2d1d26ef-c146-44f1-a39c-7211c1413fe1@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2d1d26ef-c146-44f1-a39c-7211c1413fe1@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (3.4ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 80a76112-0916-492a-ad93-096f2b36152f) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fc95afe2a88 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 17ms (Views: 0.5ms | ActiveRecord: 4.1ms)
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8ca6b70c-9f14-4121-b63b-8f24c7067cd5@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8ca6b70c-9f14-4121-b63b-8f24c7067cd5@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 826fcd0d-ef34-473e-8ae8-3dac84e81f4c) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fc95ea13ba8 @uri=#<URI::GID gid://dummy/User/2>>
Completed 422 Unprocessable Entity in 13ms (Views: 0.2ms | ActiveRecord: 1.2ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.4ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-54c6cabf-012c-4b2b-880e-4a2b8bd79552@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-54c6cabf-012c-4b2b-880e-4a2b8bd79552@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 21844865-acd4-43b6-8e5c-91205b16f48a) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fc95ee18140 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ea22d6b0-25b4-4401-9d39-4b902523a360@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ea22d6b0-25b4-4401-9d39-4b902523a360@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-4a8124f0-cbc6-420f-864b-9c984c222281@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-4a8124f0-cbc6-420f-864b-9c984c222281@example.com"], ["name", "john doe"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b26f3f4d-05cd-481f-a365-e1a2a42d18ad) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fc95ef0a0f8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9925151f-021b-4c43-ba17-4f5b8c36d8da@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9925151f-021b-4c43-ba17-4f5b8c36d8da@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-649c11a7-f03d-4246-949a-e51cbb84e668@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-649c11a7-f03d-4246-949a-e51cbb84e668@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: bec67687-33c4-499a-840e-b488a622868a) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fc95eed06f0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-5ae41d9c-9cc4-47fe-9787-a1ad675634f0@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-5ae41d9c-9cc4-47fe-9787-a1ad675634f0@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0d50270b-2092-4b45-8171-39314449182d) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fc95eeb2e48 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-04438baa-8d37-40df-9a4e-aa62d68baad7@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-04438baa-8d37-40df-9a4e-aa62d68baad7@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c97b67a7-add7-449d-9bb6-dc617524a7ef@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c97b67a7-add7-449d-9bb6-dc617524a7ef@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2170ff21-86a7-493c-88e9-df1a9756aa2b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2170ff21-86a7-493c-88e9-df1a9756aa2b@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-197bf639-dde4-4398-a9b8-8ea33eba69bb@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-197bf639-dde4-4398-a9b8-8ea33eba69bb@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8866739d-7ac1-42a8-b1b9-fb0eefb1cc33@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8866739d-7ac1-42a8-b1b9-fb0eefb1cc33@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ece0cdd8-ad20-4735-8b61-4b03ccd34959@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ece0cdd8-ad20-4735-8b61-4b03ccd34959@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6bd8e82d-e7b7-46e2-bec5-50311007b641@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6bd8e82d-e7b7-46e2-bec5-50311007b641@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 944c910d-1aa3-4d9d-9876-606d1e63930c) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fb6ef40f058 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-36d93652-5166-47cf-8c68-cf0e25f86ddc@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-36d93652-5166-47cf-8c68-cf0e25f86ddc@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 64fc14be-45f7-4388-a641-4c7d790d7d22) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fb6f29b38a8 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b8dd238c-52bb-4235-a2f1-6c2b76ef4bd7@example.com"], ["LIMIT", 1]]
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b8dd238c-52bb-4235-a2f1-6c2b76ef4bd7@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.4ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ed26b108-5362-4001-91f4-8e114a500c38@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ed26b108-5362-4001-91f4-8e114a500c38@example.com"], ["name", "john doe"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b50448c2-ff54-43ee-b6d7-62b8a09eb491@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b50448c2-ff54-43ee-b6d7-62b8a09eb491@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9ca60f8a-ea6f-4173-af1f-2692a0b0c2bb@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9ca60f8a-ea6f-4173-af1f-2692a0b0c2bb@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-504ec7c4-85fd-47af-9079-fdc2851b6f03@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-504ec7c4-85fd-47af-9079-fdc2851b6f03@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-dc9d195b-c084-4625-bd51-b1f7fe72e4b6@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-dc9d195b-c084-4625-bd51-b1f7fe72e4b6@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6fcec99a-dcc4-4227-856e-eb48bf418e59@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6fcec99a-dcc4-4227-856e-eb48bf418e59@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8360d32e-7066-4ad4-a1ad-69addbf96658@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8360d32e-7066-4ad4-a1ad-69addbf96658@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-da580dcf-c7ab-4293-87cb-40f5fcd12ea5@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-da580dcf-c7ab-4293-87cb-40f5fcd12ea5@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ab5a4bf5-b41a-4e86-a2f8-2e6f53b2b513@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ab5a4bf5-b41a-4e86-a2f8-2e6f53b2b513@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-49989e00-9e96-489a-95f0-e7c4ac3dd7d9@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-49989e00-9e96-489a-95f0-e7c4ac3dd7d9@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9ab3cafd-b9a7-45ef-b837-92447073d0aa@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9ab3cafd-b9a7-45ef-b837-92447073d0aa@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-934a550b-4106-48e8-8f80-86ebcd716c65@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-934a550b-4106-48e8-8f80-86ebcd716c65@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c436e036-6d31-4bea-994b-44fe653d33ca@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c436e036-6d31-4bea-994b-44fe653d33ca@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-4361cf0b-42a4-4e11-bda1-75fdafae91da@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-4361cf0b-42a4-4e11-bda1-75fdafae91da@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-5871dc37-f2ed-48aa-bc1e-fc7c667842af@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-5871dc37-f2ed-48aa-bc1e-fc7c667842af@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-4082fd62-5f1d-4b42-b7fa-2b452cc06a1a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-4082fd62-5f1d-4b42-b7fa-2b452cc06a1a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-70288a86-e6a5-4091-83b5-8d04999bbaca@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-70288a86-e6a5-4091-83b5-8d04999bbaca@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-dc0163e6-2897-4c1e-9e2b-ec639a6f8549@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-dc0163e6-2897-4c1e-9e2b-ec639a6f8549@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-bfb597bd-8f5b-4e72-8f0c-0ebcc86cf6a3@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-bfb597bd-8f5b-4e72-8f0c-0ebcc86cf6a3@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-edadc5d6-482e-4155-9a70-ffc5a5951797@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-edadc5d6-482e-4155-9a70-ffc5a5951797@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-354d91c2-aba9-492c-8bb2-64be398cf75c@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-354d91c2-aba9-492c-8bb2-64be398cf75c@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 12:10:07 UTC], ["updated_at", 2017-04-19 12:10:07 UTC]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-602da234-700c-47fe-9268-9827aa2f3ee7@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-602da234-700c-47fe-9268-9827aa2f3ee7@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e604a295-c8dd-4db3-8cd3-f2cd9bc9900c@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e604a295-c8dd-4db3-8cd3-f2cd9bc9900c@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-95c20ed7-9efb-45c7-b1b9-aebf53f8ec8c@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-95c20ed7-9efb-45c7-b1b9-aebf53f8ec8c@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-03de6fd8-d1fe-4a58-b20b-899a809b09eb@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-03de6fd8-d1fe-4a58-b20b-899a809b09eb@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 55843634-dcad-47b2-86d6-f44cec13b26d) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fcfc4b6c790 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-250594bf-979f-43ce-bc1c-8f3a405da5dd@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-250594bf-979f-43ce-bc1c-8f3a405da5dd@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 554f258c-2c4a-43f5-8b35-3ad0ca53f06b) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fcfc58f0498 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f9a2985e-0b89-43c2-8b30-e980821b32c0@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f9a2985e-0b89-43c2-8b30-e980821b32c0@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-bcb0355c-6960-485a-8ac6-96ca8cec565b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-bcb0355c-6960-485a-8ac6-96ca8cec565b@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 05127b28-725a-48fe-885f-04fa2c1e713e) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fcfc8424380 @uri=#<URI::GID gid://dummy/User/2>>
Completed 422 Unprocessable Entity in 251590ms (Views: 0.4ms | ActiveRecord: 1.1ms)
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-cbac5b58-d228-4f87-85d2-b27a8cbc33e2@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-cbac5b58-d228-4f87-85d2-b27a8cbc33e2@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1295625e-0e5f-4ff8-964b-5ab74d2c3370) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fcfc81504b0 @uri=#<URI::GID gid://dummy/User/2>>
Completed 422 Unprocessable Entity in 1399ms (Views: 0.2ms | ActiveRecord: 1.0ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2aa3b517-464c-4e5b-b6dd-0b70ef525dc3@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2aa3b517-464c-4e5b-b6dd-0b70ef525dc3@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 788ms (Views: 0.3ms | ActiveRecord: 1.0ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3678d3c9-5084-4c57-84e8-9f7e476b41dc@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3678d3c9-5084-4c57-84e8-9f7e476b41dc@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f0e88526-5fec-4a65-a2ea-40eaa1fdbcdd) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fcfc8039f68 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-fcc315d9-13c0-454e-a889-971e17201358@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-fcc315d9-13c0-454e-a889-971e17201358@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6b39982f-67c5-496e-8414-9f4dd3dda327@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6b39982f-67c5-496e-8414-9f4dd3dda327@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: aae432ec-27d4-480a-a78b-5987946a1b15) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fcfc5ac2230 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f602942a-1033-431d-b0dd-498069487328) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fcfc6fe0c70 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.6ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 12:14:27 UTC], ["updated_at", 2017-04-19 12:14:27 UTC]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: aa06b6c7-2072-418c-832d-4f4b7e0336e5) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb5ca10b490 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a5aac8e7-38f7-449b-8fb1-f8c6cb9c3d1d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a5aac8e7-38f7-449b-8fb1-f8c6cb9c3d1d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-85473341-86cb-49c1-bfbb-603812246e1a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-85473341-86cb-49c1-bfbb-603812246e1a@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c47ffd2e-f841-430b-b12e-4f74aa694200@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c47ffd2e-f841-430b-b12e-4f74aa694200@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-59bd32e5-f2ec-4f69-b43a-2ba8b889ef57@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-59bd32e5-f2ec-4f69-b43a-2ba8b889ef57@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7c3ceff7-c333-4b3c-a9c5-037a8060ac36) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb5cbabbe30 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-fe98475b-ba2d-4e17-9244-c89d5c6e7882@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-fe98475b-ba2d-4e17-9244-c89d5c6e7882@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-7d06da16-e780-4f77-ae48-b4cd3b83c232@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-7d06da16-e780-4f77-ae48-b4cd3b83c232@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 720b5563-ceb0-4fdb-902a-f06433112a4c) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb5c96d6560 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d5f9f56c-fded-4723-a543-74f2f0076a95@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d5f9f56c-fded-4723-a543-74f2f0076a95@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 17ms (Views: 0.3ms | ActiveRecord: 0.9ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9df411e7-6f07-4dd1-aedd-f49cd5737b33@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9df411e7-6f07-4dd1-aedd-f49cd5737b33@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e7bb43ae-9f66-42a4-88bc-a266da5c56bf) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb5c9415df8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 18ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-4248789e-6c9e-44e4-9e2f-dd57e0641a14@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-4248789e-6c9e-44e4-9e2f-dd57e0641a14@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 339231a1-a60a-44cf-b8c5-e3609a986ce1) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb5cbd40b60 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 12ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1adc8078-1e61-42bc-a71f-8fb722bb1cf7@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1adc8078-1e61-42bc-a71f-8fb722bb1cf7@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6f70628a-a7e0-476c-a72d-3aed134b63d3@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6f70628a-a7e0-476c-a72d-3aed134b63d3@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 584cc483-4aba-4031-81e9-2348efa3ba70) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb5cbded608 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e728099c-cc06-44f8-9d60-1499722b0de2@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e728099c-cc06-44f8-9d60-1499722b0de2@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4da095c0-8f7b-449c-94c9-f4abddd6f1fe) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb5ca8c4380 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.4ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (7.1ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 12:15:31 UTC], ["updated_at", 2017-04-19 12:15:31 UTC]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2fe4822a-a668-4afe-9792-9dc6a0838672@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2fe4822a-a668-4afe-9792-9dc6a0838672@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e41ddfcb-f1b1-44ed-8cc9-f3ab9d441cd2) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb80e18fc40 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 494276ms (Views: 0.5ms | ActiveRecord: 0.8ms)
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2e906f4b-3d05-4210-a93c-43b94ce828ff@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2e906f4b-3d05-4210-a93c-43b94ce828ff@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f58641b4-cab0-43db-985f-850ef73f8c7d) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb80d1cece8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 1440ms (Views: 0.2ms | ActiveRecord: 1.3ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (2.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f7a5ee66-274c-4352-a65f-352f4c7d5c55@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f7a5ee66-274c-4352-a65f-352f4c7d5c55@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 662ms (Views: 0.2ms | ActiveRecord: 0.9ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6e82c0ba-ed65-4d60-b71c-f17afadfdd06@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6e82c0ba-ed65-4d60-b71c-f17afadfdd06@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: bd031014-12d4-436e-95aa-c98f648ad538) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb80e6ad4c0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-03869233-1656-49bc-a91c-8a1fdbb9599e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-03869233-1656-49bc-a91c-8a1fdbb9599e@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 87df82b8-9fed-4c4a-80b6-51c21fbe9d10) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb8129218d8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-eab8d6d2-b51e-4a9a-9580-c2bbcbca6e16@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-eab8d6d2-b51e-4a9a-9580-c2bbcbca6e16@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6f4a3468-6aaf-43e7-a8fb-41225831e7dd) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb80e676cb8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-bfc513d2-42ec-4a39-8096-d231a83dba94@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-bfc513d2-42ec-4a39-8096-d231a83dba94@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3a5d977e-8930-420f-bf14-4f66eaf7ed0d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3a5d977e-8930-420f-bf14-4f66eaf7ed0d@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: dc6ff7a8-6daa-483d-84d0-15742b305281) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb80e63fc68 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-980c6d92-f43d-45a5-8f60-317756aed574@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-980c6d92-f43d-45a5-8f60-317756aed574@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 9fbccc46-e072-4193-8fb0-95bde59b5fa5) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb812980950 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d6aed832-d3d6-4d39-8ae2-8674347a8ac7@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d6aed832-d3d6-4d39-8ae2-8674347a8ac7@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2541d424-f689-4d09-9e71-404194892c8b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2541d424-f689-4d09-9e71-404194892c8b@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3259665c-7633-4533-a7a9-ee69574971ae@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3259665c-7633-4533-a7a9-ee69574971ae@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b423da6c-c5a3-4e2a-98b9-e276d357bdec@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b423da6c-c5a3-4e2a-98b9-e276d357bdec@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2a78bb3a-b36e-4eeb-85ab-39547e3380ec@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2a78bb3a-b36e-4eeb-85ab-39547e3380ec@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1d11ac5c-4233-4378-8794-57e767ab7ef2@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1d11ac5c-4233-4378-8794-57e767ab7ef2@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-fcfe0962-508e-459e-88b6-3797f3c5d7fb@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-fcfe0962-508e-459e-88b6-3797f3c5d7fb@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3f5bb37d-52f6-4f6a-aac7-c13158ce8856@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3f5bb37d-52f6-4f6a-aac7-c13158ce8856@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d10b2952-84dc-42c1-b37c-3bf556c2dfb0@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d10b2952-84dc-42c1-b37c-3bf556c2dfb0@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-25330946-2f34-4ac6-afe1-e627c5fd7a39@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (1.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-25330946-2f34-4ac6-afe1-e627c5fd7a39@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0dc44e0e-5db7-4206-bc5e-8a7f16c37ea8@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0dc44e0e-5db7-4206-bc5e-8a7f16c37ea8@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1183e19d-c09a-44bf-82c2-8e7b036941d8@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1183e19d-c09a-44bf-82c2-8e7b036941d8@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6edd3269-ec7d-46ca-a693-1cd156a1e39d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6edd3269-ec7d-46ca-a693-1cd156a1e39d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c0f35f7f-65cd-49b1-900a-3d28bc8e57d5@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c0f35f7f-65cd-49b1-900a-3d28bc8e57d5@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9f553b8b-eb25-406f-a6d9-6c7b3899235d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9f553b8b-eb25-406f-a6d9-6c7b3899235d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ebf8cfe8-48ec-4921-b1cf-4b076b76b19a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ebf8cfe8-48ec-4921-b1cf-4b076b76b19a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d311bdc3-0a8e-48db-8656-040bd62464f6@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d311bdc3-0a8e-48db-8656-040bd62464f6@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0df346f9-166c-4741-8cdf-3c4ed50da6cf@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0df346f9-166c-4741-8cdf-3c4ed50da6cf@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e070a281-4ca3-4d99-b02f-db01821dbd29@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e070a281-4ca3-4d99-b02f-db01821dbd29@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9ff808ad-d86f-4078-9b27-31650b662737@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9ff808ad-d86f-4078-9b27-31650b662737@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.2ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 12:33:35 UTC], ["updated_at", 2017-04-19 12:33:35 UTC]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8fa61e1a-0bb8-40a1-b9a2-31212ab91cde) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f92021482c8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-7448ddbf-b161-4c27-90ae-e2a44f136234@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-7448ddbf-b161-4c27-90ae-e2a44f136234@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: cd374337-e6cf-425d-b739-2c116f6bf4c2) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f9203280ef0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a7bc78c4-87a6-4c30-af02-0d15a836e63e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a7bc78c4-87a6-4c30-af02-0d15a836e63e@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-7de1a783-a554-4112-a99f-4c23792cf334@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-7de1a783-a554-4112-a99f-4c23792cf334@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: cb22b5da-4715-417e-a07b-21df1d02383b) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f92021a39c0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-28ee2a2a-012e-4ffb-ba36-d474450e3389@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-28ee2a2a-012e-4ffb-ba36-d474450e3389@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: dfbefa58-081e-475d-adea-765e79ed3400) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f9205362c40 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 21ms (Views: 0.3ms | ActiveRecord: 0.8ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8cfea139-25cf-4b98-89f5-5acf9344777a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8cfea139-25cf-4b98-89f5-5acf9344777a@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 9ms (Views: 0.4ms | ActiveRecord: 0.9ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ee6ce928-2909-43da-95f5-216916e02598@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ee6ce928-2909-43da-95f5-216916e02598@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 06ea1bc5-678f-49c7-82f7-ae67a35cc4f3) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f9202213ba8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 12ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-79ce145f-092f-4089-bad4-58fe68a20467@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-79ce145f-092f-4089-bad4-58fe68a20467@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 40edacc2-4539-42f0-9547-baa47f5cdff5) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f92069068f8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-cf787720-5aa0-497c-89c4-c609152654f6@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-cf787720-5aa0-497c-89c4-c609152654f6@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-bcad535b-5d07-4819-991c-33c769cffb1f@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-bcad535b-5d07-4819-991c-33c769cffb1f@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4e8284aa-ffb4-499f-9e06-41579a7267e5) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f92068401a8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c569a4e0-d84f-46ca-a542-d673bc66cbb3@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c569a4e0-d84f-46ca-a542-d673bc66cbb3@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d34be14e-37a2-4c3f-a9de-e5ecda98dac8@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d34be14e-37a2-4c3f-a9de-e5ecda98dac8@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-68952767-e9e0-470a-babe-ee46e6680ab9@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-68952767-e9e0-470a-babe-ee46e6680ab9@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 12:36:24 UTC], ["updated_at", 2017-04-19 12:36:24 UTC]]
  [1m[35m (1.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c88c8f68-a2a9-4df1-a3e8-0b3990c11800) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb6c8998d20 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1746995c-5875-4c4e-8642-2e1e3b27e5f8@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1746995c-5875-4c4e-8642-2e1e3b27e5f8@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-43b06061-9f33-4a66-91d0-77ee3d3e6152@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-43b06061-9f33-4a66-91d0-77ee3d3e6152@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-16a7c066-69de-44d5-86fb-dc68b3cbcbe5@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-16a7c066-69de-44d5-86fb-dc68b3cbcbe5@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-4d8cc16f-6063-4e4c-bbfb-ae5f7837b614@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-4d8cc16f-6063-4e4c-bbfb-ae5f7837b614@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 62113803-fd9d-4615-ad45-b187320ff3d7) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb6c8e659e8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-637baa5b-8492-434e-9cfb-629705963c0e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-637baa5b-8492-434e-9cfb-629705963c0e@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3fe6b0b0-2d74-45c7-b0d5-e342a7238de2) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb6ca15c100 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-02b47b65-4b2e-4c85-8b12-b117ab5fe254@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-02b47b65-4b2e-4c85-8b12-b117ab5fe254@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-dc2ec957-33f7-48aa-a04a-32824af37771@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-dc2ec957-33f7-48aa-a04a-32824af37771@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 041d229c-c7a7-4a2b-ad4f-9f5aab26e551) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb6c8d656b0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 14ms (Views: 0.3ms | ActiveRecord: 0.8ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9906d728-bfc2-4590-a631-dd3e15f42314@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9906d728-bfc2-4590-a631-dd3e15f42314@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 15ms (Views: 0.2ms | ActiveRecord: 1.5ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0dd89126-e566-46b2-939e-dfce7a7d8b8a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0dd89126-e566-46b2-939e-dfce7a7d8b8a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d8b6a565-56ce-4760-8ea0-d50e3c9484b7) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb6c78d5f88 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 11ms (Views: 0.7ms | ActiveRecord: 0.7ms)
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-42316040-b353-43e2-9570-a9e72d1915e0@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-42316040-b353-43e2-9570-a9e72d1915e0@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 454066e5-1b6d-464f-8837-dfd0bb967e10) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb6ca0caf70 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-07a9e39e-cd47-45f5-b04a-a45a9ad49b6a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-07a9e39e-cd47-45f5-b04a-a45a9ad49b6a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f77b6d88-183a-4c30-b3af-eb3c50352b50@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f77b6d88-183a-4c30-b3af-eb3c50352b50@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: edae5428-af95-4aaa-8761-7f7a5a9c8fa6) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb6c78e7058 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 12:57:54 UTC], ["updated_at", 2017-04-19 12:57:54 UTC]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9030593f-66b5-43e5-968b-d707634ebc82@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9030593f-66b5-43e5-968b-d707634ebc82@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-01d40b52-2037-4917-aed9-190b3c01982f@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-01d40b52-2037-4917-aed9-190b3c01982f@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d12ddba8-de0c-4b24-a393-1bf7ddbae43d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d12ddba8-de0c-4b24-a393-1bf7ddbae43d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-04abba40-f6a7-4b9e-b4f5-8d113ccb6edd@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-04abba40-f6a7-4b9e-b4f5-8d113ccb6edd@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.0ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: afa09b6f-e306-4fcf-8c42-0700fa29427b) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ff1f3e225d8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-56b367b6-b9a1-45d8-abc5-2f840499619b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-56b367b6-b9a1-45d8-abc5-2f840499619b@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e19812b8-d911-4769-b8c8-d6639f1fe934) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ff1f5822f50 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d62c2067-5ba9-484c-b4ad-fe001a67c503@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d62c2067-5ba9-484c-b4ad-fe001a67c503@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.0ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.0ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b0f6c595-e085-4b74-b251-3c611685a996@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b0f6c595-e085-4b74-b251-3c611685a996@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-21c23f08-947d-475f-b718-ff63d8cce88e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-21c23f08-947d-475f-b718-ff63d8cce88e@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 803edb71-8426-43fd-a407-f3aefc12b50b) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ff1f5a80ce8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-27d258c7-c953-4640-af66-804fefc67216@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-27d258c7-c953-4640-af66-804fefc67216@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6f7c4eca-c784-4cea-aac4-24c3699f62f6) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ff1f5b23e48 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-de84bce4-4918-4c70-956e-84114c33978f@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-de84bce4-4918-4c70-956e-84114c33978f@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 22ms (Views: 0.6ms | ActiveRecord: 1.7ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-536bb428-4bae-4a92-847d-1b130a81d143@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-536bb428-4bae-4a92-847d-1b130a81d143@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 2289f2f7-6528-4430-9ed5-66d157b73772) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ff1f6255590 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 22ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-688cc7b8-c8e1-48d7-996d-4adac2b9b9f3@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-688cc7b8-c8e1-48d7-996d-4adac2b9b9f3@example.com"], ["name", "john doe"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 34352540-b6c4-4420-8eea-fea409d3a1e5) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ff1f5c571c0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 11ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-69f582f1-ac14-4206-b4ea-fa2d0fd87b52@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-69f582f1-ac14-4206-b4ea-fa2d0fd87b52@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 475c915e-234f-4e3e-b244-5b98a2a5b93e) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ff1f61ed3c8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.0ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 7ms (Views: 0.2ms | ActiveRecord: 0.5ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-357dea89-fee3-413a-8b2d-fc086ae0f0e0@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-357dea89-fee3-413a-8b2d-fc086ae0f0e0@example.com"], ["name", "john doe"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 504dae17-83ab-40d1-bc2c-54a9226b68d9) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ff1f61a7238 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 8ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3dbb43fe-eaf1-4057-8daa-814f80b4ee45) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ff1f28ea828 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3c696718-1a33-4ca3-987a-5a07a159409e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3c696718-1a33-4ca3-987a-5a07a159409e@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-cd8e12ec-e74e-444c-9d58-56c92e5784cb@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-cd8e12ec-e74e-444c-9d58-56c92e5784cb@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-52b059e4-5530-4913-bd7c-72cef6667693@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-52b059e4-5530-4913-bd7c-72cef6667693@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a24b56b4-2a36-4c0b-a9be-c841aed361db@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a24b56b4-2a36-4c0b-a9be-c841aed361db@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (3.9ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d57c7672-7484-4768-9997-c8f01ebce6b8@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d57c7672-7484-4768-9997-c8f01ebce6b8@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-65db731d-805f-47b8-aae2-82a5c8cc400d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-65db731d-805f-47b8-aae2-82a5c8cc400d@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d5113bad-0c7d-4b6c-81e6-a02458ca325b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d5113bad-0c7d-4b6c-81e6-a02458ca325b@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.7ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-57902253-8c4d-4fcb-b514-0f4476d3e3d0@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-57902253-8c4d-4fcb-b514-0f4476d3e3d0@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-716add3a-de00-47cb-bbde-38be7674302f@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-716add3a-de00-47cb-bbde-38be7674302f@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1aa38708-08e0-40f0-a9d7-934e6b1beaca@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1aa38708-08e0-40f0-a9d7-934e6b1beaca@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b3f551c7-eeed-41e3-bd8e-e97fa5d6f5da@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b3f551c7-eeed-41e3-bd8e-e97fa5d6f5da@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (2.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-49279103-c86d-431d-9dd2-31c7d31753a4@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-49279103-c86d-431d-9dd2-31c7d31753a4@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-4e0b4373-2982-4c33-9ebd-4e0145ce8651@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-4e0b4373-2982-4c33-9ebd-4e0145ce8651@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f29a5626-5279-4a70-a9cc-55550f6ae0f3@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f29a5626-5279-4a70-a9cc-55550f6ae0f3@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f11dd781-0a08-49bc-a033-1a12c3254661@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f11dd781-0a08-49bc-a033-1a12c3254661@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-bbf10c5d-4f5d-41fb-99e2-c5420fb94f04@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-bbf10c5d-4f5d-41fb-99e2-c5420fb94f04@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0b45cdc3-472d-49de-bb0b-0f5c3a012bb5@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0b45cdc3-472d-49de-bb0b-0f5c3a012bb5@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f8d9477c-bd4f-4550-a5f3-68f7ace6d009@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f8d9477c-bd4f-4550-a5f3-68f7ace6d009@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-290348c2-5270-486d-a595-a62d73fd5322@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-290348c2-5270-486d-a595-a62d73fd5322@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0056b11c-015d-4b2e-aac2-e8922b6ced4a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0056b11c-015d-4b2e-aac2-e8922b6ced4a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-aed08089-c52a-4376-9989-a7953f862a5d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-aed08089-c52a-4376-9989-a7953f862a5d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d6a67297-10fe-442e-ab05-7ea25d8a4fa5@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d6a67297-10fe-442e-ab05-7ea25d8a4fa5@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0bb7067b-a14f-403c-bee5-0983763b670d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0bb7067b-a14f-403c-bee5-0983763b670d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-97442bc8-01bb-491a-9160-25e9a19146f0@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-97442bc8-01bb-491a-9160-25e9a19146f0@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c383635a-2066-4ab4-b6da-38ebde6da4ba@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c383635a-2066-4ab4-b6da-38ebde6da4ba@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-bece8e3a-9bf0-4acf-a560-74b5362cdbcf@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-bece8e3a-9bf0-4acf-a560-74b5362cdbcf@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e1529f87-e69d-4490-9b3f-4b0c3450e6cd@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e1529f87-e69d-4490-9b3f-4b0c3450e6cd@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7f7cf750-7cfe-474b-8323-e68860e3c49d) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fc1c4989878 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[36mCreditTransaction Load (0.3ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6dbf09c3-e97e-4b3b-9575-dfa8c5cb1f85@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6dbf09c3-e97e-4b3b-9575-dfa8c5cb1f85@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3b8f1266-1c5f-442f-8886-c0aa15c9dcc1@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3b8f1266-1c5f-442f-8886-c0aa15c9dcc1@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d3e9caf5-ffce-4ca4-b6d0-65149938bc81@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d3e9caf5-ffce-4ca4-b6d0-65149938bc81@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8f01bb31-ab25-4b66-8ebf-72a8b7f50fda@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8f01bb31-ab25-4b66-8ebf-72a8b7f50fda@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 500], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCreditTransaction Load (0.3ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6c5b8200-4b43-4c07-aa7d-13ca76faebc0) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007ffbee839a68 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2682a99a-c26a-49a9-b11f-4e6bcb862d35@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2682a99a-c26a-49a9-b11f-4e6bcb862d35@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1abbe80d-8837-4b12-846f-ccecfb8ec37c@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1abbe80d-8837-4b12-846f-ccecfb8ec37c@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ee732e3d-fe38-4f40-9c96-94520ae306e1@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ee732e3d-fe38-4f40-9c96-94520ae306e1@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0c8770cb-8b60-4d2c-9e98-faca9a445b7e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0c8770cb-8b60-4d2c-9e98-faca9a445b7e@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-da3294ea-cce4-4241-a7e5-5bdd670a325a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-da3294ea-cce4-4241-a7e5-5bdd670a325a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-32b47a82-47f6-4143-8dde-29bc6f79f789@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-32b47a82-47f6-4143-8dde-29bc6f79f789@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c03e0a85-312c-4a07-b43b-02bc7a4aa57a) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fc8a6dba968 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-00b0e5a4-96db-459f-8249-333aee843995@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-00b0e5a4-96db-459f-8249-333aee843995@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-25d87209-3819-46c4-a511-35d459f0c70c@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-25d87209-3819-46c4-a511-35d459f0c70c@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.8ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 13:40:00 UTC], ["updated_at", 2017-04-19 13:40:00 UTC]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-436bd033-405d-4509-8af2-f1f4ce507ce7@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-436bd033-405d-4509-8af2-f1f4ce507ce7@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-30dd04c3-b8de-4a84-9996-9be1d32692ae@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-30dd04c3-b8de-4a84-9996-9be1d32692ae@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 46f2f763-75e5-4629-a6af-89f2ce9db62c) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fa1ed20d028 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-45b367b5-5a13-4245-8229-e75fbd54b9a4@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-45b367b5-5a13-4245-8229-e75fbd54b9a4@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1851bb32-b31c-4b64-bdd4-7059a5001311) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fa1ec2cec10 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b9eaeb47-f6a7-470c-9ec3-0bf2afe38d9a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b9eaeb47-f6a7-470c-9ec3-0bf2afe38d9a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e7aa7cb3-af30-4169-8f9d-e4e7d25f0f12@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e7aa7cb3-af30-4169-8f9d-e4e7d25f0f12@example.com"], ["name", "john doe"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f8f744ed-be4e-43d0-ba60-c9dfcaa60aa1) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fa1ef8e0c18 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0ed406c8-e182-4eec-b00b-c5d6a01fcb6e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0ed406c8-e182-4eec-b00b-c5d6a01fcb6e@example.com"], ["name", "john doe"]]
  [1m[36mCreditTransaction Load (0.7ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d1c1d17b-652e-4a2b-930b-0b24cfcec1cf@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d1c1d17b-652e-4a2b-930b-0b24cfcec1cf@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c17b1e70-604a-411b-8d68-55d8c0b81f5c@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c17b1e70-604a-411b-8d68-55d8c0b81f5c@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-10844e62-4da1-4539-b2fc-aa83211545ef@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-10844e62-4da1-4539-b2fc-aa83211545ef@example.com"], ["name", "john doe"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 360c56ab-b78a-45e1-ad1f-6d32661c5cdd) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fa1ed609eb0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-7b89ad7c-3c28-46ff-88d3-2f92159b2714@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-7b89ad7c-3c28-46ff-88d3-2f92159b2714@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0e99c296-39f7-49f0-8346-ef38d3a37888) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fa1f0891158 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7cb50249-5c8b-4d89-bdf0-349b33956e54) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fa1efb13878 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 32ms (ActiveRecord: 2.0ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6537b380-b069-4419-b9cc-ba33cd007ec1@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6537b380-b069-4419-b9cc-ba33cd007ec1@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 02e8d063-2cca-4ea3-9350-3e2d7c17fd2c) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fa1efbdbb48 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 23ms (ActiveRecord: 1.5ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-5f6478f0-45c9-43cc-9489-927d069394ff@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-5f6478f0-45c9-43cc-9489-927d069394ff@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4c0909b2-13b4-4d9e-b5db-fcd7741b7cb8) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fa1efc38eb0 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
Completed 500 Internal Server Error in 13ms (ActiveRecord: 1.4ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-52a529d4-1fd4-4a6d-8441-870b3a571572@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-52a529d4-1fd4-4a6d-8441-870b3a571572@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 17123e1a-778a-4a74-979f-79853eaf0bbb) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fa1f0a34d20 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4df66b42-1bfc-4688-8a41-5d22ed42a662) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fa1efb631e8 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
Completed 500 Internal Server Error in 17ms (ActiveRecord: 1.1ms)
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-fe7da097-0ffb-42ce-ad1f-2640cfdd53ab@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-fe7da097-0ffb-42ce-ad1f-2640cfdd53ab@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 2a88c875-61c0-44fb-a7ea-aae65cd90410) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fa1f0a8d498 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7b677a26-4357-4846-8105-943a1b5787fa) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fa1ed9833e8 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 12ms (ActiveRecord: 0.9ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-694573c4-f4d4-437b-b801-33484b7a071a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-694573c4-f4d4-437b-b801-33484b7a071a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 45f76778-980e-4817-9c95-9ee86b3babda) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fa1efb13828 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (2.9ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b90926a4-3ad6-43ea-a91e-cca6726ee1be@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b90926a4-3ad6-43ea-a91e-cca6726ee1be@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 9049e56e-5c73-4cb1-b86f-70e9d27aae9a) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fa1efc94940 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f30278b5-78e1-4f5a-a16e-f12c726edbc9@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f30278b5-78e1-4f5a-a16e-f12c726edbc9@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.0ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 14:27:26 UTC], ["updated_at", 2017-04-19 14:27:26 UTC]]
  [1m[35m (1.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 221355ea-80c2-45a7-b535-9536aa9bb46f) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fc53cd17b90 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c375de24-3e1e-4a62-9c4c-7af5536d4d69@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c375de24-3e1e-4a62-9c4c-7af5536d4d69@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 85b725d5-3761-4001-85c6-d212b008d061) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fc53cafcc70 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d6d4f313-f6c3-44dd-a95a-90538cbb45ae@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d6d4f313-f6c3-44dd-a95a-90538cbb45ae@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d1ad7373-5f4b-4262-afdf-5cddd89558ef) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fc53e344fa8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2f448eda-af08-435c-ba26-952c4d182626@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2f448eda-af08-435c-ba26-952c4d182626@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-006c1867-1902-4953-9180-64d2f941e832@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-006c1867-1902-4953-9180-64d2f941e832@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3f8b9b68-0555-43ed-8dc4-71c2404037b6@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3f8b9b68-0555-43ed-8dc4-71c2404037b6@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a967fc6d-d8f0-4d9d-8b85-27623c9c04c8@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a967fc6d-d8f0-4d9d-8b85-27623c9c04c8@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9f3dae0d-359d-49d8-b303-bae2e6aa3cdb@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9f3dae0d-359d-49d8-b303-bae2e6aa3cdb@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e961c8d7-cfae-4057-97b3-a2b6f6ce175f) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fc53ce2c918 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mCreditTransaction Load (0.3ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-78dddb2a-6853-4357-8576-8053600cac85@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-78dddb2a-6853-4357-8576-8053600cac85@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f73f66c6-10b4-4199-9609-13532db68bad@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f73f66c6-10b4-4199-9609-13532db68bad@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9aa8a33c-6fc9-411d-a8c5-dfe548df0066@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9aa8a33c-6fc9-411d-a8c5-dfe548df0066@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 02a74ae4-47c6-4a80-bf99-0423f04edb19) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fc53cfc7160 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1ecefbdb-f803-4726-94f1-7109d16ee37d) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fc541021620 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 107031ms (ActiveRecord: 1.2ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e9b6fb01-3d99-443a-8dff-8eb464443c16@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e9b6fb01-3d99-443a-8dff-8eb464443c16@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 5fa0b929-b8be-4dd2-9f47-a7444670cf18) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fc5410a38f0 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
Completed 500 Internal Server Error in 2850ms (ActiveRecord: 1.2ms)
  [1m[35m (2.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f314a878-6efc-4a75-b27a-f4750fee1452@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f314a878-6efc-4a75-b27a-f4750fee1452@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c466abc6-f6a8-4081-8917-c11c292e2444) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fc540cc9928 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 1476ms (ActiveRecord: 1.2ms)
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6e63e377-3554-4f3f-b420-3dbc3b4de97c@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6e63e377-3554-4f3f-b420-3dbc3b4de97c@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.0ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: efb551e8-5bd0-4529-b7ee-b647373707d4) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fc54130fd00 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a1bc83fb-ab19-4f22-8734-1726e9655d68) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fc541324fc0 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 888ms (ActiveRecord: 0.8ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-5989d520-31a4-45c1-9159-39ab011021f3@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-5989d520-31a4-45c1-9159-39ab011021f3@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d4d54a75-220c-4b4d-bab7-a84b7e611e93) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fc53d3aa9f8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a3321d5f-fee6-474a-b101-ad547b6807ac) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fc540883210 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 801ms (ActiveRecord: 1.0ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1c2d0b43-c0ff-4cd8-ac86-971530dfe3d3@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1c2d0b43-c0ff-4cd8-ac86-971530dfe3d3@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b385496e-1009-41e4-9a63-2d397d11951e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b385496e-1009-41e4-9a63-2d397d11951e@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 28440274-faf6-4256-ade9-1091c4875c1a) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fc5414645c0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ac9a8891-613b-4608-a437-d8d300cc438e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ac9a8891-613b-4608-a437-d8d300cc438e@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: cc195fd9-e537-4e57-8248-67754cff7be5) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fc53da0b748 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 14:29:40 UTC], ["updated_at", 2017-04-19 14:29:40 UTC]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.4ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d030ad65-1467-4c81-9b06-9c3f74f9ae5c@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (3.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d030ad65-1467-4c81-9b06-9c3f74f9ae5c@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b37aed05-b8db-4020-b76a-154114800a31@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b37aed05-b8db-4020-b76a-154114800a31@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2670c051-ed4c-41fd-9730-000166313977@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2670c051-ed4c-41fd-9730-000166313977@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b213e049-54cf-4770-bd04-86bd0b370d29@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b213e049-54cf-4770-bd04-86bd0b370d29@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e656974b-ab3b-4bc2-a8a7-afed13618807) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007f8832c4d990 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2d32acc4-d789-4d25-b47d-ba732a9da80f@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2d32acc4-d789-4d25-b47d-ba732a9da80f@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d46a930c-64fb-4667-b064-46428291d802@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d46a930c-64fb-4667-b064-46428291d802@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: da789fa1-4909-48d1-ad63-16d042bafec0) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f8834202d08 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-7feddc7a-01db-4161-8b62-04e5fead0448@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-7feddc7a-01db-4161-8b62-04e5fead0448@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 62502e94-48d9-4aa5-9f50-79541b5f410d) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f88331674f8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-88595d2a-6e5c-412e-a880-49a204ef541a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-88595d2a-6e5c-412e-a880-49a204ef541a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.0ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 63d22f68-86d7-4ad0-9b6c-a34b282e92fe) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f8836881678 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3b6a1a0e-8b78-4e86-b4f1-eca97b225a2a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3b6a1a0e-8b78-4e86-b4f1-eca97b225a2a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c4edbac2-b257-4a04-a336-6ccab8f6d39a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c4edbac2-b257-4a04-a336-6ccab8f6d39a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: aecb7ace-07fc-406d-b539-4e6bb1c97537) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f8836a39510 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 45ms (ActiveRecord: 1.5ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c0b2225a-2804-41fc-9622-9e89620af450@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c0b2225a-2804-41fc-9622-9e89620af450@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 5f4c4d45-9395-4a23-a273-66605929ac58) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007f88343807c0 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
Completed 500 Internal Server Error in 18ms (ActiveRecord: 0.9ms)
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-701e08f9-5d4f-472d-9da8-adc0bb1ef736@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-701e08f9-5d4f-472d-9da8-adc0bb1ef736@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 43932c57-6f1c-4719-9453-63d34631eaf7) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f8837071630 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7a67c413-19fe-4b28-8979-2ec76f9dc9a8) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007f8836afed88 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 26ms (ActiveRecord: 1.8ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-102a275a-aacb-48a1-8325-b1512f49fb77@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-102a275a-aacb-48a1-8325-b1512f49fb77@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d7883248-ea72-407c-9d17-1775bbea2e9f) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f88370b76a8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 96c03f22-6194-42fb-a27b-0b494bac0285) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007f88369ca868 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 23ms (ActiveRecord: 1.1ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-71f9a5bd-93bd-4b06-91d5-4af6edf6cf96@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-71f9a5bd-93bd-4b06-91d5-4af6edf6cf96@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: fbb7d60c-54f3-43b6-808f-095723f6dc43) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f88370fd8b0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0cfade2f-bb5c-4ff8-a600-9b408a8ab0b5) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007f883711e290 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 22ms (ActiveRecord: 1.3ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c8a4260a-fc06-4240-9594-ebab64d13adf@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c8a4260a-fc06-4240-9594-ebab64d13adf@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f9edff4c-9304-4112-9e7f-b70c47b7cec3) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f8833f52ba8 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2d7297ae-f3f5-4e18-a8dd-4c3bc8e164d2@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2d7297ae-f3f5-4e18-a8dd-4c3bc8e164d2@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3e1227eb-2cae-4b33-bac0-bae079ec9857@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3e1227eb-2cae-4b33-bac0-bae079ec9857@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: fa59810f-bafe-45e3-8bb5-a30fd5756a67) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f88331c6688 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (3.1ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 14:29:59 UTC], ["updated_at", 2017-04-19 14:29:59 UTC]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-cd1f4f5c-6ab7-4531-a57d-62f73c6dc619@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-cd1f4f5c-6ab7-4531-a57d-62f73c6dc619@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3b822bf1-caad-49cd-ab43-d2d39a74ca5c@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3b822bf1-caad-49cd-ab43-d2d39a74ca5c@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-249c4477-c4c5-4723-b3fb-5eb44cef8f93@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-249c4477-c4c5-4723-b3fb-5eb44cef8f93@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-032e4f7e-3022-41b0-922e-586513c92244@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-032e4f7e-3022-41b0-922e-586513c92244@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 15192dbd-726b-46cb-a6d8-8f88319ad930) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007f92d86259e0 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-12d15dc9-e20d-4c28-814c-d8eb6aca4899@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-12d15dc9-e20d-4c28-814c-d8eb6aca4899@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-765f3808-1613-4388-a81b-a94499a85675@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-765f3808-1613-4388-a81b-a94499a85675@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8eb5f87a-c7ba-4021-89ca-ba18305d6b10@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8eb5f87a-c7ba-4021-89ca-ba18305d6b10@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.0ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.0ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 2d848c92-760f-42a3-bd47-9fb3312eda33) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007f92d84b5a88 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 15ms (ActiveRecord: 0.9ms)
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-dc242cd1-52a1-47d7-bf00-bfc2f6f9fea6@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-dc242cd1-52a1-47d7-bf00-bfc2f6f9fea6@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: aa9e5b94-25d7-4fe1-b837-6b5b5c80bd4b) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f92d76bf2d0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 14ms (ActiveRecord: 0.8ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-19e64e5a-2820-43e1-b057-3083fe04aa8e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-19e64e5a-2820-43e1-b057-3083fe04aa8e@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.0ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ceb0eb0e-ef55-40b5-acb5-8dabb5b11d74) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f92d758c958 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 026d516c-0956-4433-b3d8-137d86750a42) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007f92d7546bd8 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 17ms (ActiveRecord: 1.5ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b77362a4-99b0-4731-bb6b-a3c89c0a4db0@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b77362a4-99b0-4731-bb6b-a3c89c0a4db0@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f631880a-6e9b-49ce-9839-aebcb4d79b84) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f92dadae138 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 011b9b06-43c4-4617-a3a4-c53a5de300a9) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007f92db8e9e58 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
Completed 500 Internal Server Error in 17ms (ActiveRecord: 0.9ms)
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-895928e7-6f71-425f-9a3a-1945bd461f83@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-895928e7-6f71-425f-9a3a-1945bd461f83@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.0ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8c490c14-030e-4375-88a6-a217784b88f8) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f92daa09460 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b8457a86-d2fa-4585-a180-17593ec984bf) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007f92da92b610 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 12ms (ActiveRecord: 1.0ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4693d896-7504-4bad-b33c-b725ed7a920d) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f92d850d238 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b900c8be-5657-4804-a464-39a32f24a3b3@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b900c8be-5657-4804-a464-39a32f24a3b3@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.0ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a0d4eed8-8e45-4ec5-be90-0feb48ed42b2) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f92d83c6c08 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-dbd8f22e-3b5c-48b0-ac92-0573a02f57b4@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-dbd8f22e-3b5c-48b0-ac92-0573a02f57b4@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c77691d3-6ed5-4f2d-8c87-ec03c3e06da9@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c77691d3-6ed5-4f2d-8c87-ec03c3e06da9@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c9c5a3d8-fb84-4524-89c1-40ac70bea649) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f92d71faba0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-05fc860f-7ed5-498b-bc28-7453c220ea02@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-05fc860f-7ed5-498b-bc28-7453c220ea02@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: aa84a8c9-270f-4dd3-bff5-c40f43213fcd) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f92d7025e60 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0f70c84e-a62f-4c3e-9964-bbcb16267d7a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0f70c84e-a62f-4c3e-9964-bbcb16267d7a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7a8223e2-57f7-4522-b482-07b77fdd2e68) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f92d72909c0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c61eee95-5d79-441b-90a1-363605c7bb48@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c61eee95-5d79-441b-90a1-363605c7bb48@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.7ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 14:30:52 UTC], ["updated_at", 2017-04-19 14:30:52 UTC]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f6512a44-b016-4d1b-83d1-26ff749e692e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f6512a44-b016-4d1b-83d1-26ff749e692e@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d20dbf27-84e4-42b3-b068-65bc2740b4bd) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb83997d0a8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-69d9a13c-899a-49ef-ad01-e48c6da95945@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-69d9a13c-899a-49ef-ad01-e48c6da95945@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0e85f366-e6fb-4e1a-a3a8-00ba17f6f0ce@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0e85f366-e6fb-4e1a-a3a8-00ba17f6f0ce@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 786a35d5-a9ed-4727-90c6-9748638334e3) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb8387cda10 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2f08d6b0-c660-48db-81ea-51ca977d8142@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2f08d6b0-c660-48db-81ea-51ca977d8142@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8d8596d4-0bc9-4dea-902e-f4a3d870ab6b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8d8596d4-0bc9-4dea-902e-f4a3d870ab6b@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-49800c00-42db-4fe1-80cf-57d0953fda77@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-49800c00-42db-4fe1-80cf-57d0953fda77@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-28273a3e-c139-4585-8326-978d528d9114@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-28273a3e-c139-4585-8326-978d528d9114@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 16e8fd75-dd2c-47c6-b0e6-91f92c85a5a2) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fb83b482858 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-dfdd9ecc-f7f7-40c4-ba31-8648e154ab2a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-dfdd9ecc-f7f7-40c4-ba31-8648e154ab2a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c9197389-d00f-4c5e-853b-679e4cee94b7@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c9197389-d00f-4c5e-853b-679e4cee94b7@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 64943078-8cf0-4271-a161-42d2fb0c08e4) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb83b5ba928 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9ab70905-f9bc-45b5-b48c-da5477d765fb@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9ab70905-f9bc-45b5-b48c-da5477d765fb@example.com"], ["name", "john doe"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.6ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1a1200a2-6a1b-4416-b565-2fa89d5435b3) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb83b7e8c68 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 28ms (ActiveRecord: 2.0ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b6d8ae3a-9b48-4266-81b4-1364e699eca3@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b6d8ae3a-9b48-4266-81b4-1364e699eca3@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7fc3ccf7-dc4d-423b-8034-d160ed72ff78) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fb83b79dcb8 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
Completed 500 Internal Server Error in 19ms (ActiveRecord: 1.5ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mCreditTransaction Load (0.4ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0f3bb12e-1701-44a1-8629-460657e5f7ea@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0f3bb12e-1701-44a1-8629-460657e5f7ea@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1fae3746-4c7f-4bc5-8fd4-26fff0148fb4) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb83c8812a0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d3278b43-b423-4760-ba3a-ab8e18512d69) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fb839e92020 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
Completed 500 Internal Server Error in 17ms (ActiveRecord: 0.9ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-023d1d81-fb16-4824-b5ad-3d13cf2f0caa@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-023d1d81-fb16-4824-b5ad-3d13cf2f0caa@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b08c1141-6eb9-4c70-85e4-a54d06250882) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb839f6b0a0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6a7032e1-460a-4ff2-ba6c-a8ce740cf12b) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fb839db2a38 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
Completed 500 Internal Server Error in 18ms (ActiveRecord: 1.8ms)
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-4ef0a71a-0f63-44cf-8e1f-90e2e6982603@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-4ef0a71a-0f63-44cf-8e1f-90e2e6982603@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e0bb4764-c2c0-4e7a-ab64-c83c8fc0c2e2) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb83c8e9f80 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 111ba9cb-c0ba-4344-868a-0701407ce786) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fb839d49600 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
Completed 500 Internal Server Error in 12ms (ActiveRecord: 1.0ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d38afd3c-7c88-4d9c-9c0d-c4496e105e99@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d38afd3c-7c88-4d9c-9c0d-c4496e105e99@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7f459f94-bd06-4f7e-9bf2-421bbc5f4c66) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb839d1af58 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3235aa6d-791d-40a6-b05c-1c8926391c08@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3235aa6d-791d-40a6-b05c-1c8926391c08@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-99187cc6-9945-426c-80e0-35d041851a14@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-99187cc6-9945-426c-80e0-35d041851a14@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e10ac4be-e310-431f-a90b-acb4f7239d85) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb839ce3058 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.5ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 14:32:05 UTC], ["updated_at", 2017-04-19 14:32:05 UTC]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-4c1aeaed-36e7-4c1c-aa2f-62933fb54e04@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-4c1aeaed-36e7-4c1c-aa2f-62933fb54e04@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (4.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-824cc98d-e2dd-43e4-a000-49e9a023d475@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-824cc98d-e2dd-43e4-a000-49e9a023d475@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCreditTransaction Load (0.3ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 563eabff-a955-4815-b2c7-2ae57f54ef9d) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fa9e51a0220 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ac49cc24-bfd5-49fe-92db-bc2aa136e3b5@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ac49cc24-bfd5-49fe-92db-bc2aa136e3b5@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-fcf79803-bd53-4411-a5df-fc0fea0d62de@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-fcf79803-bd53-4411-a5df-fc0fea0d62de@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-76242890-b1e7-4f65-9b0b-fca90e48c263@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-76242890-b1e7-4f65-9b0b-fca90e48c263@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-22ee0409-86b0-47f1-a689-cb17a880b652@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-22ee0409-86b0-47f1-a689-cb17a880b652@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: bc8b3b39-2dcd-4b15-bf69-a4eb642b7fde) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fa9e6998148 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8f5f3f5f-9d09-4fce-b55e-2926677faf38@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8f5f3f5f-9d09-4fce-b55e-2926677faf38@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 56b33aee-c6e7-4a34-870f-3205a9bc6e59) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fa9e54f1708 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-45799ad6-d50d-4593-a81c-78f8f4358f86@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-45799ad6-d50d-4593-a81c-78f8f4358f86@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 2423d41f-7a91-496b-8741-6da48d6178ce) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fa9e6a38d00 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-866cd0e7-08f7-40fd-8743-e449f7ded264@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-866cd0e7-08f7-40fd-8743-e449f7ded264@example.com"], ["name", "john doe"]]
  [1m[36mInvitation Load (0.7ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a6cee177-e7a8-42f1-9308-920a7a19f879@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a6cee177-e7a8-42f1-9308-920a7a19f879@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-52529fed-b8ae-432b-91a8-5c3e4ee8d988@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-52529fed-b8ae-432b-91a8-5c3e4ee8d988@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 34d1c14f-5645-437b-90b8-a3545ea46d30) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fa9e4e01fd8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2e0e2861-1872-4a08-b9ec-75db0804415d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2e0e2861-1872-4a08-b9ec-75db0804415d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6dd627e6-ff32-4157-871b-b64a0c9aaee2) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fa9e4ecbef0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-53a7eae2-9e42-4e40-93ea-5a0c7499c695@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-53a7eae2-9e42-4e40-93ea-5a0c7499c695@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 159bf872-215e-4558-8895-521c9f540017) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fa9e4f6e740 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 25293ms (ActiveRecord: 1.1ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9e06a992-8ebf-4474-a86d-a5db87387417@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9e06a992-8ebf-4474-a86d-a5db87387417@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 95f6c5ab-8a4b-45b5-ab02-00c3b7d94d3f) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fa9e90e03e0 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
Completed 500 Internal Server Error in 1094ms (ActiveRecord: 1.0ms)
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e67bc456-c88b-4020-b8e2-7c0fbb99cae3@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e67bc456-c88b-4020-b8e2-7c0fbb99cae3@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b65ec5af-db52-4144-88ce-02642a3985e1) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fa9e918bec0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a11f7193-67c2-4663-abf3-c9cd752503e8) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fa9e91a1068 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 581ms (ActiveRecord: 0.9ms)
  [1m[35m (2.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-028bf41f-0add-41cc-83b8-7746036cb750@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-028bf41f-0add-41cc-83b8-7746036cb750@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b6b30f7a-9c01-4136-b315-87534ba9f489) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fa9e89f85a0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8c9e3af1-f396-42d5-8198-75eaf014819f) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fa9e4e10a88 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 844ms (ActiveRecord: 1.1ms)
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f0636542-743a-467c-bdae-b304f4990112@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f0636542-743a-467c-bdae-b304f4990112@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 52f953fb-4156-48f9-8e7c-2c7ddecd7d4d) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fa9e8a59dc8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 50327a85-56c3-4bdf-a816-f5f22da11e7c) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fa9e55caf58 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 500 Internal Server Error in 955ms (ActiveRecord: 1.0ms)
  [1m[35m (2.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (1.8ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 14:33:11 UTC], ["updated_at", 2017-04-19 14:33:11 UTC]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1e054493-a4c7-4ced-bc27-e0e799b0acfc@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1e054493-a4c7-4ced-bc27-e0e799b0acfc@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: db66dd64-6eb8-4627-9c56-f50818e9027e) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fd4f57c8e50 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-90d7c0df-803c-41b3-8f3e-d2eb22dea3a2@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-90d7c0df-803c-41b3-8f3e-d2eb22dea3a2@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 685b7a4e-8478-40e9-a133-4ce8613e7433) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fd4f686f7e0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6511b8de-2828-40d9-98c3-7403afd5ba9d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6511b8de-2828-40d9-98c3-7403afd5ba9d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-18c09d4e-9013-430c-8155-fe45700bc30c@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-18c09d4e-9013-430c-8155-fe45700bc30c@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f07d6c54-903b-4374-98ac-54991b699725) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fd4f9bdd820 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8759bc85-cbcc-4608-807f-b6db5e78d777) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fd4f69b35e8 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 406 Not Acceptable in 87ms (ActiveRecord: 2.0ms)
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0a07e7cf-d118-45a5-80ee-1830f3f7585b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0a07e7cf-d118-45a5-80ee-1830f3f7585b@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ee962fe8-7673-4966-860e-1b21c697f4c2) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fd4f9218920 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 406 Not Acceptable in 48ms (ActiveRecord: 1.1ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9b6e34c3-fa4c-4445-b854-316a1f8725ac@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9b6e34c3-fa4c-4445-b854-316a1f8725ac@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1d7fe612-5cec-4cd0-b99d-e0a045119d41) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fd4f9bc73e0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 406 Not Acceptable in 54ms (ActiveRecord: 1.0ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1d9c6875-d631-4a39-8bbd-086371ef54db@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1d9c6875-d631-4a39-8bbd-086371ef54db@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6259ae2e-a4d1-473f-bf66-f0e5aecd249f) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fd4f9afaf48 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 03140bbc-e302-4001-b9b9-ca66332c000d) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fd4f9d2fe58 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 406 Not Acceptable in 58ms (ActiveRecord: 1.7ms)
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d9aa2021-3b56-413e-ba00-ce4a37141865@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d9aa2021-3b56-413e-ba00-ce4a37141865@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f02b8e88-6171-405c-84e2-aacb0beabdb6) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fd4f9a59828 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 181475e6-af6b-4c07-b9bc-2af76b090c5f) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fd4f9263ba0 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
Completed 406 Not Acceptable in 46ms (ActiveRecord: 0.9ms)
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-5329a2b8-c0cc-4415-ac66-5491d80a7f82@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-5329a2b8-c0cc-4415-ac66-5491d80a7f82@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-66165311-a53b-414a-908c-7430157d325c@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-66165311-a53b-414a-908c-7430157d325c@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f89a3691-3892-481b-a045-dd86f217a735@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f89a3691-3892-481b-a045-dd86f217a735@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8ddba9a9-e9e8-4ff3-a8b0-cb06f404144d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8ddba9a9-e9e8-4ff3-a8b0-cb06f404144d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d1060712-71a4-4adf-b555-62fb7fd4ac55@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d1060712-71a4-4adf-b555-62fb7fd4ac55@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-aae54ee4-f3f8-4649-9803-46571e059046@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-aae54ee4-f3f8-4649-9803-46571e059046@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 38a0ad7b-ad93-4ed5-b498-6ff2d6713aad) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fd4f99a01e8 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2f65eae8-6743-429e-b014-4f81bed1a642@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2f65eae8-6743-429e-b014-4f81bed1a642@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-cd32090f-36c4-4cc0-8a6e-5ead7b475cdb@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-cd32090f-36c4-4cc0-8a6e-5ead7b475cdb@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: eb3f51b8-6ec7-4abd-b9a6-5068d741329e) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd4f996a7f0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ec2e4252-c6d0-4596-bae3-13f37609833b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ec2e4252-c6d0-4596-bae3-13f37609833b@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4e315ce7-6283-4106-98ab-1da2f3c7681b) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fd4f99492d0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e52c2f05-2841-41d6-89cb-d8a61a05e0ca) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fd4f6a3c8e8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 14:34:33 UTC], ["updated_at", 2017-04-19 14:34:33 UTC]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-dc654295-7659-4d1a-99f7-7f2233dec914@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-dc654295-7659-4d1a-99f7-7f2233dec914@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d9c51654-7b20-4b6a-a376-8b01acc296f0@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d9c51654-7b20-4b6a-a376-8b01acc296f0@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-92584f35-f39f-41aa-88a7-732e9ae99b7d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-92584f35-f39f-41aa-88a7-732e9ae99b7d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a994345a-c20d-4114-b9b0-a87209f89bc5@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a994345a-c20d-4114-b9b0-a87209f89bc5@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-4a74a984-37ca-4da8-a78c-be63a6cad9d8@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-4a74a984-37ca-4da8-a78c-be63a6cad9d8@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-bb5be6fd-a8d0-4203-bad4-add302e732b4@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-bb5be6fd-a8d0-4203-bad4-add302e732b4@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 00b59e46-a06f-475c-a499-a19735bb1b8c) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fb29cbd9790 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-de4a2a8d-4bc4-4a96-b131-ae65a97d8d9e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-de4a2a8d-4bc4-4a96-b131-ae65a97d8d9e@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6c07b43d-65bc-47a2-8d3a-9b97ff0098a3@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6c07b43d-65bc-47a2-8d3a-9b97ff0098a3@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6eee3b83-c973-43b6-88b3-ae6fa9fd6b1b) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb29b0b2688 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-33c5fef5-00a5-473e-9909-b61c2733d5bd@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-33c5fef5-00a5-473e-9909-b61c2733d5bd@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b12f0fe3-d9ff-4bc3-ad93-39d9e348b40b) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb29e879af8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-99e00988-347c-4018-aad4-8e55163ac2b5@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-99e00988-347c-4018-aad4-8e55163ac2b5@example.com"], ["name", "john doe"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b3ad3fbb-da02-43e7-b2b6-2b0333df6950) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb29af5c338 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: bf9812a6-c690-4473-83eb-d01a7f75bd45) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fb29eb83050 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.4ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 200 OK in 30ms (Views: 1.8ms | ActiveRecord: 1.2ms)
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6237ef64-1f20-4b76-b2dd-87d895605074@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6237ef64-1f20-4b76-b2dd-87d895605074@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a2222a04-68fe-4d29-9ef8-3130492255f9) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb29b8ea210 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 13ms (Views: 0.2ms | ActiveRecord: 1.0ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ee5d7258-a786-45cf-8e09-e636944337e4@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ee5d7258-a786-45cf-8e09-e636944337e4@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 60c6fe45-e428-4360-ba91-fca6abf9410c) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fb29b92ec08 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
Completed 200 OK in 11ms (Views: 0.2ms | ActiveRecord: 0.9ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-80f94b94-8644-4470-a002-a75166d3a234@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-80f94b94-8644-4470-a002-a75166d3a234@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: db7706fd-b876-43b9-aabe-daf56edb0293) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb29f2056a8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 19367b5f-e597-4ada-bf0b-63cd2397e9eb) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fb29f215288 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.3ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 200 OK in 17ms (Views: 0.4ms | ActiveRecord: 1.2ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f47c9da1-98f2-4fd1-a991-5117bfbce93b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f47c9da1-98f2-4fd1-a991-5117bfbce93b@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b12a1cf4-fb02-415c-a579-609e78fdc0b5) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb29b8e2560 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "source_type", "source_id") VALUES (?, ?, ?)[0m  [["user_id", 1], ["source_type", "Invitation"], ["source_id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 425c14cf-3dfb-4d70-9026-05cebdca774d) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fb29b9a7888 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Completed 200 OK in 12ms (Views: 0.2ms | ActiveRecord: 0.9ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8e0d1fe7-2f98-458f-99ff-398d40b42ff8@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8e0d1fe7-2f98-458f-99ff-398d40b42ff8@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ea0c37cb-c9c3-4111-a644-21806f2f3ed5@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ea0c37cb-c9c3-4111-a644-21806f2f3ed5@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 36de4f83-2f18-409a-810f-fb5118ed8a09) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb29eda8038 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-80b0f659-727e-4808-becf-e0f8bb7c7f5a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-80b0f659-727e-4808-becf-e0f8bb7c7f5a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 2772af03-9eb1-4ea2-8231-63fc4c60ef04) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb29f254938 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: ee765f7f-7bce-44b5-bbac-520e4040eddc) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb29f2742b0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 14:40:02 UTC], ["updated_at", 2017-04-19 14:40:02 UTC]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-7b21e681-bfc1-4992-8680-3cb2e25718ed@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-7b21e681-bfc1-4992-8680-3cb2e25718ed@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-5b331109-105e-4724-b513-f445a8362935@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-5b331109-105e-4724-b513-f445a8362935@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3e8ee633-44f4-4579-a078-4e46ef1f249e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3e8ee633-44f4-4579-a078-4e46ef1f249e@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-bf54199e-94e5-4320-8156-0d57be162575@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-bf54199e-94e5-4320-8156-0d57be162575@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4a4d6482-2301-4222-8ff8-128e42b1b9d5) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fe394a11128 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[36mCreditTransaction Load (0.3ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-bb4d04af-08df-46b2-9e13-209005cb9ddc@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-bb4d04af-08df-46b2-9e13-209005cb9ddc@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9a2de088-30d7-4da8-9864-a2b1a96a5b05@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9a2de088-30d7-4da8-9864-a2b1a96a5b05@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8d93b58e-13a8-444a-8bb0-5c4bc44938d8@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8d93b58e-13a8-444a-8bb0-5c4bc44938d8@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c7868211-0034-487e-8433-9efd2e6a5070) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fe394dbb648 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8a51769d-9dee-4708-a8da-dc973ea40d61@example.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (1.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8a51769d-9dee-4708-a8da-dc973ea40d61@example.com"], ["name", "john doe"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-5e29cacc-8dc7-455d-b1c7-68db53ce5894@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-5e29cacc-8dc7-455d-b1c7-68db53ce5894@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: fedefb2b-e886-4466-96e4-4e90400da5e8) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fe392478e20 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 985ad333-6ed8-433c-b5e5-2d279577aaec) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fe392514ac8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d6ea413a-2c02-4381-95a7-fe8c1e897f3a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d6ea413a-2c02-4381-95a7-fe8c1e897f3a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-5db3f9f0-6c1c-4729-a3c9-b861be565242@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-5db3f9f0-6c1c-4729-a3c9-b861be565242@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 80656f57-6241-4bbc-a371-2d64663a81ba) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe39601b4a0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-babd63c7-27ea-47b2-a152-fbf524fad476@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-babd63c7-27ea-47b2-a152-fbf524fad476@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 56601c33-fbc1-49d4-9b74-c0a321999a68) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fe39287c080 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-5c2e5355-975e-4239-960a-26b70b15c134@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-5c2e5355-975e-4239-960a-26b70b15c134@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a4110eb4-ab28-4dcc-aa5d-81c5df3ceded) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fe3928bacb8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 29ms (Views: 0.3ms | ActiveRecord: 1.0ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-507b6ff7-7a40-40c1-a18b-dc5017825ff1@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-507b6ff7-7a40-40c1-a18b-dc5017825ff1@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 10ms (Views: 0.5ms | ActiveRecord: 0.9ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ee5a25af-1198-4bdd-9c09-f84dd2d3604c@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ee5a25af-1198-4bdd-9c09-f84dd2d3604c@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 514fdadf-de0d-4ba7-9fd2-62bbe3e1f11c) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fe392836aa8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 11ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c4ec97ae-67a5-462c-a19b-ec5e206b45d1@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c4ec97ae-67a5-462c-a19b-ec5e206b45d1@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4aab9927-0f29-4cc8-9263-89f5e9009806) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fe3927512c8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 13ms (Views: 0.4ms | ActiveRecord: 0.8ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b0fa8074-6ac5-4079-95f7-502f613c0b8f@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b0fa8074-6ac5-4079-95f7-502f613c0b8f@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 74cada80-25dc-4017-a4d5-0a8520853084) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fe39277a3f8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 10ms (Views: 0.2ms | ActiveRecord: 0.9ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 14:42:20 UTC], ["updated_at", 2017-04-19 14:42:20 UTC]]
  [1m[35m (1.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2875aa9c-be6c-46c3-992e-6ea885cf172e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2875aa9c-be6c-46c3-992e-6ea885cf172e@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 6ms (ActiveRecord: 0.3ms)
  [1m[35m (1.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0a011421-cc37-4a58-b79f-a7af9365d2be@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0a011421-cc37-4a58-b79f-a7af9365d2be@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 3ms (ActiveRecord: 0.2ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-87310db6-d4f9-4425-a989-057c7151de08@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-87310db6-d4f9-4425-a989-057c7151de08@example.com"], ["name", "john doe"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 4ms (ActiveRecord: 0.3ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-139a73fd-baca-423d-93e3-6e5c34866699@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-139a73fd-baca-423d-93e3-6e5c34866699@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 15ms (ActiveRecord: 0.4ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1f093d1b-f73c-485c-957a-102e97b5a543@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1f093d1b-f73c-485c-957a-102e97b5a543@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 3ms (ActiveRecord: 0.3ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-831e20df-d2ad-4650-99d2-40b7c944b103@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-831e20df-d2ad-4650-99d2-40b7c944b103@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e43324ca-7071-4ac2-ab81-54e1f433acb1@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e43324ca-7071-4ac2-ab81-54e1f433acb1@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6ea2e032-9ff8-46a5-a29e-1dc930127e25@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6ea2e032-9ff8-46a5-a29e-1dc930127e25@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-60fb244c-08ea-4802-a41a-af5cce446b2f@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-60fb244c-08ea-4802-a41a-af5cce446b2f@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 80fc44c5-1a75-4e61-909d-b36849fe7280) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007f915eace4b8 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (3.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f661ce6b-afb9-45a5-b834-062cd8a25327@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f661ce6b-afb9-45a5-b834-062cd8a25327@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-773a7934-ec2a-4394-b925-ec2f2359c29d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-773a7934-ec2a-4394-b925-ec2f2359c29d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-aae193e8-b928-4678-a03a-9f3b162432f6@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-aae193e8-b928-4678-a03a-9f3b162432f6@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 2b987f2e-85d5-4613-a239-1050d86b8611) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f915b2f7f30 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.4ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-cd4f1197-0494-46f3-be7b-6a64278d759c@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-cd4f1197-0494-46f3-be7b-6a64278d759c@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-075a75d1-7093-42ed-a471-79f8f78ebbc9@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-075a75d1-7093-42ed-a471-79f8f78ebbc9@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 43ef6b7c-2fc0-4d0d-922c-30d1ad3b9770) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f915eb2b140 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-cd521374-7b3f-4e1b-8a55-2cbd163bfeb7@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-cd521374-7b3f-4e1b-8a55-2cbd163bfeb7@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8e578cd1-c2cd-4855-829a-ffb13675df50@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8e578cd1-c2cd-4855-829a-ffb13675df50@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-082cccd6-4d59-49df-ab45-f901ec8a26d9@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-082cccd6-4d59-49df-ab45-f901ec8a26d9@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 2b3425ef-91c0-47ca-97ff-db6c30dd4443) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f915b4221d0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.7ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 14:42:59 UTC], ["updated_at", 2017-04-19 14:42:59 UTC]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.0ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-77b25f20-3208-4f49-a4a1-fbcc6a3f110c@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-77b25f20-3208-4f49-a4a1-fbcc6a3f110c@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6ada32d4-e08c-4049-94e0-e1e66772d5af) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb0609ef238 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0d2b24e1-19a4-4ff5-95c0-5fa4e7223d80@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0d2b24e1-19a4-4ff5-95c0-5fa4e7223d80@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.0ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ca4a1a09-7239-47b4-b740-931e4c3add08@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ca4a1a09-7239-47b4-b740-931e4c3add08@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d7869fe8-3905-4a9d-862d-09a77a9aee91) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb05fe7dad0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2d57efc9-d171-48f1-9e8d-dad5629c55d0@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2d57efc9-d171-48f1-9e8d-dad5629c55d0@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9e6387eb-612a-4ebb-817f-652e2016f0c4@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9e6387eb-612a-4ebb-817f-652e2016f0c4@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-fc80b2d7-4780-446f-bdf5-fbfb27ee9c8a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-fc80b2d7-4780-446f-bdf5-fbfb27ee9c8a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.0ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d5c47320-a144-47fb-a09a-0191901c3baf@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d5c47320-a144-47fb-a09a-0191901c3baf@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e05c9d58-762b-41d6-b650-89492b3328e4) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fb061c00260 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-48f1edc7-d73d-438c-aa96-9eefff8be5a9@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-48f1edc7-d73d-438c-aa96-9eefff8be5a9@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-978e3c0e-71ba-4a9d-9972-067e1ddd6b00@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-978e3c0e-71ba-4a9d-9972-067e1ddd6b00@example.com"], ["name", "john doe"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-4ccad323-332d-41b3-9afa-c492929ea302@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-4ccad323-332d-41b3-9afa-c492929ea302@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 06441734-5c10-46b2-855d-ee6e538772f5) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb061df8b30 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-bdc929c2-9c0f-4d52-af04-d82a225bdf6e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-bdc929c2-9c0f-4d52-af04-d82a225bdf6e@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.4ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 6b7781c5-4f27-4a4e-833d-e271cffef4f4) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fb05ec12e68 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f9eae5c2-1d88-4c7a-83f3-64001ba67364@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f9eae5c2-1d88-4c7a-83f3-64001ba67364@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-7cb8a557-9374-4264-8bd9-210ee4643dbd@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-7cb8a557-9374-4264-8bd9-210ee4643dbd@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f197b38f-4e93-45c7-8419-6e9e5d3e5018) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb0630113d0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 19ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-bcd2567e-eea7-4342-9e8b-40be008d2711@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-bcd2567e-eea7-4342-9e8b-40be008d2711@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.0ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.0ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 6ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ae89c604-6e31-4043-9935-ca5cac0c3418@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ae89c604-6e31-4043-9935-ca5cac0c3418@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8f1480b9-8402-4752-b220-8526190ff73f) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb05ee1e450 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 9ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8ddf6358-9080-451a-91bc-1338b28c3274@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8ddf6358-9080-451a-91bc-1338b28c3274@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3149e606-0d5b-4821-8ddb-fedccf944d7a) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb05ed9cc70 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 9ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-2831adbe-ae1d-41cf-873d-f4e5a1d51dcf@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-2831adbe-ae1d-41cf-873d-f4e5a1d51dcf@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 5d420df6-1f97-4da0-90e0-75614ad65922) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fb05f0def00 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 8ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 630c65d1-09b6-4eff-a789-4240d268a7fd) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fb060b15478 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 14:46:21 UTC], ["updated_at", 2017-04-19 14:46:21 UTC]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0774b6e9-2f95-4d71-befa-201f225965bd@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0774b6e9-2f95-4d71-befa-201f225965bd@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: d0e3b516-37be-490e-9b78-2f49e069e46c) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fc8422f9678 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-499a383c-1374-441c-a464-4b14794e0ea7@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-499a383c-1374-441c-a464-4b14794e0ea7@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-cea9f948-dc3a-4686-9387-9e699928004a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-cea9f948-dc3a-4686-9387-9e699928004a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7db220f0-c0c1-484c-9eee-dd0818285e4b) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fc8421c0a90 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-759c0a1b-c21f-4c06-b58c-faa4a10f02a9@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-759c0a1b-c21f-4c06-b58c-faa4a10f02a9@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1abc0494-8456-47fb-98b8-386791130c06@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1abc0494-8456-47fb-98b8-386791130c06@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-062be154-9ac5-42d2-aa16-91a4e5720a77@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-062be154-9ac5-42d2-aa16-91a4e5720a77@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1aaaeb16-a713-4e1f-b31a-7537f2619c3b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1aaaeb16-a713-4e1f-b31a-7537f2619c3b@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8a786649-6bec-44d1-aa60-0dbbf60defba@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8a786649-6bec-44d1-aa60-0dbbf60defba@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1521c6c0-743d-460f-bde8-ad07f2d41618@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1521c6c0-743d-460f-bde8-ad07f2d41618@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0a957e44-7854-4c4d-81ac-7f96b209708e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0a957e44-7854-4c4d-81ac-7f96b209708e@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: eb13504e-3315-4d6f-a554-8376ee1530fd) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fc83f5e8ad0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f2a87998-7b49-4e2f-83ff-3e876434bfc8@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f2a87998-7b49-4e2f-83ff-3e876434bfc8@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 304ad809-88ab-4dff-b473-a6655847ace7) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fc83e1988a0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1b311357-5a72-40d7-b1d6-27f9366b3b23@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1b311357-5a72-40d7-b1d6-27f9366b3b23@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a94754a7-e0e6-464a-ae45-7a474efb17e0) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fc83f4485e0 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-f66b2b87-a3a4-4725-849b-94a45feab7da@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-f66b2b87-a3a4-4725-849b-94a45feab7da@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 2908e643-f0fe-4e42-a14e-cdcdfdb676fe) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fc83e8810b8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 29ms (Views: 0.3ms | ActiveRecord: 1.5ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-09f00baa-49fe-424f-89c8-179bb3759883@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-09f00baa-49fe-424f-89c8-179bb3759883@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 11ms (Views: 0.3ms | ActiveRecord: 1.1ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-61b95e18-5e16-4177-8ec1-37767cf30e35@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-61b95e18-5e16-4177-8ec1-37767cf30e35@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: dcafca38-1fd6-4bd6-a3f3-46de6bc7b6c0) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fc8420e19f8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 10ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (3.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9bd25801-e396-43bd-afd7-115f77ee6ef2@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9bd25801-e396-43bd-afd7-115f77ee6ef2@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.4ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4b3db2f0-9e18-4284-90c0-40fda15b1fa6) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fc83eb76c78 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 17ms (Views: 0.2ms | ActiveRecord: 1.7ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-4a9e8dec-3ebd-4f33-a505-8ac2ec37eceb@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-4a9e8dec-3ebd-4f33-a505-8ac2ec37eceb@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 97e6853d-3369-4aba-9865-db103cfa1723) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fc83eaf7bf8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 15ms (Views: 0.2ms | ActiveRecord: 1.4ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (2.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 14:46:51 UTC], ["updated_at", 2017-04-19 14:46:51 UTC]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-60200cf5-78e4-441c-a312-bec7016bf69b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-60200cf5-78e4-441c-a312-bec7016bf69b@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 9aadc609-4b0f-4f6a-9892-4cdc8f0dfa40) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fbe9767a478 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-fce5bbce-e15d-4f36-a8d9-7b52246726dc@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-fce5bbce-e15d-4f36-a8d9-7b52246726dc@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-52c67441-862f-47ed-a6c1-aea8df258a9c@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-52c67441-862f-47ed-a6c1-aea8df258a9c@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f595d5c1-be35-4ea9-ae7d-114b89e6d694) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fbe9892d6b0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-04e1fc68-f250-47a0-9c63-1d8913f28b4a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-04e1fc68-f250-47a0-9c63-1d8913f28b4a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7864745f-65eb-4fe9-804e-68cf3a0064b4) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fbe97570118 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-be97dbb4-849e-466c-ac8e-71fe5f3c4be7@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-be97dbb4-849e-466c-ac8e-71fe5f3c4be7@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-10b6445d-1bbc-400a-9eef-08f7d65e32be@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-10b6445d-1bbc-400a-9eef-08f7d65e32be@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 91ae21e9-f00b-4c92-adf2-a00e1baaf772) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fbe983293e0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-03dc9e7d-504e-4e74-a951-a69e45bf9959@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-03dc9e7d-504e-4e74-a951-a69e45bf9959@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.6ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 2905e12c-3422-4c02-bfb1-418cadd6dea6) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fbe98a75590 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 33ms (Views: 0.3ms | ActiveRecord: 2.6ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (2.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-ed7f52e1-3e60-49f8-b57a-55c2a2a7842b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-ed7f52e1-3e60-49f8-b57a-55c2a2a7842b@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: dfc91c03-1c8c-4c41-ba36-71650d611b53) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fbe9b460a08 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 18ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8ddb62dd-48db-4f5e-b32c-4759345bfbc0@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8ddb62dd-48db-4f5e-b32c-4759345bfbc0@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 7ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-80c2317b-5a63-4a6b-a53d-9c45a82123fe@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-80c2317b-5a63-4a6b-a53d-9c45a82123fe@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 63e8a0af-a665-427e-b7ea-b7a29e1c9c0b) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fbe9b3f0168 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 9ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9110cd81-5fe4-418e-ba38-ac915b9ce887@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9110cd81-5fe4-418e-ba38-ac915b9ce887@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b14a1e47-8f26-4fd6-ac2d-cb941df4cbee) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fbe9b5bdc20 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 12ms (Views: 0.2ms | ActiveRecord: 0.6ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-bc363061-0dac-4760-a8e6-62f42993de5d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-bc363061-0dac-4760-a8e6-62f42993de5d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-b83254d1-8f3f-4db7-9e2e-109940aee5f0@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-b83254d1-8f3f-4db7-9e2e-109940aee5f0@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-42a97596-be92-4ed5-adca-4e5dab1c3433@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-42a97596-be92-4ed5-adca-4e5dab1c3433@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-80cdfd18-f0aa-4f93-a177-6de9849d469b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-80cdfd18-f0aa-4f93-a177-6de9849d469b@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b692d32c-d356-4d56-9db6-8d9a5964d42f) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fbe98715558 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-abe75f21-056c-4ad1-81c3-2b27faa36e66@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-abe75f21-056c-4ad1-81c3-2b27faa36e66@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-96748da3-55be-4fce-a378-6c47ed4823ce@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-96748da3-55be-4fce-a378-6c47ed4823ce@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (3.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 4bbf5c8c-a982-46ff-9a8a-3159b46baa86) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fbe97966088 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 14:47:18 UTC], ["updated_at", 2017-04-19 14:47:18 UTC]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6c09ffdd-6665-4df4-a3a5-2ec79cb61c4e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6c09ffdd-6665-4df4-a3a5-2ec79cb61c4e@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 8b88c0a8-c115-4c81-8da9-8b8e29b37e8e) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fc31ec63e08 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c61a9313-40d5-4671-b8aa-ecd3eedb2314@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c61a9313-40d5-4671-b8aa-ecd3eedb2314@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3ae88190-2e29-4387-ac3b-55a3af1c03da) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fc3201160a8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-91003863-678d-4f80-8c89-d810f8ce844a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-91003863-678d-4f80-8c89-d810f8ce844a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 3be6c273-b276-46ee-98db-6c98e3dcfe17) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007fc320550b50 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-60d12a2f-ce68-4fa3-bce6-eee17e2be394@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-60d12a2f-ce68-4fa3-bce6-eee17e2be394@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 30ms (Views: 0.6ms | ActiveRecord: 1.1ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (1.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-aa7bad0c-cbfe-43ba-8c0b-f85c276a3a53@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-aa7bad0c-cbfe-43ba-8c0b-f85c276a3a53@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: dc0b21ff-4a1b-4d3e-9278-c50201165d2d) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fc31eee8a98 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 12ms (Views: 0.4ms | ActiveRecord: 1.0ms)
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-654c0072-6e9d-4380-96fe-cbfa1702452b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-654c0072-6e9d-4380-96fe-cbfa1702452b@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1344da1c-ed48-4d40-bc4c-f05155d57af8) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fc322b7ee80 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 9ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-cb9c1c06-b160-413c-8300-420465f02251@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-cb9c1c06-b160-413c-8300-420465f02251@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: f8648f9a-8b92-4fe5-97c9-fb19aef9bc6b) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fc322bf4748 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 16ms (Views: 0.3ms | ActiveRecord: 0.9ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1b85754f-82bc-48f4-92ed-22dd3674160a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1b85754f-82bc-48f4-92ed-22dd3674160a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 78de0e0b-6d8e-4daf-8761-f0f658cf08e8) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007fc323350d48 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 9ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-204f42b6-9e7e-4b44-908e-c388186ee3cc@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-204f42b6-9e7e-4b44-908e-c388186ee3cc@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-80a7018d-897f-4000-b486-6897087a5211@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-80a7018d-897f-4000-b486-6897087a5211@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-311745ae-d60f-4bc1-ae43-47da523d78cb@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-311745ae-d60f-4bc1-ae43-47da523d78cb@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-fcd7d97a-c2cf-468e-bb9f-15484da56e78@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-fcd7d97a-c2cf-468e-bb9f-15484da56e78@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a7a8e32a-f735-43a2-adb5-3669a1b2b98d) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007fc31f0d8920 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-9463d029-c740-4287-bd8d-014e009d1c86@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-9463d029-c740-4287-bd8d-014e009d1c86@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0af9f864-990c-4862-863a-00e39e76eaa3@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0af9f864-990c-4862-863a-00e39e76eaa3@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a7e7a20f-5b5b-4a6f-a23c-c5f6111b1576@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a7e7a20f-5b5b-4a6f-a23c-c5f6111b1576@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6af836a8-8670-458e-9592-f75bf308118b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6af836a8-8670-458e-9592-f75bf308118b@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 58b23ea6-2935-4d9f-806f-5e443a11e285) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fc31fa49950 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.3ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-55f81e10-0309-49b1-8e0f-d0832dbd5b5d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-55f81e10-0309-49b1-8e0f-d0832dbd5b5d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7653490b-0ed7-43b0-8e53-b1e0c1e763aa) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007fc3230287b0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.5ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 14:49:08 UTC], ["updated_at", 2017-04-19 14:49:08 UTC]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-666da6c3-bdca-4b42-b3e1-100a87626e9f@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-666da6c3-bdca-4b42-b3e1-100a87626e9f@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (2.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-6a6ee9d2-3902-492a-ad32-203f1d22fdb2@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-6a6ee9d2-3902-492a-ad32-203f1d22fdb2@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 0706b05d-2a04-4df8-bcad-048b43d84fd6) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f96f1aae7b0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-d417308c-180c-4dcf-8356-f1c05883d37e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-d417308c-180c-4dcf-8356-f1c05883d37e@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 9f0bb877-ec9e-4d0d-8286-9193828ef404) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f96f1cac2d8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-61dc71ed-96b0-47c3-b17f-0aac0a750b91@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-61dc71ed-96b0-47c3-b17f-0aac0a750b91@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 47a1b557-92ef-4583-af9c-f40dc12c2de4) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f96f1d74828 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-72a9c18b-4d1f-47a7-98e6-155f1d2b305a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-72a9c18b-4d1f-47a7-98e6-155f1d2b305a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-41b03466-74c4-4770-859f-a200a9fe8d5f@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-41b03466-74c4-4770-859f-a200a9fe8d5f@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 7a5db60f-86c7-4130-96c4-78baf29ccc79) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007f96f1f9f260 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e3f4d7cd-46ed-409a-82ff-2fd7215715c1@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e3f4d7cd-46ed-409a-82ff-2fd7215715c1@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3127c891-8d73-464b-b003-f631928fbcae@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3127c891-8d73-464b-b003-f631928fbcae@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 95108c18-06b4-45a3-b765-fe497c7d1fa0) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007f96f4bf1340 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mCreditTransaction Load (0.1ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0cec69d8-89f7-4750-b3e9-28879cc810e0@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0cec69d8-89f7-4750-b3e9-28879cc810e0@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0d13a364-34fb-4eaa-9f8a-741c609ed45c@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0d13a364-34fb-4eaa-9f8a-741c609ed45c@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-e76c4703-7c82-4113-a396-db3bb1bdf85b@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-e76c4703-7c82-4113-a396-db3bb1bdf85b@example.com"], ["name", "john doe"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-22579135-a927-48ca-880a-1dc441aa0ece@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-22579135-a927-48ca-880a-1dc441aa0ece@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-7c7a4df3-296f-4bd3-9d4e-dadb57b7ceca@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-7c7a4df3-296f-4bd3-9d4e-dadb57b7ceca@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e62b270c-e1d5-45c0-9fe9-1a5607b15b00) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f96f61638e0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 17ms (Views: 0.3ms | ActiveRecord: 0.9ms)
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-88298ee6-2d97-4fb2-adf2-09006b7b93d8@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-88298ee6-2d97-4fb2-adf2-09006b7b93d8@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.6ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 24ms (Views: 0.3ms | ActiveRecord: 1.7ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-beafcb5a-4eef-45d1-84ef-e8e501416f9a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-beafcb5a-4eef-45d1-84ef-e8e501416f9a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: fd4a109d-2912-4a4a-8c17-8832ffd95659) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f96f24c3610 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 10ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-5d685b8a-75e2-46f2-a296-95fc934dc26a@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-5d685b8a-75e2-46f2-a296-95fc934dc26a@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: afdb197a-0cc5-4a8e-9941-15f177336770) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f96f60e30a0 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 9ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-66129067-b57d-4090-8faf-fc7f530f30c2@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-66129067-b57d-4090-8faf-fc7f530f30c2@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: fa0a28a3-689e-44cc-b84f-acf8d9fd4dab) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007f96f38f3770 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 9ms (Views: 0.2ms | ActiveRecord: 0.7ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e3efc824-b3fa-44ee-b925-5843d57ad40d) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007f96f60607b8 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", :environment]]
  [1m[35m (2.9ms)[0m  [1m[35mCREATE TABLE "credit_transactions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "cents" integer DEFAULT 0 NOT NULL, "source_type" varchar NOT NULL, "source_id" integer NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[34mselect sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_source_type_and_source_id" ON "credit_transactions" ("source_type", "source_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_credit_transactions_on_source_type_and_source_id' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_credit_transactions_on_user_id" ON "credit_transactions" ("user_id")[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "invitations" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "inviter_id" integer NOT NULL, "invitee_id" integer, "invitee_email" varchar NOT NULL, "accepted" boolean DEFAULT 'f')[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_invitee_id" ON "invitations" ("invitee_id")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_invitations_on_invitee_id' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE  INDEX "index_invitations_on_inviter_id" ON "invitations" ("inviter_id")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar, "name" varchar)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170320162131)[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20170317141651),
(20170320153113);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", 2017-04-19 14:52:08 UTC], ["updated_at", 2017-04-19 14:52:08 UTC]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", :environment], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: b44131e0-a2e3-4d1f-8b77-27d38729592a) to Async(mailers) with arguments: "AppMailer", "signup_email", "deliver_now", #<GlobalID:0x007ffc83493d60 @uri=#<URI::GID gid://dummy/User/1>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "john@doe.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "john@doe.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3083fe3e-8eaa-4788-ae74-aa5f6374c58e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3083fe3e-8eaa-4788-ae74-aa5f6374c58e@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8c03c0b2-9c1e-4801-9505-b085feaa2ab9@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8c03c0b2-9c1e-4801-9505-b085feaa2ab9@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: cf8e3cca-56c4-4b6b-830d-009af58200d4) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ffc82d6b9c0 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-1b83576f-b6f5-4b7e-88ac-2d01d73cc9c2@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-1b83576f-b6f5-4b7e-88ac-2d01d73cc9c2@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@foo.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 39b67993-f08a-4da0-89ec-9c9cd23c050f) to Async(mailers) with arguments: "AppMailer", "invitation_email", "deliver_now", #<GlobalID:0x007ffc85523918 @uri=#<URI::GID gid://dummy/Invitation/1>>
  [1m[36mInvitation Load (0.2ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-8ff4f6ef-caab-49fb-90ed-0b78e91aa3f6@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-8ff4f6ef-caab-49fb-90ed-0b78e91aa3f6@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: c3504807-4f15-4dd5-9dd7-875520f262c2) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ffc855da3e8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (4.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-7ab1a893-1e44-4f41-9883-50af40282a0e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-7ab1a893-1e44-4f41-9883-50af40282a0e@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-17a793ef-7a71-45fd-90f1-439974e59772@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-17a793ef-7a71-45fd-90f1-439974e59772@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: a9754913-f106-4683-8b22-f541ab613105) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ffc856666b8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-50a74837-6686-4602-bcbe-b4a1fc103b62@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-50a74837-6686-4602-bcbe-b4a1fc103b62@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.0ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 540f8153-3b08-4cb5-baeb-b1376fa550f7) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ffc82f84388 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 27ms (Views: 0.3ms | ActiveRecord: 1.4ms)
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-7521363a-421c-40b7-bd72-7b9463f96d7d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-7521363a-421c-40b7-bd72-7b9463f96d7d@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 11ms (Views: 0.2ms | ActiveRecord: 0.8ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-af2d03fa-30cf-4b9b-b5c3-af523feca316@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-af2d03fa-30cf-4b9b-b5c3-af523feca316@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 9887f6fc-0a4b-419f-9831-93384d3e9cfb) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ffc821ac0f8 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 12ms (Views: 0.2ms | ActiveRecord: 0.9ms)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
Completed 500 Internal Server Error in 3ms (Views: 0.2ms | ActiveRecord: 0.9ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-c6e115c5-bc39-41e4-8b44-e93199f75589@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-c6e115c5-bc39-41e4-8b44-e93199f75589@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 1e6fc835-6e97-497d-8b54-13d65f785e02) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ffc85298450 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 10ms (Views: 0.3ms | ActiveRecord: 0.7ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-bae7483d-3d6e-412f-9a69-6319c8211208@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-bae7483d-3d6e-412f-9a69-6319c8211208@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Processing by InvitationsController#accept as HTML
  Parameters: {"id"=>"1"}
  [1m[36mInvitation Load (0.1ms)[0m  [1m[34mSELECT  "invitations".* FROM "invitations" WHERE "invitations"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "invitee@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email") VALUES (?)[0m  [["email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? AND ("users"."id" != ?) LIMIT ?[0m  [["email", "invitee@example.com"], ["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "invitee_id" = ? WHERE "invitations"."id" = ?[0m  [["invitee_id", 2], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: 273063a8-d3b8-4962-8936-e02181a1c688) to Async(mailers) with arguments: "AppMailer", "welcome_email", "deliver_now", #<GlobalID:0x007ffc87a33e10 @uri=#<URI::GID gid://dummy/User/2>>
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "invitations" SET "accepted" = ? WHERE "invitations"."id" = ?[0m  [["accepted", true], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
Completed 422 Unprocessable Entity in 12ms (Views: 0.3ms | ActiveRecord: 1.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-0f7ce242-8221-401c-b265-9adb3c7182c0@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-0f7ce242-8221-401c-b265-9adb3c7182c0@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-5f4ba745-9a32-4cfe-beb0-e900d9ea965d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-5f4ba745-9a32-4cfe-beb0-e900d9ea965d@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (4.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-a6068966-f795-455d-97db-67025593d2a1@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-a6068966-f795-455d-97db-67025593d2a1@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-4910027c-688e-449d-9cc5-1da9c52ae7dc@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-4910027c-688e-449d-9cc5-1da9c52ae7dc@example.com"], ["name", "john doe"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[ActiveJob] Enqueued ActionMailer::DeliveryJob (Job ID: e1a82dda-1823-4874-ba62-2852a1a2c1e7) to Async(mailers) with arguments: "AppMailer", "notify_payment", "deliver_now", #<GlobalID:0x007ffc87a61310 @uri=#<URI::GID gid://dummy/CreditTransaction/1>>
  [1m[36mCreditTransaction Load (0.2ms)[0m  [1m[34mSELECT  "credit_transactions".* FROM "credit_transactions" WHERE "credit_transactions"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[34mSELECT SUM("credit_transactions"."cents") FROM "credit_transactions" WHERE "credit_transactions"."user_id" = 1[0m
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-3618a9e9-f7be-431e-8541-31faf697040e@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-3618a9e9-f7be-431e-8541-31faf697040e@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email") VALUES (?, ?)[0m  [["inviter_id", 1], ["invitee_email", "invitee@example.com"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "foo-33fe7b3a-e83d-40f4-9ede-3715100a001d@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name") VALUES (?, ?)[0m  [["email", "foo-33fe7b3a-e83d-40f4-9ede-3715100a001d@example.com"], ["name", "john doe"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "invitations" ("inviter_id", "invitee_email", "accepted") VALUES (?, ?, ?)[0m  [["inviter_id", 2], ["invitee_email", "invitee@example.com"], ["accepted", true]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "credit_transactions" ("user_id", "cents", "source_type", "source_id") VALUES (?, ?, ?, ?)[0m  [["user_id", 1], ["cents", 200], ["source_type", "Invitation"], ["source_id", 2]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
